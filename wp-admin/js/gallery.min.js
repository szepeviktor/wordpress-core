jQuery(document).ready(function(t){var e,i,s,r,n,a=!1;i=function(){e=t("#media-items").sortable({items:"div.media-item",placeholder:"sorthelper",axis:"y",distance:2,handle:"div.filename",stop:function(){var e=t("#media-items").sortable("toArray"),i=e.length;t.each(e,function(e,s){var r=a?i-e:1+e;t("#"+s+" .menu_order input").val(r)})}})},s=function(){var e=t(".menu_order_input"),i=e.length;e.each(function(e){var s=a?i-e:1+e;t(this).val(s)})},r=function(e){e=e||0,t(".menu_order_input").each(function(){("0"===this.value||e)&&(this.value="")})},t("#asc").click(function(t){t.preventDefault(),a=!1,s()}),t("#desc").click(function(t){t.preventDefault(),a=!0,s()}),t("#clear").click(function(t){t.preventDefault(),r(1)}),t("#showall").click(function(e){e.preventDefault(),t("#sort-buttons span a").toggle(),t("a.describe-toggle-on").hide(),t("a.describe-toggle-off, table.slidetoggle").show(),t("img.pinkynail").toggle(!1)}),t("#hideall").click(function(e){e.preventDefault(),t("#sort-buttons span a").toggle(),t("a.describe-toggle-on").show(),t("a.describe-toggle-off, table.slidetoggle").hide(),t("img.pinkynail").toggle(!0)}),i(),r(),t("#media-items>*").length>1&&(n=wpgallery.getWin(),t("#save-all, #gallery-settings").show(),"undefined"!=typeof n.tinyMCE&&n.tinyMCE.activeEditor&&!n.tinyMCE.activeEditor.isHidden()?(wpgallery.mcemode=!0,wpgallery.init()):t("#insert-gallery").show())}),jQuery(window).unload(function(){window.tinymce=window.tinyMCE=window.wpgallery=null}),window.tinymce=null,window.wpgallery={mcemode:!1,editor:{},dom:{},is_update:!1,el:{},I:function(t){return document.getElementById(t)},init:function(){var t,e,i,s,r=this,n=r.getWin();if(r.mcemode){for(t=(""+document.location.search).replace(/^\?/,"").split("&"),e={},i=0;i<t.length;i++)s=t[i].split("="),e[unescape(s[0])]=unescape(s[1]);e.mce_rdomain&&(document.domain=e.mce_rdomain),window.tinymce=n.tinymce,window.tinyMCE=n.tinyMCE,r.editor=tinymce.EditorManager.activeEditor,r.setup()}},getWin:function(){return window.dialogArguments||opener||parent||top},setup:function(){var t,e,i,s,r,n,a=this,o=a.editor;if(a.mcemode){if(a.el=o.selection.getNode(),"IMG"!==a.el.nodeName||!o.dom.hasClass(a.el,"wpGallery")){if(!(e=o.dom.select("img.wpGallery"))||!e[0])return"1"===getUserSetting("galfile")&&(a.I("linkto-file").checked="checked"),"1"===getUserSetting("galdesc")&&(a.I("order-desc").checked="checked"),getUserSetting("galcols")&&(a.I("columns").value=getUserSetting("galcols")),getUserSetting("galord")&&(a.I("orderby").value=getUserSetting("galord")),void jQuery("#insert-gallery").show();a.el=e[0]}t=o.dom.getAttrib(a.el,"title"),t=o.dom.decode(t),t?(jQuery("#update-gallery").show(),a.is_update=!0,i=t.match(/columns=['"]([0-9]+)['"]/),s=t.match(/link=['"]([^'"]+)['"]/i),r=t.match(/order=['"]([^'"]+)['"]/i),n=t.match(/orderby=['"]([^'"]+)['"]/i),s&&s[1]&&(a.I("linkto-file").checked="checked"),r&&r[1]&&(a.I("order-desc").checked="checked"),i&&i[1]&&(a.I("columns").value=""+i[1]),n&&n[1]&&(a.I("orderby").value=n[1])):jQuery("#insert-gallery").show()}},update:function(){var t,e=this,i=e.editor,s="";if(!e.mcemode||!e.is_update)return t="[gallery"+e.getSettings()+"]",void e.getWin().send_to_editor(t);"IMG"===e.el.nodeName&&(s=i.dom.decode(i.dom.getAttrib(e.el,"title")),s=s.replace(/\s*(order|link|columns|orderby)=['"]([^'"]+)['"]/gi,""),s+=e.getSettings(),i.dom.setAttrib(e.el,"title",s),e.getWin().tb_remove())},getSettings:function(){var t=this.I,e="";return t("linkto-file").checked&&(e+=' link="file"',setUserSetting("galfile","1")),t("order-desc").checked&&(e+=' order="DESC"',setUserSetting("galdesc","1")),3!==t("columns").value&&(e+=' columns="'+t("columns").value+'"',setUserSetting("galcols",t("columns").value)),"menu_order"!==t("orderby").value&&(e+=' orderby="'+t("orderby").value+'"',setUserSetting("galord",t("orderby").value)),e}};