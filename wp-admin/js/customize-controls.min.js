!function(t,e){var i,s,r,n=wp.customize;n.OverlayNotification=n.Notification.extend({loading:!1,initialize:function(t,e){var i=this;n.Notification.prototype.initialize.call(i,t,e),i.containerClasses+=" notification-overlay",i.loading&&(i.containerClasses+=" notification-loading")},render:function(){var t=n.Notification.prototype.render.call(this);return t.on("keydown",_.bind(this.handleEscape,this)),t},handleEscape:function(t){var e=this;27===t.which&&(t.stopPropagation(),e.dismissible&&e.parent&&e.parent.remove(e.code))}}),n.Notifications=n.Values.extend({alt:!1,defaultConstructor:n.Notification,initialize:function(t){var e=this;n.Values.prototype.initialize.call(e,t),_.bindAll(e,"constrainFocus"),e._addedIncrement=0,e._addedOrder={},e.bind("add",function(t){e.trigger("change",t)}),e.bind("removed",function(t){e.trigger("change",t)})},count:function(){return _.size(this._value)},add:function(t,e){var i,s,r=this;return"string"==typeof t?(i=t,s=e):(i=t.code,s=t),r.has(i)||(r._addedIncrement+=1,r._addedOrder[i]=r._addedIncrement),n.Values.prototype.add.call(r,i,s)},remove:function(t){return delete this._addedOrder[t],n.Values.prototype.remove.call(this,t)},get:function(t){var e,i,s,r=this;return e=_.values(r._value),s=_.extend({sort:!1},t),s.sort&&(i={error:4,warning:3,success:2,info:1},e.sort(function(t,e){var s=0,n=0;return _.isUndefined(i[t.type])||(s=i[t.type]),_.isUndefined(i[e.type])||(n=i[e.type]),s!==n?n-s:r._addedOrder[e.code]-r._addedOrder[t.code]})),e},render:function(){var t,i,s,r,a=this,o=!1,h=[],d={};a.container&&a.container.length&&(t=a.get({sort:!0}),a.container.toggle(0!==t.length),a.container.is(a.previousContainer)&&_.isEqual(t,a.previousNotifications)||(s=a.container.children("ul").first(),s.length||(s=e("<ul></ul>"),a.container.append(s)),s.find("> [data-code]").remove(),_.each(a.previousNotifications,function(t){d[t.code]=t}),_.each(t,function(t){var i;!wp.a11y||d[t.code]&&_.isEqual(t.message,d[t.code].message)||wp.a11y.speak(t.message,"assertive"),i=e(t.render()),t.container=i,s.append(i),t.extended(n.OverlayNotification)&&h.push(t)}),i=Boolean(h.length),a.previousNotifications&&(o=Boolean(_.find(a.previousNotifications,function(t){return t.extended(n.OverlayNotification)}))),i!==o&&(e(document.body).toggleClass("customize-loading",i),a.container.toggleClass("has-overlay-notifications",i),i?(a.previousActiveElement=document.activeElement,e(document).on("keydown",a.constrainFocus)):e(document).off("keydown",a.constrainFocus)),i?(a.focusContainer=h[h.length-1].container,a.focusContainer.prop("tabIndex",-1),r=a.focusContainer.find(":focusable"),r.length?r.first().focus():a.focusContainer.focus()):a.previousActiveElement&&(e(a.previousActiveElement).focus(),a.previousActiveElement=null),a.previousNotifications=t,a.previousContainer=a.container,a.trigger("rendered")))},constrainFocus:function(t){var i,s=this;t.stopPropagation(),9===t.which&&(i=s.focusContainer.find(":focusable"),0===i.length&&(i=s.focusContainer),e.contains(s.focusContainer[0],t.target)&&e.contains(s.focusContainer[0],document.activeElement)?i.last().is(t.target)&&!t.shiftKey?(t.preventDefault(),i.first().focus()):i.first().is(t.target)&&t.shiftKey&&(t.preventDefault(),i.last().focus()):(t.preventDefault(),i.first().focus()))}}),n.Setting=n.Value.extend({defaults:{transport:"refresh",dirty:!1},initialize:function(t,e,i){var s,r=this;s=_.extend({previewer:n.previewer},r.defaults,i||{}),n.Value.prototype.initialize.call(r,e,s),r.id=t,r._dirty=s.dirty,r.notifications=new n.Notifications,r.bind(r.preview)},preview:function(){var t,e=this;t=e.transport,"postMessage"!==t||n.state("previewerAlive").get()||(t="refresh"),"postMessage"===t?e.previewer.send("setting",[e.id,e()]):"refresh"===t&&e.previewer.refresh()},findControls:function(){var t=this,e=[];return n.control.each(function(i){_.each(i.settings,function(s){s.id===t.id&&e.push(i)})}),e}}),n._latestRevision=0,n._lastSavedRevision=0,n._latestSettingRevisions={},n.bind("change",function(t){n._latestRevision+=1,n._latestSettingRevisions[t.id]=n._latestRevision}),n.bind("ready",function(){n.bind("add",function(t){t._dirty&&(n._latestRevision+=1,n._latestSettingRevisions[t.id]=n._latestRevision)})}),n.dirtyValues=function(t){var e={};return n.each(function(i){var s;i._dirty&&(s=n._latestSettingRevisions[i.id],n.state("changesetStatus").get()&&t&&t.unsaved&&(_.isUndefined(s)||s<=n._lastSavedRevision)||(e[i.id]=i.get()))}),e},n.requestChangesetUpdate=function(t,i){var s,r,a,o,h={};return s=new e.Deferred,0!==n.state("processing").get()?(s.reject("already_processing"),s.promise()):(o=_.extend({title:null,date:null,autosave:!1,force:!1},i),t&&_.extend(h,t),_.each(n.dirtyValues({unsaved:!0}),function(e,i){t&&null===t[i]||(h[i]=_.extend({},h[i]||{},{value:e}))}),n.trigger("changeset-save",h,o),!o.force&&_.isEmpty(h)&&null===o.title&&null===o.date?(s.resolve({}),s.promise()):o.status?s.reject({code:"illegal_status_in_changeset_update"}).promise():o.date&&o.autosave?s.reject({code:"illegal_autosave_with_date_gmt"}).promise():(n.state("processing").set(n.state("processing").get()+1),s.always(function(){n.state("processing").set(n.state("processing").get()-1)}),a=n.previewer.query({excludeCustomizedSaved:!0}),delete a.customized,_.extend(a,{nonce:n.settings.nonce.save,customize_theme:n.settings.theme.stylesheet,customize_changeset_data:JSON.stringify(h)}),null!==o.title&&(a.customize_changeset_title=o.title),null!==o.date&&(a.customize_changeset_date=o.date),!1!==o.autosave&&(a.customize_changeset_autosave="true"),n.trigger("save-request-params",a),r=wp.ajax.post("customize_save",a),r.done(function(t){var e={};n._lastSavedRevision=Math.max(n._latestRevision,n._lastSavedRevision),n.state("changesetStatus").set(t.changeset_status),t.changeset_date&&n.state("changesetDate").set(t.changeset_date),s.resolve(t),n.trigger("changeset-saved",t),t.setting_validities&&_.each(t.setting_validities,function(t,i){!0===t&&_.isObject(h[i])&&!_.isUndefined(h[i].value)&&(e[i]=h[i].value)}),n.previewer.send("changeset-saved",_.extend({},t,{saved_changeset_values:e}))}),r.fail(function(t){s.reject(t),n.trigger("changeset-error",t)}),r.always(function(t){t.setting_validities&&n._handleSettingValidities({settingValidities:t.setting_validities})}),s.promise()))},n.utils.bubbleChildValueChanges=function(t,i){e.each(i,function(e,i){t[i].bind(function(e,i){t.parent&&e!==i&&t.parent.trigger("change",t)})})},s=function(t){var e,i,s,r;e=this,t=t||{},s=function(){var t;t=(e.extended(n.Panel)||e.extended(n.Section))&&e.expanded&&e.expanded()?e.contentContainer:e.container,r=t.find(".control-focus:first"),0===r.length&&(r=t.find("input, select, textarea, button, object, a[href], [tabindex]").filter(":visible").first()),r.focus()},t.completeCallback?(i=t.completeCallback,t.completeCallback=function(){s(),i()}):t.completeCallback=s,n.state("paneVisible").set(!0),e.expand?e.expand(t):t.completeCallback()},n.utils.prioritySort=function(t,e){return t.priority()===e.priority()&&"number"==typeof t.params.instanceNumber&&"number"==typeof e.params.instanceNumber?t.params.instanceNumber-e.params.instanceNumber:t.priority()-e.priority()},n.utils.isKeydownButNotEnterEvent=function(t){return"keydown"===t.type&&13!==t.which},n.utils.areElementListsEqual=function(t,i){return t.length===i.length&&-1===_.indexOf(_.map(_.zip(t,i),function(t){return e(t[0]).is(t[1])}),!1)},n.utils.highlightButton=function(t,e){function i(){r=!0}var s,r=!1;return s=_.extend({delay:0,focusTarget:t},e),s.focusTarget.on("focusin",i),setTimeout(function(){s.focusTarget.off("focusin",i),r||(t.addClass("button-see-me"),t.one("animationend",function(){t.removeClass("button-see-me")}))},s.delay),i},n.utils.getCurrentTimestamp=function(){var t,e,i;return e=_.now(),t=new Date(n.settings.initialServerDate.replace(/-/g,"/")),i=e-n.settings.initialClientTimestamp,i+=n.settings.initialClientTimestamp-n.settings.initialServerTimestamp,t.setTime(t.getTime()+i),t.getTime()},n.utils.getRemainingTime=function(t){var e,i;return i=t instanceof Date?t.getTime():"string"==typeof t?new Date(t.replace(/-/g,"/")).getTime():t,e=i-n.utils.getCurrentTimestamp(),e=Math.ceil(e/1e3)},r=function(){var t,e,i;return t=document.createElement("div"),e={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},i=_.find(_.keys(e),function(e){return!_.isUndefined(t.style[e])}),i?e[i]:null}(),i=n.Class.extend({defaultActiveArguments:{duration:"fast",completeCallback:e.noop},defaultExpandedArguments:{duration:"fast",completeCallback:e.noop},containerType:"container",defaults:{title:"",description:"",priority:100,type:"default",content:null,active:!0,instanceNumber:null},initialize:function(t,s){var r=this;r.id=t,i.instanceCounter||(i.instanceCounter=0),i.instanceCounter++,e.extend(r,{params:_.defaults(s.params||s,r.defaults)}),r.params.instanceNumber||(r.params.instanceNumber=i.instanceCounter),r.notifications=new n.Notifications,r.templateSelector=r.params.templateId||"customize-"+r.containerType+"-"+r.params.type,r.container=e(r.params.content),0===r.container.length&&(r.container=e(r.getContainer())),r.headContainer=r.container,r.contentContainer=r.getContent(),r.container=r.container.add(r.contentContainer),r.deferred={embedded:new e.Deferred},r.priority=new n.Value,r.active=new n.Value,r.activeArgumentsQueue=[],r.expanded=new n.Value,r.expandedArgumentsQueue=[],r.active.bind(function(t){var i=r.activeArgumentsQueue.shift();i=e.extend({},r.defaultActiveArguments,i),t=t&&r.isContextuallyActive(),r.onChangeActive(t,i)}),r.expanded.bind(function(t){var i=r.expandedArgumentsQueue.shift();i=e.extend({},r.defaultExpandedArguments,i),r.onChangeExpanded(t,i)}),r.deferred.embedded.done(function(){r.setupNotifications(),r.attachEvents()}),n.utils.bubbleChildValueChanges(r,["priority","active"]),r.priority.set(r.params.priority),r.active.set(r.params.active),r.expanded.set(!1)},getNotificationsContainerElement:function(){return this.contentContainer.find(".customize-control-notifications-container:first")},setupNotifications:function(){var t,e=this;e.notifications.container=e.getNotificationsContainerElement(),t=function(){e.expanded.get()&&e.notifications.render()},e.expanded.bind(t),t(),e.notifications.bind("change",_.debounce(t))},ready:function(){},_children:function(t,e){var i=this,s=[];return n[e].each(function(e){e[t].get()===i.id&&s.push(e)}),s.sort(n.utils.prioritySort),s},isContextuallyActive:function(){throw new Error("Container.isContextuallyActive() must be overridden in a subclass.")},onChangeActive:function(t,i){var s,r,a=this,o=a.headContainer;if(i.unchanged)return void(i.completeCallback&&i.completeCallback());s="resolved"===n.previewer.deferred.active.state()?i.duration:0,a.extended(n.Panel)&&(n.panel.each(function(t){t!==a&&t.expanded()&&(r=t,s=0)}),t||_.each(a.sections(),function(t){t.collapse({duration:0})})),e.contains(document,o.get(0))?t?o.slideDown(s,i.completeCallback):a.expanded()?a.collapse({duration:s,completeCallback:function(){o.slideUp(s,i.completeCallback)}}):o.slideUp(s,i.completeCallback):(o.toggle(t),i.completeCallback&&i.completeCallback())},_toggleActive:function(t,e){var i=this;return e=e||{},t&&this.active.get()||!t&&!this.active.get()?(e.unchanged=!0,i.onChangeActive(i.active.get(),e),!1):(e.unchanged=!1,this.activeArgumentsQueue.push(e),this.active.set(t),!0)},activate:function(t){return this._toggleActive(!0,t)},deactivate:function(t){return this._toggleActive(!1,t)},onChangeExpanded:function(){throw new Error("Must override with subclass.")},_toggleExpanded:function(t,e){var i,s=this;return e=e||{},i=e.completeCallback,!(t&&!s.active())&&(n.state("paneVisible").set(!0),e.completeCallback=function(){i&&i.apply(s,arguments),t?s.container.trigger("expanded"):s.container.trigger("collapsed")},t&&s.expanded.get()||!t&&!s.expanded.get()?(e.unchanged=!0,s.onChangeExpanded(s.expanded.get(),e),!1):(e.unchanged=!1,s.expandedArgumentsQueue.push(e),s.expanded.set(t),!0))},expand:function(t){return this._toggleExpanded(!0,t)},collapse:function(t){return this._toggleExpanded(!1,t)},_animateChangeExpanded:function(t){if(!r)return void(t&&t());var i,s,a,o=this,h=o.contentContainer,d=h.closest(".wp-full-overlay");i=d.add(h),a=!o.panel||""===o.panel()||!!n.panel(o.panel()).contentContainer.hasClass("skip-transition"),a&&(i=i.add("#customize-info, .customize-pane-parent")),s=function(n){2===n.eventPhase&&e(n.target).is(h)&&(h.off(r,s),i.removeClass("busy"),t&&t())},h.on(r,s),i.addClass("busy"),_.defer(function(){var t=h.closest(".wp-full-overlay-sidebar-content"),e=t.scrollTop(),i=h.data("previous-scrollTop")||0,s=o.expanded();s&&0<e?(h.css("top",e+"px"),h.data("previous-scrollTop",e)):!s&&0<e+i&&(h.css("top",i-e+"px"),t.scrollTop(i))})},focus:s,getContainer:function(){var t,i=this;return t=0!==e("#tmpl-"+i.templateSelector).length?wp.template(i.templateSelector):wp.template("customize-"+i.containerType+"-default"),t&&i.container?e.trim(t(_.extend({id:i.id},i.params))):"<li></li>"},getContent:function(){var t=this,e=t.container,i=e.find(".accordion-section-content, .control-panel-content").first(),s="sub-"+e.attr("id"),r=s,n=e.attr("aria-owns");return n&&(r=r+" "+n),e.attr("aria-owns",r),i.detach().attr({id:s,"class":"customize-pane-child "+i.attr("class")+" "+e.attr("class")})}}),n.Section=i.extend({containerType:"section",containerParent:"#customize-theme-controls",containerPaneParent:".customize-pane-parent",defaults:{title:"",description:"",priority:100,type:"default",content:null,active:!0,instanceNumber:null,panel:null,customizeAction:""},initialize:function(t,s){var r,a=this;r=s.params||s,r.type||_.find(n.sectionConstructor,function(t,e){return t===a.constructor&&(r.type=e,!0)}),i.prototype.initialize.call(a,t,r),a.id=t,a.panel=new n.Value,a.panel.bind(function(t){e(a.headContainer).toggleClass("control-subsection",!!t)}),a.panel.set(a.params.panel||""),n.utils.bubbleChildValueChanges(a,["panel"]),a.embed(),a.deferred.embedded.done(function(){a.ready()})},embed:function(){var t,e=this;e.containerParent=n.ensure(e.containerParent),t=function(t){var i;t?n.panel(t,function(t){t.deferred.embedded.done(function(){i=t.contentContainer,e.headContainer.parent().is(i)||i.append(e.headContainer),e.contentContainer.parent().is(e.headContainer)||e.containerParent.append(e.contentContainer),e.deferred.embedded.resolve()})}):(i=n.ensure(e.containerPaneParent),e.headContainer.parent().is(i)||i.append(e.headContainer),e.contentContainer.parent().is(e.headContainer)||e.containerParent.append(e.contentContainer),e.deferred.embedded.resolve())},e.panel.bind(t),t(e.panel.get())},attachEvents:function(){var t,i,s=this;s.container.hasClass("cannot-expand")||(s.container.find(".accordion-section-title, .customize-section-back").on("click keydown",function(t){n.utils.isKeydownButNotEnterEvent(t)||(t.preventDefault(),s.expanded()?s.collapse():s.expand())}),s.container.find(".customize-section-title .customize-help-toggle").on("click",function(){t=s.container.find(".section-meta"),t.hasClass("cannot-expand")||(i=t.find(".customize-section-description:first"),i.toggleClass("open"),i.slideToggle(s.defaultExpandedArguments.duration,function(){i.trigger("toggled")}),e(this).attr("aria-expanded",function(t,e){return"true"===e?"false":"true"}))}))},isContextuallyActive:function(){var t=this,e=t.controls(),i=0;return _(e).each(function(t){t.active()&&(i+=1)}),0!==i},controls:function(){return this._children("section","control")},onChangeExpanded:function(t,i){var s,r,a=this,o=a.headContainer.closest(".wp-full-overlay-sidebar-content"),h=a.contentContainer,d=a.headContainer.closest(".wp-full-overlay"),c=h.find(".customize-section-back"),l=a.headContainer.find(".accordion-section-title").first();t&&!h.hasClass("open")?(s=i.unchanged?i.completeCallback:e.proxy(function(){a._animateChangeExpanded(function(){l.attr("tabindex","-1"),c.attr("tabindex","0"),c.focus(),h.css("top",""),o.scrollTop(0),i.completeCallback&&i.completeCallback()}),h.addClass("open"),d.addClass("section-open"),n.state("expandedSection").set(a)},this),i.allowMultiple||n.section.each(function(t){t!==a&&t.collapse({duration:i.duration})}),a.panel()?n.panel(a.panel()).expand({duration:i.duration,completeCallback:s}):(i.allowMultiple||n.panel.each(function(t){t.collapse()}),s())):!t&&h.hasClass("open")?(a.panel()&&(r=n.panel(a.panel()),r.contentContainer.hasClass("skip-transition")&&r.collapse()),a._animateChangeExpanded(function(){c.attr("tabindex","-1"),l.attr("tabindex","0"),l.focus(),h.css("top",""),i.completeCallback&&i.completeCallback()}),h.removeClass("open"),d.removeClass("section-open"),a===n.state("expandedSection").get()&&n.state("expandedSection").set(!1)):i.completeCallback&&i.completeCallback()}}),n.ThemesSection=n.Section.extend({currentTheme:"",overlay:"",template:"",screenshotQueue:null,$window:null,$body:null,loaded:0,loading:!1,fullyLoaded:!1,term:"",tags:"",nextTerm:"",nextTags:"",filtersHeight:0,headerContainer:null,updateCountDebounced:null,initialize:function(t,i){var s=this;s.headerContainer=e(),s.$window=e(window),s.$body=e(document.body),n.Section.prototype.initialize.call(s,t,i),s.updateCountDebounced=_.debounce(s.updateCount,500)},embed:function(){var t,e=this;t=function(t){var i;n.panel(t,function(t){t.deferred.embedded.done(function(){i=t.contentContainer,e.headContainer.parent().is(i)||i.find(".customize-themes-full-container-container").before(e.headContainer),e.contentContainer.parent().is(e.headContainer)||e.containerParent.append(e.contentContainer),e.deferred.embedded.resolve()})})},e.panel.bind(t),t(e.panel.get())},ready:function(){var t=this;t.overlay=t.container.find(".theme-overlay"),t.template=wp.template("customize-themes-details-view"),t.container.on("keydown",function(e){t.overlay.find(".theme-wrap").is(":visible")&&(39===e.keyCode&&t.nextTheme(),37===e.keyCode&&t.previousTheme(),27===e.keyCode&&(t.$body.hasClass("modal-open")?t.closeDetails():t.headerContainer.find(".customize-themes-section-title").focus(),e.stopPropagation()))}),t.renderScreenshots=_.throttle(t.renderScreenshots,100),_.bindAll(t,"renderScreenshots","loadMore","checkTerm","filtersChecked")},isContextuallyActive:function(){return this.active()},attachEvents:function(){function t(){var t=s.headerContainer.find(".customize-themes-section-title");t.toggleClass("selected",s.expanded()),t.attr("aria-expanded",s.expanded()?"true":"false"),s.expanded()||t.removeClass("details-open")}var i,s=this;s.container.find(".customize-section-back").on("click keydown",function(t){n.utils.isKeydownButNotEnterEvent(t)||(t.preventDefault(),s.collapse())}),s.headerContainer=e("#accordion-section-"+s.id),s.headerContainer.on("click",".customize-themes-section-title",function(){s.headerContainer.find(".filter-details").length&&(s.headerContainer.find(".customize-themes-section-title").toggleClass("details-open").attr("aria-expanded",function(t,e){return"true"===e?"false":"true"}),s.headerContainer.find(".filter-details").slideToggle(180)),s.expanded()||s.expand()}),s.container.on("click",".theme-actions .preview-theme",function(){n.panel("themes").loadThemePreview(e(this).data("slug"))}),s.container.on("click",".left",function(){s.previousTheme()}),s.container.on("click",".right",function(){s.nextTheme()}),s.container.on("click",".theme-backdrop, .close",function(){s.closeDetails()}),"local"===s.params.filter_type?s.container.on("input",".wp-filter-search-themes",function(t){s.filterSearch(t.currentTarget.value)}):"remote"===s.params.filter_type&&(i=_.debounce(s.checkTerm,500),s.contentContainer.on("input",".wp-filter-search",function(){n.panel("themes").expanded()&&(i(s),s.expanded()||s.expand())}),s.contentContainer.on("click",".filter-group input",function(){s.filtersChecked(),s.checkTerm(s)})),s.contentContainer.on("click",".feature-filter-toggle",function(t){var i=e(".customize-themes-full-container"),r=e(t.currentTarget);if(s.filtersHeight=r.parent().next(".filter-drawer").height(),!(0<i.scrollTop()&&(i.animate({scrollTop:0},400),r.hasClass("open"))))if(r.toggleClass("open").attr("aria-expanded",function(t,e){return"true"===e?"false":"true"}).parent().next(".filter-drawer").slideToggle(180,"linear"),r.hasClass("open")){var n=1018<window.innerWidth?50:76;s.contentContainer.find(".themes").css("margin-top",s.filtersHeight+n)}else s.contentContainer.find(".themes").css("margin-top",0)}),s.contentContainer.on("click",".no-themes-local .search-dotorg-themes",function(){n.section("wporg_themes").focus()}),s.expanded.bind(t),t(),n.bind("ready",function(){s.contentContainer=s.container.find(".customize-themes-section"),s.contentContainer.appendTo(e(".customize-themes-full-container")),s.container.add(s.headerContainer)})},onChangeExpanded:function(t,e){function i(){0===s.loaded&&s.loadThemes(),n.section.each(function(t){var i;t!==s&&"themes"===t.params.type&&(i=t.contentContainer.find(".wp-filter-search").val(),s.contentContainer.find(".wp-filter-search").val(i),""===i&&""!==s.term&&"local"!==s.params.filter_type?(s.term="",s.initializeNewQuery(s.term,s.tags)):"remote"===s.params.filter_type?s.checkTerm(s):"local"===s.params.filter_type&&s.filterSearch(i),t.collapse({duration:e.duration}))}),s.contentContainer.addClass("current-section"),r.scrollTop(),r.on("scroll",_.throttle(s.renderScreenshots,300)),r.on("scroll",_.throttle(s.loadMore,300)),e.completeCallback&&e.completeCallback(),s.updateCount()}var s=this,r=s.contentContainer.closest(".customize-themes-full-container");if(e.unchanged)return void(e.completeCallback&&e.completeCallback());t?s.panel()&&n.panel.has(s.panel())?n.panel(s.panel()).expand({duration:e.duration,completeCallback:i}):i():(s.contentContainer.removeClass("current-section"),s.headerContainer.find(".filter-details").slideUp(180),r.off("scroll"),e.completeCallback&&e.completeCallback())},getContent:function(){return this.container.find(".control-section-content")},loadThemes:function(){var t,e,i,s=this;s.loading||(e=Math.ceil(s.loaded/100)+1,t={nonce:n.settings.nonce.switch_themes,wp_customize:"on",theme_action:s.params.action,customized_theme:n.settings.theme.stylesheet,page:e},"remote"===s.params.filter_type&&(t.search=s.term,t.tags=s.tags),s.headContainer.closest(".wp-full-overlay").addClass("loading"),s.loading=!0,s.container.find(".no-themes").hide(),i=wp.ajax.post("customize_load_themes",t),i.done(function(t){var i=t.themes;if(""!==s.nextTerm||""!==s.nextTags)return s.nextTerm&&(s.term=s.nextTerm),s.nextTags&&(s.tags=s.nextTags),s.nextTerm="",s.nextTags="",s.loading=!1,void s.loadThemes();0!==i.length?(s.loadControls(i,e),1===e&&(_.each(s.controls().slice(0,3),function(t){var e,i=t.params.theme.screenshot[0];i&&(e=new Image,e.src=i)}),"local"!==s.params.filter_type&&wp.a11y.speak(n.settings.l10n.themeSearchResults.replace("%d",t.info.results))),_.delay(s.renderScreenshots,100),("local"===s.params.filter_type||100>i.length)&&(s.fullyLoaded=!0)):0===s.loaded?(s.container.find(".no-themes").show(),wp.a11y.speak(s.container.find(".no-themes").text())):s.fullyLoaded=!0,"local"===s.params.filter_type?s.updateCount():s.updateCount(t.info.results),s.container.find(".unexpected-error").hide(),s.headContainer.closest(".wp-full-overlay").removeClass("loading"),s.loading=!1}),i.fail(function(t){void 0===t?(s.container.find(".unexpected-error").show(),wp.a11y.speak(s.container.find(".unexpected-error").text())):"undefined"!=typeof console&&console.error&&console.error(t),s.headContainer.closest(".wp-full-overlay").removeClass("loading"),s.loading=!1}))},loadControls:function(t,e){var i=[],s=this;_.each(t,function(t){var e=new n.controlConstructor.theme(s.params.action+"_theme_"+t.id,{type:"theme",section:s.params.id,theme:t,priority:s.loaded+1});n.control.add(e),i.push(e),s.loaded=s.loaded+1}),1!==e&&Array.prototype.push.apply(s.screenshotQueue,i)},loadMore:function(){var t,e,i,s=this;s.fullyLoaded||s.loading||(t=s.container.closest(".customize-themes-full-container"),e=t.scrollTop()+t.height(),i=t.prop("scrollHeight")-3e3,e>i&&s.loadThemes())},filterSearch:function(t){var e,i=0,s=!1,r=this,a=n.section.has("wporg_themes")&&"remote"!==r.params.filter_type?".no-themes-local":".no-themes",o=r.controls();r.loading||(e=t.toLowerCase().trim().replace(/-/g," ").split(" "),_.each(o,function(t){(s=t.filter(e))&&(i+=1)}),0===i?(r.container.find(a).show(),wp.a11y.speak(r.container.find(a).text())):r.container.find(a).hide(),r.renderScreenshots(),n.reflowPaneContents(),r.updateCountDebounced(i))},checkTerm:function(t){var e;"remote"===t.params.filter_type&&(e=t.contentContainer.find(".wp-filter-search").val(),t.term!==e.trim()&&t.initializeNewQuery(e,t.tags))},filtersChecked:function(){var t=this,i=t.container.find(".filter-group").find(":checkbox"),s=[];_.each(i.filter(":checked"),function(t){s.push(e(t).prop("value"))}),0===s.length?(s="",t.contentContainer.find(".feature-filter-toggle .filter-count-0").show(),t.contentContainer.find(".feature-filter-toggle .filter-count-filters").hide()):(t.contentContainer.find(".feature-filter-toggle .theme-filter-count").text(s.length),t.contentContainer.find(".feature-filter-toggle .filter-count-0").hide(),t.contentContainer.find(".feature-filter-toggle .filter-count-filters").show()),_.isEqual(t.tags,s)||(t.loading?t.nextTags=s:"remote"===t.params.filter_type?t.initializeNewQuery(t.term,s):"local"===t.params.filter_type&&t.filterSearch(s.join(" ")))},initializeNewQuery:function(t,e){var i=this;_.each(i.controls(),function(t){t.container.remove(),n.control.remove(t.id)}),i.loaded=0,i.fullyLoaded=!1,i.screenshotQueue=null,i.loading?(i.nextTerm=t,i.nextTags=e):(i.term=t,i.tags=e,i.loadThemes()),i.expanded()||i.expand()},renderScreenshots:function(){var t=this;null!==t.screenshotQueue&&0!==t.screenshotQueue.length||(t.screenshotQueue=_.filter(t.controls(),function(t){return!t.screenshotRendered})),t.screenshotQueue.length&&(t.screenshotQueue=_.filter(t.screenshotQueue,function(e){var i=e.container.find(".theme-screenshot"),s=i.find("img");if(!s.length)return!1;if(s.is(":hidden"))return!0;var r=t.$window.scrollTop(),n=r+t.$window.height(),a=s.offset().top,o=i.height(),h=a+o,d=3*o,c=h>=r-d&&a<=n+d;return c&&e.container.trigger("render-screenshot"),!c}))},getVisibleCount:function(){return this.contentContainer.find("li.customize-control:visible").length},updateCount:function(t){var e,i,s=this;t||0===t||(t=s.getVisibleCount()),i=s.contentContainer.find(".themes-displayed"),e=s.contentContainer.find(".theme-count"),0===t?e.text("0"):(i.fadeOut(180,function(){e.text(t),i.fadeIn(180)}),wp.a11y.speak(n.settings.l10n.announceThemeCount.replace("%d",t)))},nextTheme:function(){var t=this;t.getNextTheme()&&t.showDetails(t.getNextTheme(),function(){t.overlay.find(".right").focus()})},getNextTheme:function(){var t,e,i,s,r=this;return t=n.control(r.params.action+"_theme_"+r.currentTheme),i=r.controls(),-1!==(s=_.indexOf(i,t))&&(!!(e=i[s+1])&&e.params.theme)},previousTheme:function(){var t=this;t.getPreviousTheme()&&t.showDetails(t.getPreviousTheme(),function(){t.overlay.find(".left").focus()})},getPreviousTheme:function(){var t,e,i,s,r=this;return t=n.control(r.params.action+"_theme_"+r.currentTheme),i=r.controls(),-1!==(s=_.indexOf(i,t))&&(!!(e=i[s-1])&&e.params.theme)},updateLimits:function(){this.getNextTheme()||this.overlay.find(".right").addClass("disabled"),this.getPreviousTheme()||this.overlay.find(".left").addClass("disabled")},loadThemePreview:function(t){return n.ThemesPanel.prototype.loadThemePreview.call(this,t)},showDetails:function(t,e){function i(){return!r.canSwitchTheme(t.id)}var s=this,r=n.panel("themes");s.currentTheme=t.id,s.overlay.html(s.template(t)).fadeIn("fast").focus(),s.overlay.find("button.preview, button.preview-theme").toggleClass("disabled",i()),s.overlay.find("button.theme-install").toggleClass("disabled",function(){return i()||!1===n.settings.theme._canInstall||!0===n.settings.theme._filesystemCredentialsNeeded}()),s.$body.addClass("modal-open"),s.containFocus(s.overlay),s.updateLimits(),wp.a11y.speak(n.settings.l10n.announceThemeDetails.replace("%s",t.name)),e&&e()},closeDetails:function(){var t=this;t.$body.removeClass("modal-open"),t.overlay.fadeOut("fast"),n.control(t.params.action+"_theme_"+t.currentTheme).container.find(".theme").focus()},containFocus:function(t){var i;t.on("keydown",function(s){if(9===s.keyCode)return i=e(":tabbable",t),i.last()[0]!==s.target||s.shiftKey?i.first()[0]===s.target&&s.shiftKey?(i.last().focus(),!1):void 0:(i.first().focus(),!1)})}}),n.OuterSection=n.Section.extend({initialize:function(){var t=this;t.containerParent="#customize-outer-theme-controls",t.containerPaneParent=".customize-outer-pane-parent",n.Section.prototype.initialize.apply(t,arguments)},onChangeExpanded:function(t,i){var s,r,a=this,o=a.headContainer.closest(".wp-full-overlay-sidebar-content"),h=a.contentContainer,d=h.find(".customize-section-back"),c=a.headContainer.find(".accordion-section-title").first(),l=e(document.body);l.toggleClass("outer-section-open",t),a.container.toggleClass("open",t),a.container.removeClass("busy"),n.section.each(function(t){"outer"===t.params.type&&t.id!==a.id&&t.container.removeClass("open")}),t&&!h.hasClass("open")?(s=i.unchanged?i.completeCallback:e.proxy(function(){a._animateChangeExpanded(function(){c.attr("tabindex","-1"),d.attr("tabindex","0"),d.focus(),h.css("top",""),o.scrollTop(0),i.completeCallback&&i.completeCallback()}),h.addClass("open")},this),a.panel()?n.panel(a.panel()).expand({duration:i.duration,completeCallback:s}):s()):!t&&h.hasClass("open")?(a.panel()&&(r=n.panel(a.panel()),r.contentContainer.hasClass("skip-transition")&&r.collapse()),a._animateChangeExpanded(function(){d.attr("tabindex","-1"),c.attr("tabindex","0"),c.focus(),h.css("top",""),i.completeCallback&&i.completeCallback()}),h.removeClass("open")):i.completeCallback&&i.completeCallback()}}),n.Panel=i.extend({containerType:"panel",initialize:function(t,e){var s,r=this;s=e.params||e,s.type||_.find(n.panelConstructor,function(t,e){return t===r.constructor&&(s.type=e,!0)}),i.prototype.initialize.call(r,t,s),r.embed(),r.deferred.embedded.done(function(){r.ready()})},embed:function(){var t=this,i=e("#customize-theme-controls"),s=e(".customize-pane-parent");t.headContainer.parent().is(s)||s.append(t.headContainer),t.contentContainer.parent().is(t.headContainer)||i.append(t.contentContainer),t.renderContent(),t.deferred.embedded.resolve()},attachEvents:function(){var t,i=this;i.headContainer.find(".accordion-section-title").on("click keydown",function(t){n.utils.isKeydownButNotEnterEvent(t)||(t.preventDefault(),i.expanded()||i.expand())}),i.container.find(".customize-panel-back").on("click keydown",function(t){n.utils.isKeydownButNotEnterEvent(t)||(t.preventDefault(),i.expanded()&&i.collapse())}),t=i.container.find(".panel-meta:first"),t.find("> .accordion-section-title .customize-help-toggle").on("click",function(){if(!t.hasClass("cannot-expand")){var s=t.find(".customize-panel-description:first");t.hasClass("open")?(t.toggleClass("open"),s.slideUp(i.defaultExpandedArguments.duration,function(){s.trigger("toggled")}),e(this).attr("aria-expanded",!1)):(s.slideDown(i.defaultExpandedArguments.duration,function(){s.trigger("toggled")}),t.toggleClass("open"),e(this).attr("aria-expanded",!0))}})},sections:function(){return this._children("panel","section")},isContextuallyActive:function(){var t=this,e=t.sections(),i=0;return _(e).each(function(t){t.active()&&t.isContextuallyActive()&&(i+=1)}),0!==i},onChangeExpanded:function(t,e){if(e.unchanged)return void(e.completeCallback&&e.completeCallback());var i,s=this,r=s.contentContainer,a=r.closest(".wp-full-overlay"),o=r.closest(".wp-full-overlay-sidebar-content"),h=s.headContainer.find(".accordion-section-title"),d=r.find(".customize-panel-back"),c=s.sections();t&&!r.hasClass("current-panel")?(n.section.each(function(t){s.id!==t.panel()&&t.collapse({duration:0})}),n.panel.each(function(t){s!==t&&t.collapse({duration:0})}),
s.params.autoExpandSoleSection&&1===c.length&&c[0].active.get()?(r.addClass("current-panel skip-transition"),a.addClass("in-sub-panel"),c[0].expand({completeCallback:e.completeCallback})):(s._animateChangeExpanded(function(){h.attr("tabindex","-1"),d.attr("tabindex","0"),d.focus(),r.css("top",""),o.scrollTop(0),e.completeCallback&&e.completeCallback()}),r.addClass("current-panel"),a.addClass("in-sub-panel")),n.state("expandedPanel").set(s)):!t&&r.hasClass("current-panel")&&(i=r.hasClass("skip-transition"),i?r.removeClass("skip-transition"):s._animateChangeExpanded(function(){h.attr("tabindex","0"),d.attr("tabindex","-1"),h.focus(),r.css("top",""),e.completeCallback&&e.completeCallback()}),a.removeClass("in-sub-panel"),r.removeClass("current-panel"),s===n.state("expandedPanel").get()&&n.state("expandedPanel").set(!1))},renderContent:function(){var t,i=this;(t=0!==e("#tmpl-"+i.templateSelector+"-content").length?wp.template(i.templateSelector+"-content"):wp.template("customize-panel-default-content"))&&i.headContainer&&i.contentContainer.html(t(_.extend({id:i.id},i.params)))}}),n.ThemesPanel=n.Panel.extend({initialize:function(t,e){var i=this;i.installingThemes=[],n.Panel.prototype.initialize.call(i,t,e)},canSwitchTheme:function(t){return!(!t||t!==n.settings.theme.stylesheet)||"publish"===n.state("selectedChangesetStatus").get()&&(""===n.state("changesetStatus").get()||"auto-draft"===n.state("changesetStatus").get())},attachEvents:function(){function t(){i.canSwitchTheme()?i.notifications.remove("theme_switch_unavailable"):i.notifications.add(new n.Notification("theme_switch_unavailable",{message:n.l10n.themePreviewUnavailable,type:"warning"}))}var i=this;n.Panel.prototype.attachEvents.apply(i),n.settings.theme._canInstall&&n.settings.theme._filesystemCredentialsNeeded&&i.notifications.add(new n.Notification("theme_install_unavailable",{message:n.l10n.themeInstallUnavailable,type:"info",dismissible:!0})),t(),n.state("selectedChangesetStatus").bind(t),n.state("changesetStatus").bind(t),i.contentContainer.on("click",".customize-theme",function(){i.collapse()}),i.contentContainer.on("click",".customize-themes-section-title, .customize-themes-mobile-back",function(){e(".wp-full-overlay").toggleClass("showing-themes")}),i.contentContainer.on("click",".theme-install",function(t){i.installTheme(t)}),i.contentContainer.on("click",".update-theme, #update-theme",function(t){t.preventDefault(),t.stopPropagation(),i.updateTheme(t)}),i.contentContainer.on("click",".delete-theme",function(t){i.deleteTheme(t)}),_.bindAll(i,"installTheme","updateTheme")},onChangeExpanded:function(t,e){var i,s,r=this,a=!1;if(n.Panel.prototype.onChangeExpanded.apply(this,[t,e]),e.unchanged)return void(e.completeCallback&&e.completeCallback());i=r.headContainer.closest(".wp-full-overlay"),t?(i.addClass("in-themes-panel").delay(200).find(".customize-themes-full-container").addClass("animate"),_.delay(function(){i.addClass("themes-panel-expanded")},200),600<window.innerWidth&&(s=r.sections(),_.each(s,function(t){t.expanded()&&(a=!0)}),!a&&s.length>0&&s[0].expand())):i.removeClass("in-themes-panel themes-panel-expanded").find(".customize-themes-full-container").removeClass("animate")},installTheme:function(t){var i,s,r,a=this,o=e(t.target).data("slug"),h=e.Deferred();return i=e(t.target).hasClass("preview"),n.settings.theme._filesystemCredentialsNeeded?(h.reject({errorCode:"theme_install_unavailable"}),h.promise()):a.canSwitchTheme(o)?_.contains(a.installingThemes,o)?(h.reject({errorCode:"theme_already_installing"}),h.promise()):(wp.updates.maybeRequestFilesystemCredentials(t),s=function(t){var e,s=!1;if(i)n.notifications.remove("theme_installing"),a.loadThemePreview(o);else{if(n.control.each(function(e){"theme"===e.params.type&&e.params.theme.id===t.slug&&(s=e.params.theme,e.rerenderAsInstalled(!0))}),!s||n.control.has("installed_theme_"+s.id))return void h.resolve(t);s.type="installed",e=new n.controlConstructor.theme("installed_theme_"+s.id,{type:"theme",section:"installed_themes",theme:s,priority:0}),n.control.add(e),n.control(e.id).container.trigger("render-screenshot"),n.section.each(function(t){"themes"===t.params.type&&s.id===t.currentTheme&&t.closeDetails()})}h.resolve(t)},a.installingThemes.push(o),r=wp.updates.installTheme({slug:o}),i&&n.notifications.add(new n.OverlayNotification("theme_installing",{message:n.l10n.themeDownloading,type:"info",loading:!0})),r.done(s),r.fail(function(){n.notifications.remove("theme_installing")}),h.promise()):(h.reject({errorCode:"theme_switch_unavailable"}),h.promise())},loadThemePreview:function(t){var i,s,r,a=this,o=e.Deferred();return a.canSwitchTheme(t)?(s=document.createElement("a"),s.href=location.href,r=_.extend(n.utils.parseQueryString(s.search.substr(1)),{theme:t,changeset_uuid:n.settings.changeset.uuid,"return":n.settings.url["return"]}),n.state("saved").get()||(r.customize_autosaved="on"),s.search=e.param(r),n.notifications.add(new n.OverlayNotification("theme_previewing",{message:n.l10n.themePreviewWait,type:"info",loading:!0})),i=function(){var t;n.state("processing").get()>0||(n.state("processing").unbind(i),t=n.requestChangesetUpdate({},{autosave:!0}),t.done(function(){o.resolve(),e(window).off("beforeunload.customize-confirm"),location.replace(s.href)}),t.fail(function(){n.notifications.remove("theme_previewing"),o.reject()}))},0===n.state("processing").get()?i():n.state("processing").bind(i),o.promise()):(o.reject({errorCode:"theme_switch_unavailable"}),o.promise())},updateTheme:function(t){wp.updates.maybeRequestFilesystemCredentials(t),e(document).one("wp-theme-update-success",function(t,e){n.control.each(function(t){"theme"===t.params.type&&t.params.theme.id===e.slug&&(t.params.theme.hasUpdate=!1,t.params.theme.version=e.newVersion,setTimeout(function(){t.rerenderAsInstalled(!0)},2e3))})}),wp.updates.updateTheme({slug:e(t.target).closest(".notice").data("slug")})},deleteTheme:function(t){var i,s;i=e(t.target).data("slug"),s=n.section("installed_themes"),t.preventDefault(),n.settings.theme._filesystemCredentialsNeeded||window.confirm(n.settings.l10n.confirmDeleteTheme)&&(wp.updates.maybeRequestFilesystemCredentials(t),e(document).one("wp-theme-delete-success",function(){var t=n.control("installed_theme_"+i);t.container.remove(),n.control.remove(t.id),s.loaded=s.loaded-1,s.updateCount(),n.control.each(function(t){"theme"===t.params.type&&t.params.theme.id===i&&t.rerenderAsInstalled(!1)})}),wp.updates.deleteTheme({slug:i}),s.closeDetails(),s.focus())}}),n.Control=n.Class.extend({defaultActiveArguments:{duration:"fast",completeCallback:e.noop},defaults:{label:"",description:"",active:!0,priority:10},initialize:function(t,i){var s,r,a=this,o=[];a.params=_.extend({},a.defaults,a.params||{},i.params||i||{}),n.Control.instanceCounter||(n.Control.instanceCounter=0),n.Control.instanceCounter++,a.params.instanceNumber||(a.params.instanceNumber=n.Control.instanceCounter),a.params.type||_.find(n.controlConstructor,function(t,e){return t===a.constructor&&(a.params.type=e,!0)}),a.params.content||(a.params.content=e("<li></li>",{id:"customize-control-"+t.replace(/]/g,"").replace(/\[/g,"-"),"class":"customize-control customize-control-"+a.params.type})),a.id=t,a.selector="#customize-control-"+t.replace(/\]/g,"").replace(/\[/g,"-"),a.params.content?a.container=e(a.params.content):a.container=e(a.selector),a.params.templateId?a.templateSelector=a.params.templateId:a.templateSelector="customize-control-"+a.params.type+"-content",a.deferred=_.extend(a.deferred||{},{embedded:new e.Deferred}),a.section=new n.Value,a.priority=new n.Value,a.active=new n.Value,a.activeArgumentsQueue=[],a.notifications=new n.Notifications({alt:a.altNotice}),a.elements=[],a.active.bind(function(t){var i=a.activeArgumentsQueue.shift();i=e.extend({},a.defaultActiveArguments,i),a.onChangeActive(t,i)}),a.section.set(a.params.section),a.priority.set(isNaN(a.params.priority)?10:a.params.priority),a.active.set(a.params.active),n.utils.bubbleChildValueChanges(a,["section","priority","active"]),a.settings={},s={},a.params.setting&&(s["default"]=a.params.setting),_.extend(s,a.params.settings),_.each(s,function(t,e){var i;_.isObject(t)&&_.isFunction(t.extended)&&t.extended(n.Value)?a.settings[e]=t:_.isString(t)&&(i=n(t),i?a.settings[e]=i:o.push(t))}),r=function(){_.each(s,function(t,e){!a.settings[e]&&_.isString(t)&&(a.settings[e]=n(t))}),a.settings[0]&&!a.settings["default"]&&(a.settings["default"]=a.settings[0]),a.setting=a.settings["default"]||null,a.linkElements(),a.embed()},0===o.length?r():n.apply(n,o.concat(r)),a.deferred.embedded.done(function(){a.linkElements(),a.setupNotifications(),a.ready()})},linkElements:function(){var t,i,s,r=this;t=r.container.find("[data-customize-setting-link], [data-customize-setting-key-link]"),i={},t.each(function(){var a,o,h=e(this);if(!h.data("customizeSettingLinked")){if(h.data("customizeSettingLinked",!0),h.is(":radio")){if(a=h.prop("name"),i[a])return;i[a]=!0,h=t.filter('[name="'+a+'"]')}h.data("customizeSettingLink")?o=n(h.data("customizeSettingLink")):h.data("customizeSettingKeyLink")&&(o=r.settings[h.data("customizeSettingKeyLink")]),o&&(s=new n.Element(h),r.elements.push(s),s.sync(o),s.set(o()))}})},embed:function(){var t,e=this;t=function(t){var i;t&&n.section(t,function(t){t.deferred.embedded.done(function(){i=t.contentContainer.is("ul")?t.contentContainer:t.contentContainer.find("ul:first"),e.container.parent().is(i)||(i.append(e.container),e.renderContent()),e.deferred.embedded.resolve()})})},e.section.bind(t),t(e.section.get())},ready:function(){var t,i=this;"dropdown-pages"===i.params.type&&i.params.allow_addition&&(t=i.container.find(".new-content-item"),t.hide(),i.container.on("click",".add-new-toggle",function(i){e(i.currentTarget).slideUp(180),t.slideDown(180),t.find(".create-item-input").focus()}),i.container.on("click",".add-content",function(){i.addNewPage()}),i.container.on("keydown",".create-item-input",function(t){13===t.which&&i.addNewPage()}))},getNotificationsContainerElement:function(){var t,i,s=this;return i=s.container.find(".customize-control-notifications-container:first"),i.length?i:(i=e('<div class="customize-control-notifications-container"></div>'),s.container.hasClass("customize-control-nav_menu_item")?s.container.find(".menu-item-settings:first").prepend(i):s.container.hasClass("customize-control-widget_form")?s.container.find(".widget-inside:first").prepend(i):(t=s.container.find(".customize-control-title"),t.length?t.after(i):s.container.prepend(i)),i)},setupNotifications:function(){var t,e,i=this;_.each(i.settings,function(t){t.notifications&&(t.notifications.bind("add",function(e){var s=_.extend({},e,{setting:t.id});i.notifications.add(new n.Notification(t.id+":"+e.code,s))}),t.notifications.bind("remove",function(e){i.notifications.remove(t.id+":"+e.code)}))}),t=function(){var t=i.section();(!t||n.section.has(t)&&n.section(t).expanded())&&i.notifications.render()},i.notifications.bind("rendered",function(){var t=i.notifications.get();i.container.toggleClass("has-notifications",0!==t.length),i.container.toggleClass("has-error",0!==_.where(t,{type:"error"}).length)}),e=function(e,i){i&&n.section.has(i)&&n.section(i).expanded.unbind(t),e&&n.section(e,function(e){e.expanded.bind(t),t()})},i.section.bind(e),e(i.section.get()),i.notifications.bind("change",_.debounce(t))},renderNotifications:function(){var t,i,s=this,r=!1;"undefined"!=typeof console&&console.warn&&console.warn("[DEPRECATED] wp.customize.Control.prototype.renderNotifications() is deprecated in favor of instantating a wp.customize.Notifications and calling its render() method."),(t=s.getNotificationsContainerElement())&&t.length&&(i=[],s.notifications.each(function(t){i.push(t),"error"===t.type&&(r=!0)}),0===i.length?t.stop().slideUp("fast"):t.stop().slideDown("fast",null,function(){e(this).css("height","auto")}),s.notificationsTemplate||(s.notificationsTemplate=wp.template("customize-control-notifications")),s.container.toggleClass("has-notifications",0!==i.length),s.container.toggleClass("has-error",r),t.empty().append(e.trim(s.notificationsTemplate({notifications:i,altNotice:Boolean(s.altNotice)}))))},expand:function(t){n.section(this.section()).expand(t)},focus:s,onChangeActive:function(t,i){if(i.unchanged)return void(i.completeCallback&&i.completeCallback());e.contains(document,this.container[0])?t?this.container.slideDown(i.duration,i.completeCallback):this.container.slideUp(i.duration,i.completeCallback):(this.container.toggle(t),i.completeCallback&&i.completeCallback())},toggle:function(t){return this.onChangeActive(t,this.defaultActiveArguments)},activate:i.prototype.activate,deactivate:i.prototype.deactivate,_toggleActive:i.prototype._toggleActive,dropdownInit:function(){var t=this,e=this.container.find(".dropdown-status"),i=this.params,s=!1,r=function(t){"string"==typeof t&&i.statuses&&i.statuses[t]?e.html(i.statuses[t]).show():e.hide()};this.container.on("click keydown",".dropdown",function(e){n.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),s||t.container.toggleClass("open"),t.container.hasClass("open")&&t.container.parent().parent().find("li.library-selected").focus(),s=!0,setTimeout(function(){s=!1},400))}),this.setting.bind(r),r(this.setting())},renderContent:function(){var t,e,i,s,r=this;e=["button","checkbox","date","datetime-local","email","month","number","password","radio","range","search","select","tel","time","text","textarea","week","url"],i=r.templateSelector,i==="customize-control-"+r.params.type+"-content"&&_.contains(e,r.params.type)&&!document.getElementById("tmpl-"+i)&&0===r.container.children().length&&(i="customize-control-default-content"),document.getElementById("tmpl-"+i)&&(t=wp.template(i))&&r.container&&r.container.html(t(r.params)),r.notifications.container=r.getNotificationsContainerElement(),(!(s=r.section())||n.section.has(s)&&n.section(s).expanded())&&r.notifications.render()},addNewPage:function(){var t,i,s,r,a,o,h=this;if("dropdown-pages"===h.params.type&&h.params.allow_addition&&n.Menus){if(i=h.container.find(".add-new-toggle"),s=h.container.find(".new-content-item"),r=h.container.find(".create-item-input"),a=r.val(),o=h.container.find("select"),!a)return void r.addClass("invalid");r.removeClass("invalid"),r.attr("disabled","disabled"),t=n.Menus.insertAutoDraftPost({post_title:a,post_type:"page"}),t.done(function(t){var r,d,c;r=new n.Menus.AvailableItemModel({id:"post-"+t.post_id,title:a,type:"post_type",type_label:n.Menus.data.l10n.page_label,object:"page",object_id:t.post_id,url:t.url}),n.Menus.availableMenuItemsPanel.collection.add(r),d=e("#available-menu-items-post_type-page").find(".available-menu-items-list"),c=wp.template("available-menu-item"),d.prepend(c(r.attributes)),o.focus(),h.setting.set(String(t.post_id)),s.slideUp(180),i.slideDown(180)}),t.always(function(){r.val("").removeAttr("disabled")})}}}),n.ColorControl=n.Control.extend({ready:function(){var t,e=this,i="hue"===this.params.mode,s=!1;i?(t=this.container.find(".color-picker-hue"),t.val(e.setting()).wpColorPicker({change:function(t,i){s=!0,e.setting(i.color.h()),s=!1}})):(t=this.container.find(".color-picker-hex"),t.val(e.setting()).wpColorPicker({change:function(){s=!0,e.setting.set(t.wpColorPicker("color")),s=!1},clear:function(){s=!0,e.setting.set(""),s=!1}})),e.setting.bind(function(e){s||(t.val(e),t.wpColorPicker("color",e))}),e.container.on("keydown",function(i){var s;27===i.which&&(s=e.container.find(".wp-picker-container"),s.hasClass("wp-picker-active")&&(t.wpColorPicker("close"),e.container.find(".wp-color-result").focus(),i.stopPropagation()))})}}),n.MediaControl=n.Control.extend({ready:function(){function t(t){var s=e.Deferred();i.extended(n.UploadControl)?s.resolve():(t=parseInt(t,10),_.isNaN(t)||t<=0?(delete i.params.attachment,s.resolve()):i.params.attachment&&i.params.attachment.id===t&&s.resolve()),"pending"===s.state()&&wp.media.attachment(t).fetch().done(function(){i.params.attachment=this.attributes,s.resolve(),wp.customize.previewer.send(i.setting.id+"-attachment-data",this.attributes)}),s.done(function(){i.renderContent()})}var i=this;_.bindAll(i,"restoreDefault","removeFile","openFrame","select","pausePlayer"),i.container.on("click keydown",".upload-button",i.openFrame),i.container.on("click keydown",".upload-button",i.pausePlayer),i.container.on("click keydown",".thumbnail-image img",i.openFrame),i.container.on("click keydown",".default-button",i.restoreDefault),i.container.on("click keydown",".remove-button",i.pausePlayer),i.container.on("click keydown",".remove-button",i.removeFile),i.container.on("click keydown",".remove-button",i.cleanupPlayer),n.section(i.section()).container.on("expanded",function(){i.player&&i.player.setControlsSize()}).on("collapsed",function(){i.pausePlayer()}),t(i.setting()),i.setting.bind(t)},pausePlayer:function(){this.player&&this.player.pause()},cleanupPlayer:function(){this.player&&wp.media.mixin.removePlayer(this.player)},openFrame:function(t){n.utils.isKeydownButNotEnterEvent(t)||(t.preventDefault(),this.frame||this.initFrame(),this.frame.open())},initFrame:function(){this.frame=wp.media({button:{text:this.params.button_labels.frame_button},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:this.params.mime_type}),multiple:!1,date:!1})]}),this.frame.on("select",this.select)},select:function(){var t,e=this.frame.state().get("selection").first().toJSON(),i=window._wpmejsSettings||{};this.params.attachment=e,this.setting(e.id),t=this.container.find("audio, video").get(0),t?this.player=new MediaElementPlayer(t,i):this.cleanupPlayer()},restoreDefault:function(t){n.utils.isKeydownButNotEnterEvent(t)||(t.preventDefault(),this.params.attachment=this.params.defaultAttachment,this.setting(this.params.defaultAttachment.url))},removeFile:function(t){n.utils.isKeydownButNotEnterEvent(t)||(t.preventDefault(),this.params.attachment={},this.setting(""),this.renderContent())}}),n.UploadControl=n.MediaControl.extend({select:function(){var t,e=this.frame.state().get("selection").first().toJSON(),i=window._wpmejsSettings||{};this.params.attachment=e,this.setting(e.url),t=this.container.find("audio, video").get(0),t?this.player=new MediaElementPlayer(t,i):this.cleanupPlayer()},success:function(){},removerVisibility:function(){}}),n.ImageControl=n.UploadControl.extend({thumbnailSrc:function(){}}),n.BackgroundControl=n.UploadControl.extend({ready:function(){n.UploadControl.prototype.ready.apply(this,arguments)},select:function(){n.UploadControl.prototype.select.apply(this,arguments),wp.ajax.post("custom-background-add",{nonce:_wpCustomizeBackground.nonces.add,wp_customize:"on",customize_theme:n.settings.theme.stylesheet,attachment_id:this.params.attachment.id})}}),n.BackgroundPositionControl=n.Control.extend({ready:function(){var t,i=this;i.container.on("change",'input[name="background-position"]',function(){var t=e(this).val().split(" ");i.settings.x(t[0]),i.settings.y(t[1])}),t=_.debounce(function(){var t,e,s,r;t=i.settings.x.get(),e=i.settings.y.get(),r=String(t)+" "+String(e),s=i.container.find('input[name="background-position"][value="'+r+'"]'),s.click()}),i.settings.x.bind(t),i.settings.y.bind(t),t()}}),n.CroppedImageControl=n.MediaControl.extend({openFrame:function(t){n.utils.isKeydownButNotEnterEvent(t)||(this.initFrame(),this.frame.setState("library").open())},initFrame:function(){var t=_wpMediaViewsL10n;this.frame=wp.media({button:{text:t.select,close:!1},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:this.params.width,suggestedHeight:this.params.height}),new wp.media.controller.CustomizeImageCropper({imgSelectOptions:this.calculateImageSelectOptions,control:this})]}),this.frame.on("select",this.onSelect,this),this.frame.on("cropped",this.onCropped,this),this.frame.on("skippedcrop",this.onSkippedCrop,this)},onSelect:function(){var t=this.frame.state().get("selection").first().toJSON();this.params.width!==t.width||this.params.height!==t.height||this.params.flex_width||this.params.flex_height?this.frame.setState("cropper"):(this.setImageFromAttachment(t),this.frame.close())},onCropped:function(t){this.setImageFromAttachment(t)},calculateImageSelectOptions:function(t,e){var i,s,r,n=e.get("control"),a=!!parseInt(n.params.flex_width,10),o=!!parseInt(n.params.flex_height,10),h=t.get("width"),d=t.get("height"),c=parseInt(n.params.width,10),l=parseInt(n.params.height,10),u=c/l,p=c,m=l;return e.set("canSkipCrop",!n.mustBeCropped(a,o,c,l,h,d)),h/d>u?(l=d,c=l*u):(c=h,l=c/u),i=(h-c)/2,s=(d-l)/2,r={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:h,imageHeight:d,minWidth:p>c?c:p,minHeight:m>l?l:m,x1:i,y1:s,x2:c+i,y2:l+s},!1===o&&!1===a&&(r.aspectRatio=c+":"+l),!0===o&&(delete r.minHeight,r.maxWidth=h),!0===a&&(delete r.minWidth,r.maxHeight=d),r},mustBeCropped:function(t,e,i,s,r,n){return(!0!==t||!0!==e)&&((!0!==t||s!==n)&&((!0!==e||i!==r)&&((i!==r||s!==n)&&!(r<=i))))},onSkippedCrop:function(){var t=this.frame.state().get("selection").first().toJSON();this.setImageFromAttachment(t)},setImageFromAttachment:function(t){this.params.attachment=t,this.setting(t.id)}}),n.SiteIconControl=n.CroppedImageControl.extend({initFrame:function(){var t=_wpMediaViewsL10n;this.frame=wp.media({button:{text:t.select,close:!1},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:this.params.width,suggestedHeight:this.params.height}),new wp.media.controller.SiteIconCropper({imgSelectOptions:this.calculateImageSelectOptions,control:this})]}),this.frame.on("select",this.onSelect,this),this.frame.on("cropped",this.onCropped,this),this.frame.on("skippedcrop",this.onSkippedCrop,this)},onSelect:function(){var t=this.frame.state().get("selection").first().toJSON(),e=this;this.params.width!==t.width||this.params.height!==t.height||this.params.flex_width||this.params.flex_height?this.frame.setState("cropper"):wp.ajax.post("crop-image",{nonce:t.nonces.edit,id:t.id,context:"site-icon",cropDetails:{x1:0,y1:0,width:this.params.width,height:this.params.height,dst_width:this.params.width,dst_height:this.params.height}}).done(function(t){e.setImageFromAttachment(t),e.frame.close()}).fail(function(){e.frame.trigger("content:error:crop")})},setImageFromAttachment:function(t){var i,s,r=["site_icon-32","thumbnail","full"];_.each(r,function(e){s||_.isUndefined(t.sizes[e])||(s=t.sizes[e])}),this.params.attachment=t,this.setting(t.id),s&&(i=e('link[rel="icon"][sizes="32x32"]'),i.attr("href",s.url))},removeFile:function(t){n.utils.isKeydownButNotEnterEvent(t)||(t.preventDefault(),this.params.attachment={},this.setting(""),this.renderContent(),e('link[rel="icon"][sizes="32x32"]').attr("href","/favicon.ico"))}}),n.HeaderControl=n.Control.extend({ready:function(){this.btnRemove=e("#customize-control-header_image .actions .remove"),this.btnNew=e("#customize-control-header_image .actions .new"),_.bindAll(this,"openMedia","removeImage"),this.btnNew.on("click",this.openMedia),this.btnRemove.on("click",this.removeImage),n.HeaderTool.currentHeader=this.getInitialHeaderImage(),new n.HeaderTool.CurrentView({model:n.HeaderTool.currentHeader,el:"#customize-control-header_image .current .container"}),new n.HeaderTool.ChoiceListView({collection:n.HeaderTool.UploadsList=new n.HeaderTool.ChoiceList,el:"#customize-control-header_image .choices .uploaded .list"}),new n.HeaderTool.ChoiceListView({collection:n.HeaderTool.DefaultsList=new n.HeaderTool.DefaultsList,el:"#customize-control-header_image .choices .default .list"}),n.HeaderTool.combinedList=n.HeaderTool.CombinedList=new n.HeaderTool.CombinedList([n.HeaderTool.UploadsList,n.HeaderTool.DefaultsList]),wp.media.controller.Cropper.prototype.defaults.doCropArgs.wp_customize="on",wp.media.controller.Cropper.prototype.defaults.doCropArgs.customize_theme=n.settings.theme.stylesheet},getInitialHeaderImage:function(){if(!n.get().header_image||!n.get().header_image_data||_.contains(["remove-header","random-default-image","random-uploaded-image"],n.get().header_image))return new n.HeaderTool.ImageModel;var t=_.find(_wpCustomizeHeader.uploads,function(t){return t.attachment_id===n.get().header_image_data.attachment_id});return t||(t={url:n.get().header_image,thumbnail_url:n.get().header_image,attachment_id:n.get().header_image_data.attachment_id}),new n.HeaderTool.ImageModel({header:t,choice:t.url.split("/").pop()})},calculateImageSelectOptions:function(t,e){var i,s,r,a,o,h,d=parseInt(_wpCustomizeHeader.data.width,10),c=parseInt(_wpCustomizeHeader.data.height,10),l=!!parseInt(_wpCustomizeHeader.data["flex-width"],10),u=!!parseInt(_wpCustomizeHeader.data["flex-height"],10);return o=t.get("width"),a=t.get("height"),this.headerImage=new n.HeaderTool.ImageModel,this.headerImage.set({themeWidth:d,themeHeight:c,themeFlexWidth:l,themeFlexHeight:u,imageWidth:o,imageHeight:a}),e.set("canSkipCrop",!this.headerImage.shouldBeCropped()),i=d/c,s=o,r=a,s/r>i?(c=r,d=c*i):(d=s,c=d/i),h={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:o,imageHeight:a,x1:0,y1:0,x2:d,y2:c},!1===u&&!1===l&&(h.aspectRatio=d+":"+c),!1===u&&(h.maxHeight=c),!1===l&&(h.maxWidth=d),h},openMedia:function(t){var e=_wpMediaViewsL10n;t.preventDefault(),this.frame=wp.media({button:{text:e.selectAndCrop,close:!1},states:[new wp.media.controller.Library({title:e.chooseImage,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:_wpCustomizeHeader.data.width,suggestedHeight:_wpCustomizeHeader.data.height}),new wp.media.controller.Cropper({imgSelectOptions:this.calculateImageSelectOptions})]}),this.frame.on("select",this.onSelect,this),this.frame.on("cropped",this.onCropped,this),this.frame.on("skippedcrop",this.onSkippedCrop,this),this.frame.open()},onSelect:function(){this.frame.setState("cropper")},onCropped:function(t){var e=t.url,i=t.attachment_id,s=t.width,r=t.height;this.setImageFromURL(e,i,s,r)},onSkippedCrop:function(t){var e=t.get("url"),i=t.get("width"),s=t.get("height");this.setImageFromURL(e,t.id,i,s)},setImageFromURL:function(t,e,i,s){var r,a={};a.url=t,a.thumbnail_url=t,a.timestamp=_.now(),e&&(a.attachment_id=e),i&&(a.width=i),s&&(a.height=s),r=new n.HeaderTool.ImageModel({header:a,choice:t.split("/").pop()}),n.HeaderTool.UploadsList.add(r),n.HeaderTool.currentHeader.set(r.toJSON()),r.save(),r.importImage()},removeImage:function(){n.HeaderTool.currentHeader.trigger("hide"),n.HeaderTool.CombinedList.trigger("control:removeImage")}}),n.ThemeControl=n.Control.extend({touchDrag:!1,screenshotRendered:!1,ready:function(){function t(){return!a.canSwitchTheme(r.params.theme.id)}function i(){return t()||!1===n.settings.theme._canInstall||!0===n.settings.theme._filesystemCredentialsNeeded}function s(){r.container.find("button.preview, button.preview-theme").toggleClass("disabled",t()),r.container.find("button.theme-install").toggleClass("disabled",i())}var r=this,a=n.panel("themes");n.state("selectedChangesetStatus").bind(s),n.state("changesetStatus").bind(s),s(),r.container.on("touchmove",".theme",function(){r.touchDrag=!0}),r.container.on("click keydown touchend",".theme",function(t){var i;if(!n.utils.isKeydownButNotEnterEvent(t))return!0===r.touchDrag?r.touchDrag=!1:void(e(t.target).is(".theme-actions .button, .update-theme")||(t.preventDefault(),i=n.section(r.section()),i.showDetails(r.params.theme,function(){n.settings.theme._filesystemCredentialsNeeded&&i.overlay.find(".theme-actions .delete-theme").remove()})))}),r.container.on("render-screenshot",function(){var t=e(this).find("img"),i=t.data("src");i&&t.attr("src",i),r.screenshotRendered=!0})},filter:function(t){var e=this,i=0,s=e.params.theme.name+" "+e.params.theme.description+" "+e.params.theme.tags+" "+e.params.theme.author+" ";return s=s.toLowerCase().replace("-"," "),_.isArray(t)||(t=[t]),e.params.theme.name.toLowerCase()===t.join(" ")?i=100:(i+=10*(s.split(t.join(" ")).length-1),_.each(t,function(t){i+=2*(s.split(t+" ").length-1),i=i+s.split(t).length-1}),i>99&&(i=99)),0!==i?(e.activate(),e.params.priority=101-i,!0):(e.deactivate(),e.params.priority=101,!1)},rerenderAsInstalled:function(t){var e,i=this;t?i.params.theme.type="installed":(e=n.section(i.params.section),i.params.theme.type=e.params.action),i.renderContent(),i.container.trigger("render-screenshot")}}),n.CodeEditorControl=n.Control.extend({initialize:function(t,i){var s=this;s.deferred=_.extend(s.deferred||{},{codemirror:e.Deferred()}),n.Control.prototype.initialize.call(s,t,i),s.notifications.bind("add",function(t){t.code===s.setting.id+":csslint_error"&&(t.templateId="customize-code-editor-lint-error-notification",t.render=function(t){return function(){var e=t.call(this);return e.find("input[type=checkbox]").on("click",function(){s.setting.notifications.remove("csslint_error")}),e}}(t.render))})},ready:function(){var t=this;if(!t.section())return void t.initEditor();n.section(t.section(),function(e){e.deferred.embedded.done(function(){var i;e.expanded()?t.initEditor():(i=function(s){s&&(t.initEditor(),e.expanded.unbind(i))},e.expanded.bind(i))})})},initEditor:function(){var t,e=this,i=!1;wp.codeEditor&&(_.isUndefined(e.params.editor_settings)||!1!==e.params.editor_settings)&&(i=wp.codeEditor.defaultSettings?_.clone(wp.codeEditor.defaultSettings):{},i.codemirror=_.extend({},i.codemirror,{indentUnit:2,tabSize:2}),_.isObject(e.params.editor_settings)&&_.each(e.params.editor_settings,function(t,e){_.isObject(t)&&(i[e]=_.extend({},i[e],t))})),t=new n.Element(e.container.find("textarea")),e.elements.push(t),t.sync(e.setting),t.set(e.setting()),i?e.initSyntaxHighlightingEditor(i):e.initPlainTextareaEditor()},focus:function(t){var e,i=this,s=_.extend({},t);e=s.completeCallback,s.completeCallback=function(){e&&e(),i.editor&&i.editor.codemirror.focus()},n.Control.prototype.focus.call(i,s)},initSyntaxHighlightingEditor:function(t){var i,s=this,r=s.container.find("textarea"),n=!1;i=_.extend({},t,{onTabNext:_.bind(s.onTabNext,s),onTabPrevious:_.bind(s.onTabPrevious,s),onUpdateErrorNotice:_.bind(s.onUpdateErrorNotice,s)}),s.editor=wp.codeEditor.initialize(r,i),e(s.editor.codemirror.display.lineDiv).attr({role:"textbox","aria-multiline":"true","aria-label":s.params.label,"aria-describedby":"editor-keyboard-trap-help-1 editor-keyboard-trap-help-2 editor-keyboard-trap-help-3 editor-keyboard-trap-help-4"}),s.container.find("label").on("click",function(){s.editor.codemirror.focus()}),s.editor.codemirror.on("change",function(t){n=!0,r.val(t.getValue()).trigger("change"),n=!1}),s.setting.bind(function(t){n||s.editor.codemirror.setValue(t)}),s.editor.codemirror.on("keydown",function(t,e){27===e.keyCode&&e.stopPropagation()}),s.deferred.codemirror.resolveWith(s,[s.editor.codemirror])},onTabNext:function(){var t,i,s,r=this;s=n.section(r.section()),t=s.controls(),i=t.indexOf(r),t.length===i+1?e("#customize-footer-actions .collapse-sidebar").focus():t[i+1].container.find(":focusable:first").focus()},onTabPrevious:function(){var t,e,i,s=this;i=n.section(s.section()),t=i.controls(),e=t.indexOf(s),0===e?i.contentContainer.find(".customize-section-title .customize-help-toggle, .customize-section-title .customize-section-description.open .section-description-close").last().focus():t[e-1].contentContainer.find(":focusable:first").focus()},onUpdateErrorNotice:function(t){var e,i=this;i.setting.notifications.remove("csslint_error"),0!==t.length&&(e=1===t.length?n.l10n.customCssError.singular.replace("%d","1"):n.l10n.customCssError.plural.replace("%d",String(t.length)),i.setting.notifications.add(new n.Notification("csslint_error",{message:e,type:"error"})))},initPlainTextareaEditor:function(){var t=this,e=t.container.find("textarea"),i=e[0];e.on("blur",function(){e.data("next-tab-blurs",!1)}),e.on("keydown",function(t){var s,r,n;if(27===t.keyCode)return void(e.data("next-tab-blurs")||(e.data("next-tab-blurs",!0),t.stopPropagation()))
;9!==t.keyCode||t.ctrlKey||t.altKey||t.shiftKey||e.data("next-tab-blurs")||(s=i.selectionStart,r=i.selectionEnd,n=i.value,s>=0&&(i.value=n.substring(0,s).concat("\t",n.substring(r)),e.selectionStart=i.selectionEnd=s+1),t.stopPropagation(),t.preventDefault())}),t.deferred.codemirror.rejectWith(t)}}),n.DateTimeControl=n.Control.extend({ready:function(){var t=this;if(t.inputElements={},t.invalidDate=!1,_.bindAll(t,"populateSetting","updateDaysForMonth","populateDateInputs"),!t.setting)throw new Error("Missing setting");t.container.find(".date-input").each(function(){var i,s,r=e(this);i=r.data("component"),s=new n.Element(r),t.inputElements[i]=s,t.elements.push(s),r.on("change",function(){t.invalidDate&&t.notifications.add(new n.Notification("invalid_date",{message:n.l10n.invalidDate}))}),r.on("input",_.debounce(function(){t.invalidDate||t.notifications.remove("invalid_date")})),r.on("blur",_.debounce(function(){t.invalidDate||t.populateDateInputs()}))}),t.inputElements.month.bind(t.updateDaysForMonth),t.inputElements.year.bind(t.updateDaysForMonth),t.populateDateInputs(),t.setting.bind(t.populateDateInputs),_.each(t.inputElements,function(e){e.bind(t.populateSetting)})},parseDateTime:function(t){var e,i,s=this;return t&&(e=t.match(/^(\d\d\d\d)-(\d\d)-(\d\d)(?: (\d\d):(\d\d)(?::(\d\d))?)?$/)),e?(e.shift(),i={year:e.shift(),month:e.shift(),day:e.shift(),hour:e.shift()||"00",minute:e.shift()||"00",second:e.shift()||"00"},s.params.includeTime&&s.params.twelveHourFormat&&(i.hour=parseInt(i.hour,10),i.meridian=i.hour>=12?"pm":"am",i.hour=i.hour%12?String(i.hour%12):String(12),delete i.second),i):null},validateInputs:function(){var t,e,i=this;return i.invalidDate=!1,t=["year","day"],i.params.includeTime&&t.push("hour","minute"),_.find(t,function(t){var s,r,n,a;return s=i.inputElements[t],e=s.element.get(0),r=parseInt(s.element.attr("max"),10),n=parseInt(s.element.attr("min"),10),a=parseInt(s(),10),i.invalidDate=isNaN(a)||a>r||a<n,i.invalidDate||e.setCustomValidity(""),i.invalidDate}),i.inputElements.meridian&&!i.invalidDate&&(e=i.inputElements.meridian.element.get(0),"am"!==i.inputElements.meridian.get()&&"pm"!==i.inputElements.meridian.get()?i.invalidDate=!0:e.setCustomValidity("")),i.invalidDate?e.setCustomValidity(n.l10n.invalidValue):e.setCustomValidity(""),(!i.section()||n.section.has(i.section())&&n.section(i.section()).expanded())&&_.result(e,"reportValidity"),i.invalidDate},updateDaysForMonth:function(){var t,e,i,s,r=this;i=parseInt(r.inputElements.month(),10),e=parseInt(r.inputElements.year(),10),s=parseInt(r.inputElements.day(),10),i&&e&&(t=new Date(e,i,0).getDate(),r.inputElements.day.element.attr("max",t),s>t&&r.inputElements.day(String(t)))},populateSetting:function(){var t,e=this;return!(e.validateInputs()||!e.params.allowPastDate&&!e.isFutureDate())&&(t=e.convertInputDateToString(),e.setting.set(t),!0)},convertInputDateToString:function(){var t,e,i,s,r=this,n="";return s=function(t,e){var i;return String(t).length<e&&(i=e-String(t).length,t=Math.pow(10,i).toString().substr(1)+String(t)),t},i=function(t){var e=parseInt(r.inputElements[t].get(),10);return _.contains(["month","day","hour","minute"],t)?e=s(e,2):"year"===t&&(e=s(e,4)),e},t=["year","-","month","-","day"],r.params.includeTime&&(e=r.inputElements.meridian?r.convertHourToTwentyFourHourFormat(r.inputElements.hour(),r.inputElements.meridian()):r.inputElements.hour(),t=t.concat([" ",s(e,2),":","minute",":","00"])),_.each(t,function(t){n+=r.inputElements[t]?i(t):t}),n},isFutureDate:function(){var t=this;return 0<n.utils.getRemainingTime(t.convertInputDateToString())},convertHourToTwentyFourHourFormat:function(t,e){var i,s;return s=parseInt(t,10),isNaN(s)?"":(i="pm"===e&&s<12?s+12:"am"===e&&12===s?s-12:s,String(i))},populateDateInputs:function(){var t,e=this;return!!(t=e.parseDateTime(e.setting.get()))&&(_.each(e.inputElements,function(e,i){var s=t[i];"month"===i||"meridian"===i?(s=s.replace(/^0/,""),e.set(s)):(s=parseInt(s,10),e.element.is(document.activeElement)?s!==parseInt(e(),10)&&e.set(String(s)):e.set(t[i]))}),!0)},toggleFutureDateNotification:function(t){var e,i,s=this;return e="not_future_date",t?(i=new n.Notification(e,{type:"error",message:n.l10n.futureDateError}),s.notifications.add(i)):s.notifications.remove(e),s}}),n.PreviewLinkControl=n.Control.extend({defaults:_.extend({},n.Control.prototype.defaults,{templateId:"customize-preview-link-control"}),ready:function(){var t,i,s,r,a,o,h=this;_.bindAll(h,"updatePreviewLink"),h.setting||(h.setting=new n.Value),h.previewElements={},h.container.find(".preview-control-element").each(function(){s=e(this),i=s.data("component"),t=new n.Element(s),h.previewElements[i]=t,h.elements.push(t)}),r=h.previewElements.url,a=h.previewElements.input,o=h.previewElements.button,a.link(h.setting),r.link(h.setting),r.bind(function(t){r.element.parent().attr({href:t,target:n.settings.changeset.uuid})}),n.bind("ready",h.updatePreviewLink),n.state("saved").bind(h.updatePreviewLink),n.state("changesetStatus").bind(h.updatePreviewLink),n.state("activated").bind(h.updatePreviewLink),n.previewer.previewUrl.bind(h.updatePreviewLink),o.element.on("click",function(t){t.preventDefault(),h.setting()&&(a.element.select(),document.execCommand("copy"),o(o.element.data("copied-text")))}),r.element.parent().on("click",function(t){e(this).hasClass("disabled")&&t.preventDefault()}),o.element.on("mouseenter",function(){h.setting()&&o(o.element.data("copy-text"))})},updatePreviewLink:function(){var t,e=this;t=!n.state("saved").get()||""===n.state("changesetStatus").get()||"auto-draft"===n.state("changesetStatus").get(),e.toggleSaveNotification(t),e.previewElements.url.element.parent().toggleClass("disabled",t),e.previewElements.button.element.prop("disabled",t),e.setting.set(n.previewer.getFrontendPreviewUrl())},toggleSaveNotification:function(t){var e,i,s=this;e="changes_not_saved",t?(i=new n.Notification(e,{type:"info",message:n.l10n.saveBeforeShare}),s.notifications.add(i)):s.notifications.remove(e)}}),n.defaultConstructor=n.Setting,n.control=new n.Values({defaultConstructor:n.Control}),n.section=new n.Values({defaultConstructor:n.Section}),n.panel=new n.Values({defaultConstructor:n.Panel}),n.notifications=new n.Notifications,n.PreviewFrame=n.Messenger.extend({sensitivity:null,initialize:function(t,i){var s=e.Deferred();s.promise(this),this.container=t.container,e.extend(t,{channel:n.PreviewFrame.uuid()}),n.Messenger.prototype.initialize.call(this,t,i),this.add("previewUrl",t.previewUrl),this.query=e.extend(t.query||{},{customize_messenger_channel:this.channel()}),this.run(s)},run:function(t){var i,s,r,a=this,o=!1,h=!1,d=null,c="{}"!==a.query.customized;a._ready&&a.unbind("ready",a._ready),a._ready=function(e){h=!0,d=e,a.container.addClass("iframe-ready"),e&&o&&t.resolveWith(a,[e])},a.bind("ready",a._ready),i=document.createElement("a"),i.href=a.previewUrl(),s=_.extend(n.utils.parseQueryString(i.search.substr(1)),{customize_changeset_uuid:a.query.customize_changeset_uuid,customize_theme:a.query.customize_theme,customize_messenger_channel:a.query.customize_messenger_channel}),!n.settings.changeset.autosaved&&n.state("saved").get()||(s.customize_autosaved="on"),i.search=e.param(s),a.iframe=e("<iframe />",{title:n.l10n.previewIframeTitle,name:"customize-"+a.channel()}),a.iframe.attr("onmousewheel",""),c?a.iframe.attr("data-src",i.href):a.iframe.attr("src",i.href),a.iframe.appendTo(a.container),a.targetWindow(a.iframe[0].contentWindow),c&&(r=e("<form>",{action:i.href,target:a.iframe.attr("name"),method:"post",hidden:"hidden"}),r.append(e("<input>",{type:"hidden",name:"_method",value:"GET"})),_.each(a.query,function(t,i){r.append(e("<input>",{type:"hidden",name:i,value:t}))}),a.container.append(r),r.submit(),r.remove()),a.bind("iframe-loading-error",function(e){return a.iframe.remove(),0===e?void a.login(t):-1===e?void t.rejectWith(a,["cheatin"]):void t.rejectWith(a,["request failure"])}),a.iframe.one("load",function(){o=!0,h?t.resolveWith(a,[d]):setTimeout(function(){t.rejectWith(a,["ready timeout"])},a.sensitivity)})},login:function(t){var i,s=this;if(i=function(){t.rejectWith(s,["logged out"])},this.triedLogin)return i();e.get(n.settings.url.ajax,{action:"logged-in"}).fail(i).done(function(r){var a;"1"!==r&&i(),a=e("<iframe />",{src:s.previewUrl(),title:n.l10n.previewIframeTitle}).hide(),a.appendTo(s.container),a.on("load",function(){s.triedLogin=!0,a.remove(),s.run(t)})})},destroy:function(){n.Messenger.prototype.destroy.call(this),this.iframe&&this.iframe.remove(),delete this.iframe,delete this.targetWindow}}),function(){var t=0;n.PreviewFrame.uuid=function(){return"preview-"+String(t++)}}(),n.setDocumentTitle=function(t){var e,i;e=n.settings.documentTitleTmpl,i=e.replace("%s",t),document.title=i,n.trigger("title",i)},n.Previewer=n.Messenger.extend({refreshBuffer:null,initialize:function(t,i){var s=this,r=document.createElement("a");e.extend(s,i||{}),s.deferred={active:e.Deferred()},s.refresh=_.debounce(function(t){return function(){var e,i;e=function(){return 0===n.state("processing").get()},e()?t.call(s):(i=function(){e()&&(t.call(s),n.state("processing").unbind(i))},n.state("processing").bind(i))}}(s.refresh),s.refreshBuffer),s.container=n.ensure(t.container),s.allowedUrls=t.allowedUrls,t.url=window.location.href,n.Messenger.prototype.initialize.call(s,t),r.href=s.origin(),s.add("scheme",r.protocol.replace(/:$/,"")),s.add("previewUrl",t.previewUrl).setter(function(t){var i,r,a,o=null,h=[];return i=document.createElement("a"),i.href=t,/\/wp-(admin|includes|content)(\/|$)/.test(i.pathname)?null:(i.search.length>1&&(r=n.utils.parseQueryString(i.search.substr(1)),delete r.customize_changeset_uuid,delete r.customize_theme,delete r.customize_messenger_channel,delete r.customize_autosaved,_.isEmpty(r)?i.search="":i.search=e.param(r)),h.push(i),s.scheme.get()+":"!==i.protocol&&(i=document.createElement("a"),i.href=h[0].href,i.protocol=s.scheme.get()+":",h.unshift(i)),a=document.createElement("a"),_.find(h,function(t){return!_.isUndefined(_.find(s.allowedUrls,function(e){if(a.href=e,i.protocol===a.protocol&&i.host===a.host&&0===i.pathname.indexOf(a.pathname.replace(/\/$/,"")))return o=t.href,!0}))}),o)}),s.bind("ready",s.ready),s.deferred.active.done(_.bind(s.keepPreviewAlive,s)),s.bind("synced",function(){s.send("active")}),s.previewUrl.bind(s.refresh),s.scroll=0,s.bind("scroll",function(t){s.scroll=t}),s.bind("url",function(t){var e,i=!1;s.scroll=0,e=function(){i=!0},s.previewUrl.bind(e),s.previewUrl.set(t),s.previewUrl.unbind(e),i||s.refresh()}),s.bind("documentTitle",function(t){n.setDocumentTitle(t)})},ready:function(t){var e,i=this,s={};s.settings=n.get(),s["settings-modified-while-loading"]=i.settingsModifiedWhileLoading,("resolved"!==i.deferred.active.state()||i.loading)&&(s.scroll=i.scroll),s["edit-shortcut-visibility"]=n.state("editShortcutVisibility").get(),i.send("sync",s),t.currentUrl&&(i.previewUrl.unbind(i.refresh),i.previewUrl.set(t.currentUrl),i.previewUrl.bind(i.refresh)),e={panel:t.activePanels,section:t.activeSections,control:t.activeControls},_(e).each(function(t,e){n[e].each(function(i,s){_.isUndefined(n.settings[e+"s"][s])&&_.isUndefined(t[s])||(t[s]?i.activate():i.deactivate())})}),t.settingValidities&&n._handleSettingValidities({settingValidities:t.settingValidities,focusInvalidControl:!1})},keepPreviewAlive:function(){var t,e,i,s,r=this;s=function(){e=setTimeout(i,n.settings.timeouts.keepAliveCheck)},t=function(){n.state("previewerAlive").set(!0),clearTimeout(e),s()},i=function(){n.state("previewerAlive").set(!1)},s(),r.bind("ready",t),r.bind("keep-alive",t)},query:function(){},abort:function(){this.loading&&(this.loading.destroy(),delete this.loading)},refresh:function(){var t,e=this;e.send("loading-initiated"),e.abort(),e.loading=new n.PreviewFrame({url:e.url(),previewUrl:e.previewUrl(),query:e.query({excludeCustomizedSaved:!0})||{},container:e.container}),e.settingsModifiedWhileLoading={},t=function(t){e.settingsModifiedWhileLoading[t.id]=!0},n.bind("change",t),e.loading.always(function(){n.unbind("change",t)}),e.loading.done(function(t){var i,s=this;e.preview=s,e.targetWindow(s.targetWindow()),e.channel(s.channel()),i=function(){s.unbind("synced",i),e._previousPreview&&e._previousPreview.destroy(),e._previousPreview=e.preview,e.deferred.active.resolve(),delete e.loading},s.bind("synced",i),e.trigger("ready",t)}),e.loading.fail(function(t){e.send("loading-failed"),"logged out"===t&&(e.preview&&(e.preview.destroy(),delete e.preview),e.login().done(e.refresh)),"cheatin"===t&&e.cheatin()})},login:function(){var t,i,s,r=this;return this._login?this._login:(t=e.Deferred(),this._login=t.promise(),i=new n.Messenger({channel:"login",url:n.settings.url.login}),s=e("<iframe />",{src:n.settings.url.login,title:n.l10n.loginIframeTitle}).appendTo(this.container),i.targetWindow(s[0].contentWindow),i.bind("login",function(){var e=r.refreshNonces();e.always(function(){s.remove(),i.destroy(),delete r._login}),e.done(function(){t.resolve()}),e.fail(function(){r.cheatin(),t.reject()})}),this._login)},cheatin:function(){e(document.body).empty().addClass("cheatin").append("<h1>"+n.l10n.notAllowedHeading+"</h1><p>"+n.l10n.notAllowed+"</p>")},refreshNonces:function(){var t,i=e.Deferred();return i.promise(),t=wp.ajax.post("customize_refresh_nonces",{wp_customize:"on",customize_theme:n.settings.theme.stylesheet}),t.done(function(t){n.trigger("nonce-refresh",t),i.resolve()}),t.fail(function(){i.reject()}),i}}),n.settingConstructor={},n.controlConstructor={color:n.ColorControl,media:n.MediaControl,upload:n.UploadControl,image:n.ImageControl,cropped_image:n.CroppedImageControl,site_icon:n.SiteIconControl,header:n.HeaderControl,background:n.BackgroundControl,background_position:n.BackgroundPositionControl,theme:n.ThemeControl,date_time:n.DateTimeControl,code_editor:n.CodeEditorControl},n.panelConstructor={themes:n.ThemesPanel},n.sectionConstructor={themes:n.ThemesSection,outer:n.OuterSection},n._handleSettingValidities=function(t){var e,i=[],s=!1;_.each(t.settingValidities,function(t,e){var s=n(e);s&&(_.isObject(t)&&_.each(t,function(t,e){var r,a,o=!1;r=new n.Notification(e,_.extend({fromServer:!0},t)),a=s.notifications(r.code),a&&(o=r.type!==a.type||r.message!==a.message||!_.isEqual(r.data,a.data)),o&&s.notifications.remove(e),s.notifications.has(r.code)||s.notifications.add(r),i.push(s.id)}),s.notifications.each(function(e){!e.fromServer||"error"!==e.type||!0!==t&&t[e.code]||s.notifications.remove(e.code)}))}),t.focusInvalidControl&&(e=n.findControlsForSettings(i),_(_.values(e)).find(function(t){return _(t).find(function(t){var e=t.section()&&n.section.has(t.section())&&n.section(t.section()).expanded();return e&&t.expanded&&(e=t.expanded()),e&&(t.focus(),s=!0),s})}),s||_.isEmpty(e)||_.values(e)[0][0].focus())},n.findControlsForSettings=function(t){var e,i={};return _.each(_.unique(t),function(t){var s=n(t);s&&(e=s.findControls())&&e.length>0&&(i[t]=e)}),i},n.reflowPaneContents=_.bind(function(){var t,i,s,r=[],a=!1;document.activeElement&&(i=e(document.activeElement)),n.panel.each(function(e){if("themes"!==e.id){var i=e.sections(),s=_.pluck(i,"headContainer");r.push(e),t=e.contentContainer.is("ul")?e.contentContainer:e.contentContainer.find("ul:first"),n.utils.areElementListsEqual(s,t.children("[id]"))||(_(i).each(function(e){t.append(e.headContainer)}),a=!0)}}),n.section.each(function(e){var i=e.controls(),s=_.pluck(i,"container");e.panel()||r.push(e),t=e.contentContainer.is("ul")?e.contentContainer:e.contentContainer.find("ul:first"),n.utils.areElementListsEqual(s,t.children("[id]"))||(_(i).each(function(e){t.append(e.container)}),a=!0)}),r.sort(n.utils.prioritySort),s=_.pluck(r,"headContainer"),t=e("#customize-theme-controls .customize-pane-parent"),n.utils.areElementListsEqual(s,t.children())||(_(r).each(function(e){t.append(e.headContainer)}),a=!0),n.panel.each(function(t){var e=t.active();t.active.callbacks.fireWith(t.active,[e,e])}),n.section.each(function(t){var e=t.active();t.active.callbacks.fireWith(t.active,[e,e])}),a&&i&&i.focus(),n.trigger("pane-contents-reflowed")},n),n.state=new n.Values,_.each(["saved","saving","trashing","activated","processing","paneVisible","expandedPanel","expandedSection","changesetDate","selectedChangesetDate","changesetStatus","selectedChangesetStatus","remainingTimeToPublish","previewerAlive","editShortcutVisibility","changesetLocked","previewedDevice"],function(t){n.state.create(t)}),e(function(){function t(){function i(t){t||n.settings.changeset.autosaved||(n.settings.changeset.autosaved=!0,n.previewer.send("autosaving"))}var s,r,a,o=!1;n.unbind("change",t),n.state("saved").bind(i),i(n.state("saved").get()),r=function(){o||(o=!0,n.requestChangesetUpdate({},{autosave:!0}).always(function(){o=!1})),a()},a=function(){clearTimeout(s),s=setTimeout(function(){r()},n.settings.timeouts.changesetAutoSave)},a(),e(document).on("visibilitychange.wp-customize-changeset-update",function(){document.hidden&&r()}),e(window).on("beforeunload.wp-customize-changeset-update",function(){r()})}if(n.settings=window._wpCustomizeSettings,n.l10n=window._wpCustomizeControlsL10n,n.settings&&e.support.postMessage&&(e.support.cors||!n.settings.isCrossDomain)){null===n.PreviewFrame.prototype.sensitivity&&(n.PreviewFrame.prototype.sensitivity=n.settings.timeouts.previewFrameSensitivity),null===n.Previewer.prototype.refreshBuffer&&(n.Previewer.prototype.refreshBuffer=n.settings.timeouts.windowRefresh);var i,s=e(document.body),r=s.children(".wp-full-overlay"),a=e("#customize-info .panel-title.site-title"),o=e(".customize-controls-close"),h=e("#save"),d=e("#customize-save-button-wrapper"),c=e("#publish-settings"),l=e("#customize-footer-actions");n.bind("ready",function(){n.section.add(new n.OuterSection("publish_settings",{title:n.l10n.publishSettings,priority:0,active:n.settings.theme.active}))}),n.section("publish_settings",function(t){function e(){_||(_=n.utils.highlightButton(d,{delay:1e3,focusTarget:h}))}function i(){_&&(_(),_=null)}var s,r,a,o,l,u,p,m,g,f,_;r=new n.Control("trash_changeset",{type:"button",section:t.id,priority:30,input_attrs:{"class":"button-link button-link-delete",value:n.l10n.discardChanges}}),n.control.add(r),r.deferred.embedded.done(function(){r.container.find(".button-link").on("click",function(){confirm(n.l10n.trashConfirm)&&wp.customize.previewer.trash()})}),n.control.add(new n.PreviewLinkControl("changeset_preview_link",{section:t.id,priority:100})),o=function(){return!!n.state("activated").get()&&(!n.state("trashing").get()&&"trash"!==n.state("changesetStatus").get()&&(""!==n.state("changesetStatus").get()||!n.state("saved").get()))},t.active.validate=o,a=function(){t.active.set(o())},n.state("activated").bind(a),n.state("trashing").bind(a),n.state("saved").bind(a),n.state("changesetStatus").bind(a),a(),s=function(){c.toggle(t.active.get()),h.toggleClass("has-next-sibling",t.active.get())},s(),t.active.bind(s),n.state("selectedChangesetStatus").bind(i),t.contentContainer.find(".customize-action").text(n.l10n.updating),t.contentContainer.find(".customize-section-back").removeAttr("tabindex"),c.prop("disabled",!1),c.on("click",function(e){e.preventDefault(),t.expanded.set(!t.expanded.get())}),t.expanded.bind(function(t){var s;if(c.attr("aria-expanded",String(t)),c.toggleClass("active",t),t)return void i();s=n.state("changesetStatus").get(),""!==s&&"auto-draft"!==s||(s="publish"),n.state("selectedChangesetStatus").get()!==s?e():"future"===n.state("selectedChangesetStatus").get()&&n.state("selectedChangesetDate").get()!==n.state("changesetDate").get()&&e()}),l=new n.Control("changeset_status",{priority:10,type:"radio",section:"publish_settings",setting:n.state("selectedChangesetStatus"),templateId:"customize-selected-changeset-status-control",label:n.l10n.action,choices:n.settings.changeset.statusChoices}),n.control.add(l),u=new n.DateTimeControl("changeset_scheduled_date",{priority:20,section:"publish_settings",setting:n.state("selectedChangesetDate"),minYear:(new Date).getFullYear(),allowPastDate:!1,includeTime:!0,twelveHourFormat:/a/i.test(n.settings.timeFormat),description:n.l10n.scheduleDescription}),u.notifications.alt=!0,n.control.add(u),m=function(){n.state("selectedChangesetStatus").set("publish"),n.previewer.save()},f=function(){var t="future"===n.state("changesetStatus").get()&&"future"===n.state("selectedChangesetStatus").get()&&n.state("changesetDate").get()&&n.state("selectedChangesetDate").get()===n.state("changesetDate").get()&&n.utils.getRemainingTime(n.state("changesetDate").get())>=0;t&&!g?g=setInterval(function(){var t=n.utils.getRemainingTime(n.state("changesetDate").get());n.state("remainingTimeToPublish").set(t),t<=0&&(clearInterval(g),g=0,m())},1e3):!t&&g&&(clearInterval(g),g=0)},n.state("changesetDate").bind(f),n.state("selectedChangesetDate").bind(f),n.state("changesetStatus").bind(f),n.state("selectedChangesetStatus").bind(f),f(),u.active.validate=function(){return"future"===n.state("selectedChangesetStatus").get()},p=function(t){u.active.set("future"===t)},p(n.state("selectedChangesetStatus").get()),n.state("selectedChangesetStatus").bind(p),n.state("saving").bind(function(t){t&&"future"===n.state("selectedChangesetStatus").get()&&u.toggleFutureDateNotification(!u.isFutureDate())})}),e("#customize-controls").on("keydown",function(t){var i=13===t.which,s=e(t.target);i&&(s.is("input:not([type=button])")||s.is("select"))&&t.preventDefault()}),e(".customize-info").find("> .accordion-section-title .customize-help-toggle").on("click",function(){var t=e(this).closest(".accordion-section"),i=t.find(".customize-panel-description:first");t.hasClass("cannot-expand")||(t.hasClass("open")?(t.toggleClass("open"),i.slideUp(n.Panel.prototype.defaultExpandedArguments.duration,function(){i.trigger("toggled")}),e(this).attr("aria-expanded",!1)):(i.slideDown(n.Panel.prototype.defaultExpandedArguments.duration,function(){i.trigger("toggled")}),t.toggleClass("open"),e(this).attr("aria-expanded",!0)))}),n.previewer=new n.Previewer({container:"#customize-preview",form:"#customize-controls",previewUrl:n.settings.url.preview,allowedUrls:n.settings.url.allowed},{nonce:n.settings.nonce,query:function(t){var e={wp_customize:"on",customize_theme:n.settings.theme.stylesheet,nonce:this.nonce.preview,customize_changeset_uuid:n.settings.changeset.uuid};return!n.settings.changeset.autosaved&&n.state("saved").get()||(e.customize_autosaved="on"),e.customized=JSON.stringify(n.dirtyValues({unsaved:t&&t.excludeCustomizedSaved})),e},save:function(t){function s(t){u[t.id]=!0}var r,a,o=this,h=e.Deferred(),d=n.state("selectedChangesetStatus").get(),c=n.state("selectedChangesetDate").get(),l=n.state("processing"),u={},p=[],m=[],g=[];return t&&t.status&&(d=t.status),n.state("saving").get()&&(h.reject("already_saving"),h.promise()),n.state("saving").set(!0),a=function(){var r,a,l={},f=n._latestRevision;if(n.bind("change",s),n.notifications.remove("client_side_error"),n.each(function(t){t.notifications.each(function(e){"error"!==e.type||e.fromServer||(p.push(t.id),l[t.id]||(l[t.id]={}),l[t.id][e.code]=e)})}),n.control.each(function(t){(!t.setting||!t.setting.id&&t.active.get())&&t.notifications.each(function(e){"error"===e.type&&g.push([t])})}),m=_.union(g,_.values(n.findControlsForSettings(p))),!_.isEmpty(m))return m[0][0].focus(),n.unbind("change",s),p.length&&n.notifications.add(new n.Notification("client_side_error",{message:(1===p.length?n.l10n.saveBlockedError.singular:n.l10n.saveBlockedError.plural).replace(/%s/g,String(p.length)),type:"error",dismissible:!0,saveFailure:!0})),h.rejectWith(o,[{setting_invalidities:l}]),n.state("saving").set(!1),h.promise();a=e.extend(o.query({excludeCustomizedSaved:!1}),{nonce:o.nonce.save,customize_changeset_status:d}),t&&t.date?a.customize_changeset_date=t.date:"future"===d&&c&&(a.customize_changeset_date=c),t&&t.title&&(a.customize_changeset_title=t.title),n.trigger("save-request-params",a),r=wp.ajax.post("customize_save",a),n.state("processing").set(n.state("processing").get()+1),n.trigger("save",r),r.always(function(){n.state("processing").set(n.state("processing").get()-1),n.state("saving").set(!1),n.unbind("change",s)}),n.notifications.each(function(t){t.saveFailure&&n.notifications.remove(t.code)}),r.fail(function(t){var e,s;s={type:"error",dismissible:!0,fromServer:!0,saveFailure:!0},"0"===t?t="not_logged_in":"-1"===t&&(t="invalid_nonce"),"invalid_nonce"===t?o.cheatin():"not_logged_in"===t?(o.preview.iframe.hide(),o.login().done(function(){o.save(),o.preview.iframe.show()})):t.code?"not_future_date"===t.code&&n.section.has("publish_settings")&&n.section("publish_settings").active.get()&&n.control.has("changeset_scheduled_date")?n.control("changeset_scheduled_date").toggleFutureDateNotification(!0).focus():"changeset_locked"!==t.code&&(e=new n.Notification(t.code,_.extend(s,{message:t.message}))):e=new n.Notification("unknown_error",_.extend(s,{message:n.l10n.unknownRequestFail})),e&&n.notifications.add(e),t.setting_validities&&n._handleSettingValidities({settingValidities:t.setting_validities,focusInvalidControl:!0}),h.rejectWith(o,[t]),n.trigger("error",t),"changeset_already_published"===t.code&&t.next_changeset_uuid&&(n.settings.changeset.uuid=t.next_changeset_uuid,n.state("changesetStatus").set(""),n.settings.changeset.branching&&i.send("changeset-uuid",n.settings.changeset.uuid),n.previewer.send("changeset-uuid",n.settings.changeset.uuid))}),r.done(function(t){o.send("saved",t),n.state("changesetStatus").set(t.changeset_status),t.changeset_date&&n.state("changesetDate").set(t.changeset_date),"publish"===t.changeset_status&&(n.each(function(t){t._dirty&&(_.isUndefined(n._latestSettingRevisions[t.id])||n._latestSettingRevisions[t.id]<=f)&&(t._dirty=!1)}),n.state("changesetStatus").set(""),n.settings.changeset.uuid=t.next_changeset_uuid,n.settings.changeset.branching&&i.send("changeset-uuid",n.settings.changeset.uuid)),n._lastSavedRevision=Math.max(f,n._lastSavedRevision),t.setting_validities&&n._handleSettingValidities({settingValidities:t.setting_validities,focusInvalidControl:!0}),h.resolveWith(o,[t]),n.trigger("saved",t),_.isEmpty(u)||n.state("saved").set(!1)})},0===l()?a():(r=function(){0===l()&&(n.state.unbind("change",r),a())},n.state.bind("change",r)),h.promise()},trash:function(){var t,i,s;n.state("trashing").set(!0),n.state("processing").set(n.state("processing").get()+1),t=wp.ajax.post("customize_trash",{customize_changeset_uuid:n.settings.changeset.uuid,nonce:n.settings.nonce.trash}),n.notifications.add(new n.OverlayNotification("changeset_trashing",{type:"info",message:n.l10n.revertingChanges,loading:!0})),i=function(){var t,i=document.createElement("a");n.state("changesetStatus").set("trash"),n.each(function(t){t._dirty=!1}),n.state("saved").set(!0),i.href=location.href,t=n.utils.parseQueryString(i.search.substr(1)),delete t.changeset_uuid,t["return"]=n.settings.url["return"],i.search=e.param(t),location.replace(i.href)},s=function(t,e){var i=t||"unknown_error";n.state("processing").set(n.state("processing").get()-1),n.state("trashing").set(!1),n.notifications.remove("changeset_trashing"),n.notifications.add(new n.Notification(i,{message:e||n.l10n.unknownError,dismissible:!0,type:"error"}))},t.done(function(t){i(t.message)}),t.fail(function(t){var e=t.code||"trashing_failed";t.success||"non_existent_changeset"===e||"changeset_already_trashed"===e?i(t.message):s(e,t.message)})},getFrontendPreviewUrl:function(){var t,i,s=this;return i=document.createElement("a"),i.href=s.previewUrl.get(),t=n.utils.parseQueryString(i.search.substr(1)),n.state("changesetStatus").get()&&"publish"!==n.state("changesetStatus").get()&&(t.customize_changeset_uuid=n.settings.changeset.uuid),n.state("activated").get()||(t.customize_theme=n.settings.theme.stylesheet),i.search=e.param(t),i.href}}),e.ajaxPrefilter(function(t){/wp_customize=on/.test(t.data)&&(t.data+="&"+e.param({customize_preview_nonce:n.settings.nonce.preview}))}),n.previewer.bind("nonce",function(t){e.extend(this.nonce,t)}),n.bind("nonce-refresh",function(t){e.extend(n.settings.nonce,t),e.extend(n.previewer.nonce,t),n.previewer.send("nonce-refresh",t)}),e.each(n.settings.settings,function(t,e){var i=n.settingConstructor[e.type]||n.Setting;n.add(new i(t,e.value,{transport:e.transport,previewer:n.previewer,dirty:!!e.dirty}))}),e.each(n.settings.panels,function(t,e){var i,s=n.panelConstructor[e.type]||n.Panel;i=_.extend({params:e},e),n.panel.add(new s(t,i))}),e.each(n.settings.sections,function(t,e){var i,s=n.sectionConstructor[e.type]||n.Section;i=_.extend({params:e},e),n.section.add(new s(t,i))}),e.each(n.settings.controls,function(t,e){var i,s=n.controlConstructor[e.type]||n.Control;i=_.extend({params:e},e),n.control.add(new s(t,i))}),_.each(["panel","section","control"],function(t){var e=n.settings.autofocus[t];e&&n[t](e,function(t){t.deferred.embedded.done(function(){n.previewer.deferred.active.done(function(){t.focus()})})})}),n.bind("ready",n.reflowPaneContents),e([n.panel,n.section,n.control]).each(function(t,e){var i=_.debounce(n.reflowPaneContents,n.settings.timeouts.reflowPaneContents);e.bind("add",i),e.bind("change",i),e.bind("remove",i)}),n.bind("ready",function(){var t,i,s;n.notifications.container=e("#customize-notifications-area"),n.notifications.bind("change",_.debounce(function(){n.notifications.render()})),t=e(".wp-full-overlay-sidebar-content"),n.notifications.bind("rendered",function(){t.css("top",""),0!==n.notifications.count()&&(i=n.notifications.container.outerHeight()+1,s=parseInt(t.css("top"),10),t.css("top",s+i+"px")),n.notifications.trigger("sidebarTopUpdated")}),n.notifications.render()}),function(t){var i,r,a=t.instance("saved"),d=t.instance("saving"),c=t.instance("trashing"),l=t.instance("activated"),u=t.instance("processing"),p=t.instance("paneVisible"),m=t.instance("expandedPanel"),g=t.instance("expandedSection"),f=t.instance("changesetStatus"),_=t.instance("selectedChangesetStatus"),v=t.instance("changesetDate"),y=t.instance("selectedChangesetDate"),w=t.instance("previewerAlive"),b=t.instance("editShortcutVisibility"),x=t.instance("changesetLocked");t.bind("change",function(){var t;l()?""===f.get()&&a()?(n.settings.changeset.currentUserCanPublish?h.val(n.l10n.published):h.val(n.l10n.saved),o.find(".screen-reader-text").text(n.l10n.close)):("draft"===_()?a()&&_()===f()?h.val(n.l10n.draftSaved):h.val(n.l10n.saveDraft):"future"===_()?a()&&_()===f()?v.get()!==y.get()?h.val(n.l10n.schedule):h.val(n.l10n.scheduled):h.val(n.l10n.schedule):n.settings.changeset.currentUserCanPublish&&h.val(n.l10n.publish),o.find(".screen-reader-text").text(n.l10n.cancel)):(h.val(n.l10n.activate),o.find(".screen-reader-text").text(n.l10n.cancel)),t=!d()&&!c()&&!x()&&(!l()||!a()||f()!==_()&&""!==f()||"future"===_()&&v.get()!==y.get()),h.prop("disabled",!t)}),_.validate=function(t){return""===t||"auto-draft"===t?null:t},r=n.settings.changeset.currentUserCanPublish?"publish":"draft",f(n.settings.changeset.status),x(Boolean(n.settings.changeset.lockUser)),v(n.settings.changeset.publishDate),y(n.settings.changeset.publishDate),_(""===n.settings.changeset.status||"auto-draft"===n.settings.changeset.status?r:n.settings.changeset.status),_.link(f),a(!0),""===f()&&n.each(function(t){t._dirty&&a(!1)}),d(!1),l(n.settings.theme.active),u(0),p(!0),m(!1),g(!1),w(!0),b("visible"),n.bind("change",function(){t("saved").get()&&t("saved").set(!1)}),n.settings.changeset.branching&&a.bind(function(t){t||i(!0)}),d.bind(function(t){s.toggleClass("saving",t)}),c.bind(function(t){s.toggleClass("trashing",t)}),n.bind("saved",function(e){t("saved").set(!0),"publish"===e.changeset_status&&t("activated").set(!0)}),l.bind(function(t){t&&n.trigger("activated")}),i=function(t){var i,s;if(history.replaceState){if(i=document.createElement("a"),i.href=location.href,s=n.utils.parseQueryString(i.search.substr(1)),t){if(s.changeset_uuid===n.settings.changeset.uuid)return;s.changeset_uuid=n.settings.changeset.uuid}else{if(!s.changeset_uuid)return;delete s.changeset_uuid}i.search=e.param(s),
history.replaceState({},document.title,i.href)}},n.settings.changeset.branching&&f.bind(function(t){i(""!==t&&"publish"!==t&&"trash"!==t)})}(n.state),function(){function t(t){t&&t.lockUser&&(n.settings.changeset.lockUser=t.lockUser),n.state("changesetLocked").set(!0),n.notifications.add(new i("changeset_locked",{lockUser:n.settings.changeset.lockUser,allowOverride:Boolean(t&&t.allowOverride)}))}var i=n.OverlayNotification.extend({templateId:"customize-changeset-locked-notification",lockUser:null,initialize:function(t,e){var i,s,r=this;i=t||"changeset_locked",s=_.extend({type:"warning",containerClasses:"",lockUser:{}},e),s.containerClasses+=" notification-changeset-locked",n.OverlayNotification.prototype.initialize.call(r,i,s)},render:function(){var t,e,i,s,r=this;return e=_.extend({allowOverride:!1,returnUrl:n.settings.url["return"],previewUrl:n.previewer.previewUrl.get(),frontendPreviewUrl:n.previewer.getFrontendPreviewUrl()},this),t=n.OverlayNotification.prototype.render.call(e),n.requestChangesetUpdate({},{autosave:!0}).fail(function(e){e.autosaved||t.find(".notice-error").prop("hidden",!1).text(e.message||n.l10n.unknownRequestFail)}),i=t.find(".customize-notice-take-over-button"),i.on("click",function(e){e.preventDefault(),s||(i.addClass("disabled"),s=wp.ajax.post("customize_override_changeset_lock",{wp_customize:"on",customize_theme:n.settings.theme.stylesheet,customize_changeset_uuid:n.settings.changeset.uuid,nonce:n.settings.nonce.override_lock}),s.done(function(){n.notifications.remove(r.code),n.state("changesetLocked").set(!1)}),s.fail(function(e){var r=e.message||n.l10n.unknownRequestFail;t.find(".notice-error").prop("hidden",!1).text(r),s.always(function(){i.removeClass("disabled")})}),s.always(function(){s=null}))}),t}});n.settings.changeset.lockUser&&t({allowOverride:!0}),e(document).on("heartbeat-send.update_lock_notice",function(t,e){e.check_changeset_lock=!0,e.changeset_uuid=n.settings.changeset.uuid}),e(document).on("heartbeat-tick.update_lock_notice",function(e,i){var s,r="changeset_locked";i.customize_changeset_lock_user&&(s=n.notifications(r),s&&s.lockUser.id!==n.settings.changeset.lockUser.id&&n.notifications.remove(r),t({lockUser:i.customize_changeset_lock_user}))}),n.bind("error",function(e){"changeset_locked"===e.code&&e.lock_user&&t({lockUser:e.lock_user})})}(),function(){function t(){var t,i;return t=document.createElement("a"),t.href=location.href,i=n.utils.parseQueryString(t.search.substr(1)),n.settings.changeset.latestAutoDraftUuid?i.changeset_uuid=n.settings.changeset.latestAutoDraftUuid:i.customize_autosaved="on",i["return"]=n.settings.url["return"],t.search=e.param(i),t.href}function i(){r||(wp.ajax.post("customize_dismiss_autosave_or_lock",{wp_customize:"on",customize_theme:n.settings.theme.stylesheet,customize_changeset_uuid:n.settings.changeset.uuid,nonce:n.settings.nonce.dismiss_autosave_or_lock,dismiss_autosave:!0}),r=!0)}var s=[],r=!1;n.settings.changeset.autosaved&&(n.state("saved").set(!1),s.push("customize_autosaved")),n.settings.changeset.branching||n.settings.changeset.status&&"auto-draft"!==n.settings.changeset.status||s.push("changeset_uuid"),s.length>0&&function(t){var i,s=document.createElement("a"),r=0;s.href=location.href,i=n.utils.parseQueryString(s.search.substr(1)),_.each(t,function(t){"undefined"!=typeof i[t]&&(r+=1,delete i[t])}),0!==r&&(s.search=e.param(i),history.replaceState({},document.title,s.href))}(s),(n.settings.changeset.latestAutoDraftUuid||n.settings.changeset.hasAutosaveRevision)&&function(){var e,s="autosave_available";n.notifications.add(new n.Notification(s,{message:n.l10n.autosaveNotice,type:"warning",dismissible:!0,render:function(){var e,s=n.Notification.prototype.render.call(this);return e=s.find("a"),e.prop("href",t()),e.on("click",function(e){e.preventDefault(),location.replace(t())}),s.find(".notice-dismiss").on("click",i),s}})),e=function(){i(),n.notifications.remove(s),n.unbind("change",e),n.state("changesetStatus").unbind(e)},n.bind("change",e),n.state("changesetStatus").bind(e)}()}(),n.previewer.previewUrl()?n.previewer.refresh():n.previewer.previewUrl(n.settings.url.home),h.click(function(t){n.previewer.save(),t.preventDefault()}).keydown(function(t){9!==t.which&&(13===t.which&&n.previewer.save(),t.preventDefault())}),o.keydown(function(t){9!==t.which&&(13===t.which&&this.click(),t.preventDefault())}),e(".collapse-sidebar").on("click",function(){n.state("paneVisible").set(!n.state("paneVisible").get())}),n.state("paneVisible").bind(function(t){r.toggleClass("preview-only",!t),r.toggleClass("expanded",t),r.toggleClass("collapsed",!t),t?e(".collapse-sidebar").attr({"aria-expanded":"true","aria-label":n.l10n.collapseSidebar}):e(".collapse-sidebar").attr({"aria-expanded":"false","aria-label":n.l10n.expandSidebar})}),s.on("keydown",function(t){var i,r=[],a=[],o=[];if(27===t.which&&(e(t.target).is("body")||e.contains(e("#customize-controls")[0],t.target))&&(n.control.each(function(t){t.expanded&&t.expanded()&&_.isFunction(t.collapse)&&r.push(t)}),n.section.each(function(t){t.expanded()&&a.push(t)}),n.panel.each(function(t){t.expanded()&&o.push(t)}),r.length>0&&0===a.length&&(r.length=0),i=r[0]||a[0]||o[0])){if("themes"===i.params.type)return void(s.hasClass("modal-open")?i.closeDetails():n.panel.has("themes")&&n.panel("themes").collapse());i.collapse(),t.preventDefault()}}),e(".customize-controls-preview-toggle").on("click",function(){n.state("paneVisible").set(!n.state("paneVisible").get())}),function(){var t,i,s,r,a,o,h,d=e(".wp-full-overlay-sidebar-content");t=function(t){var e,a=t,h=n.state("expandedSection").get(),d=n.state("expandedPanel").get();if(o&&o.element&&(s(o.element),o.element.find(".description").off("toggled",i)),!a)if(!h&&d&&d.contentContainer)a=d;else{if(d||!h||!h.contentContainer)return void(o=!1);a=h}e=a.contentContainer.find(".customize-section-title, .panel-meta").first(),e.length?(o={instance:a,element:e,parent:e.closest(".customize-pane-child"),height:e.outerHeight()},o.element.find(".description").on("toggled",i),h&&r(o.element,o.parent)):o=!1},n.state("expandedSection").bind(t),n.state("expandedPanel").bind(t),d.on("scroll",_.throttle(function(){if(o){var t,e=d.scrollTop();t=h?e===h?0:e>h?1:-1:1,h=e,0!==t&&a(o,e,t)}},8)),n.notifications.bind("sidebarTopUpdated",function(){o&&o.element.hasClass("is-sticky")&&o.element.css("top",d.css("top"))}),s=function(t){t.hasClass("is-sticky")&&t.removeClass("is-sticky").addClass("maybe-sticky is-in-view").css("top",d.scrollTop()+"px")},r=function(t,e){t.hasClass("is-in-view")&&(t.removeClass("maybe-sticky is-in-view").css({width:"",top:""}),e.css("padding-top",""))},i=function(){o.height=o.element.outerHeight()},a=function(t,e,i){var s=t.element,r=t.parent,n=t.height,a=parseInt(s.css("top"),10),o=s.hasClass("maybe-sticky"),h=s.hasClass("is-sticky"),c=s.hasClass("is-in-view");if(-1!==i)return h&&(a=e,s.removeClass("is-sticky").css({top:a+"px",width:""})),void(c&&e>a+n&&(s.removeClass("is-in-view"),r.css("padding-top","")));if(!o&&e>=n)o=!0,s.addClass("maybe-sticky");else if(0===e)return s.removeClass("maybe-sticky is-in-view is-sticky").css({top:"",width:""}),void r.css("padding-top","");c&&!h?a>=e&&s.addClass("is-sticky").css({top:d.css("top"),width:r.outerWidth()+"px"}):o&&!c&&(s.addClass("is-in-view").css("top",e-n+"px"),r.css("padding-top",n+"px"))}}(),n.previewedDevice=n.state("previewedDevice"),n.bind("ready",function(){_.find(n.settings.previewableDevices,function(t,e){if(!0===t["default"])return n.previewedDevice.set(e),!0})}),l.find(".devices button").on("click",function(t){n.previewedDevice.set(e(t.currentTarget).data("device"))}),n.previewedDevice.bind(function(t){var i=e(".wp-full-overlay"),s="";l.find(".devices button").removeClass("active").attr("aria-pressed",!1),l.find(".devices .preview-"+t).addClass("active").attr("aria-pressed",!0),e.each(n.settings.previewableDevices,function(t){s+=" preview-"+t}),i.removeClass(s).addClass("preview-"+t)}),a.length&&n("blogname",function(t){var i=function(){a.text(e.trim(t())||n.l10n.untitledBlogName)};t.bind(i),i()}),i=new n.Messenger({url:n.settings.url.parent,channel:"loader"}),function(){function t(){var t;return n.state("activated").get()?(t=n.state("changesetStatus").get(),""!==t&&"auto-draft"!==t||(t="publish"),n.state("selectedChangesetStatus").get()===t&&(("future"!==n.state("selectedChangesetStatus").get()||n.state("selectedChangesetDate").get()===n.state("changesetDate").get())&&(n.state("saved").get()&&"auto-draft"!==n.state("changesetStatus").get()))):0===n._latestRevision}function s(){n.unbind("change",s),n.state("selectedChangesetStatus").unbind(s),n.state("selectedChangesetDate").unbind(s),e(window).on("beforeunload.customize-confirm",function(){if(!t()&&!n.state("changesetLocked").get())return setTimeout(function(){r.removeClass("customize-loading")},1),n.l10n.saveAlert})}function a(){var i=e.Deferred(),s=!1,r=!1;return t()?r=!0:confirm(n.l10n.saveAlert)?(r=!0,n.each(function(t){t._dirty=!1}),e(document).off("visibilitychange.wp-customize-changeset-update"),e(window).off("beforeunload.wp-customize-changeset-update"),o.css("cursor","progress"),""!==n.state("changesetStatus").get()&&(s=!0)):i.reject(),(r||s)&&wp.ajax.send("customize_dismiss_autosave_or_lock",{timeout:500,data:{wp_customize:"on",customize_theme:n.settings.theme.stylesheet,customize_changeset_uuid:n.settings.changeset.uuid,nonce:n.settings.nonce.dismiss_autosave_or_lock,dismiss_autosave:s,dismiss_lock:r}}).always(function(){i.resolve()}),i.promise()}var h=!1;i.bind("back",function(){h=!0}),n.bind("change",s),n.state("selectedChangesetStatus").bind(s),n.state("selectedChangesetDate").bind(s),i.bind("confirm-close",function(){a().done(function(){i.send("confirmed-close",!0)}).fail(function(){i.send("confirmed-close",!1)})}),o.on("click.customize-controls-close",function(t){t.preventDefault(),h?i.send("close"):a().done(function(){e(window).off("beforeunload.customize-confirm"),window.location.href=o.prop("href")})})}(),e.each(["saved","change"],function(t,e){n.bind(e,function(){i.send(e)})}),n.bind("title",function(t){i.send("title",t)}),n.settings.changeset.branching&&i.send("changeset-uuid",n.settings.changeset.uuid),i.send("ready"),e.each({background_image:{controls:["background_preset","background_position","background_size","background_repeat","background_attachment"],callback:function(t){return!!t}},show_on_front:{controls:["page_on_front","page_for_posts"],callback:function(t){return"page"===t}},header_textcolor:{controls:["header_textcolor"],callback:function(t){return"blank"!==t}}},function(t,i){n(t,function(t){e.each(i.controls,function(e,s){n.control(s,function(e){var s=function(t){e.container.toggle(i.callback(t))};s(t.get()),t.bind(s)})})})}),n.control("background_preset",function(t){var e,i,s,r,a,o;e={"default":[!1,!1,!1,!1],fill:[!0,!1,!1,!1],fit:[!0,!1,!0,!1],repeat:[!0,!1,!1,!0],custom:[!0,!0,!0,!0]},i=[_wpCustomizeBackground.defaults["default-position-x"],_wpCustomizeBackground.defaults["default-position-y"],_wpCustomizeBackground.defaults["default-size"],_wpCustomizeBackground.defaults["default-repeat"],_wpCustomizeBackground.defaults["default-attachment"]],s={"default":i,fill:["left","top","cover","no-repeat","fixed"],fit:["left","top","contain","no-repeat","fixed"],repeat:["left","top","auto","repeat","scroll"]},r=function(t){_.each(["background_position","background_size","background_repeat","background_attachment"],function(i,s){var r=n.control(i);r&&r.container.toggle(e[t][s])})},a=function(t){_.each(["background_position_x","background_position_y","background_size","background_repeat","background_attachment"],function(e,i){var r=n(e);r&&r.set(s[t][i])})},o=t.setting.get(),r(o),t.setting.bind("change",function(t){r(t),"custom"!==t&&a(t)})}),n.control("background_repeat",function(t){t.elements[0].unsync(n("background_repeat")),t.element=new n.Element(t.container.find("input")),t.element.set("no-repeat"!==t.setting()),t.element.bind(function(e){t.setting.set(e?"repeat":"no-repeat")}),t.setting.bind(function(e){t.element.set("no-repeat"!==e)})}),n.control("background_attachment",function(t){t.elements[0].unsync(n("background_attachment")),t.element=new n.Element(t.container.find("input")),t.element.set("fixed"!==t.setting()),t.element.bind(function(e){t.setting.set(e?"scroll":"fixed")}),t.setting.bind(function(e){t.element.set("fixed"!==e)})}),n.control("display_header_text",function(t){var e="";t.elements[0].unsync(n("header_textcolor")),t.element=new n.Element(t.container.find("input")),t.element.set("blank"!==t.setting()),t.element.bind(function(i){i||(e=n("header_textcolor").get()),t.setting.set(i?e:"blank")}),t.setting.bind(function(e){t.element.set("blank"!==e)})}),n("show_on_front","page_on_front","page_for_posts",function(t,e,i){var s=function(){var s,r,a=this,o="show_on_front_page_collision";s=parseInt(e(),10),r=parseInt(i(),10),"page"===t()&&(a===e&&s>0&&n.previewer.previewUrl.set(n.settings.url.home),a===i&&r>0&&n.previewer.previewUrl.set(n.settings.url.home+"?page_id="+r)),"page"===t()&&s&&r&&s===r?t.notifications.add(new n.Notification(o,{type:"error",message:n.l10n.pageOnFrontError})):t.notifications.remove(o)};t.bind(s),e.bind(s),i.bind(s),s.call(t,t()),n.control("show_on_front",function(t){t.deferred.embedded.done(function(){t.container.append(t.getNotificationsContainerElement())})})}),function(){var t=e.Deferred();n.section("custom_css",function(e){e.deferred.embedded.done(function(){e.expanded()?t.resolve(e):e.expanded.bind(function(i){i&&t.resolve(e)})})}),t.done(function(t){var e=n.control("custom_css");e.container.find(".customize-control-title:first").addClass("screen-reader-text"),t.container.find(".section-description-buttons .section-description-close").on("click",function(){t.container.find(".section-meta .customize-section-description:first").removeClass("open").slideUp(),t.container.find(".customize-help-toggle").attr("aria-expanded","false").focus()}),e&&!e.setting.get()&&(t.container.find(".section-meta .customize-section-description:first").addClass("open").show().trigger("toggled"),t.container.find(".customize-help-toggle").attr("aria-expanded","true"))})}(),n.control("header_video",function(t){t.deferred.embedded.done(function(){var e=function(){var e=n.section(t.section());e&&(t.active.get()?e.notifications.remove("video_header_not_available"):e.notifications.add(new n.Notification("video_header_not_available",{type:"info",message:n.l10n.videoHeaderNotice})))};e(),t.active.bind(e)})}),n.previewer.bind("selective-refresh-setting-validities",function(t){n._handleSettingValidities({settingValidities:t,focusInvalidControl:!1})}),n.previewer.bind("focus-control-for-setting",function(t){var e=[];n.control.each(function(i){var s=_.pluck(i.settings,"id");-1!==_.indexOf(s,t)&&e.push(i)}),e.length&&(e.sort(function(t,e){return t.priority()-e.priority()}),e[0].focus())}),n.previewer.bind("refresh",function(){n.previewer.refresh()}),n.state("paneVisible").bind(function(t){var i;i=window.matchMedia?window.matchMedia("screen and ( max-width: 640px )").matches:e(window).width()<=640,n.state("editShortcutVisibility").set(t||i?"visible":"hidden")}),window.matchMedia&&window.matchMedia("screen and ( max-width: 640px )").addListener(function(){var t=n.state("paneVisible");t.callbacks.fireWith(t,[t.get(),t.get()])}),n.previewer.bind("edit-shortcut-visibility",function(t){n.state("editShortcutVisibility").set(t)}),n.state("editShortcutVisibility").bind(function(t){n.previewer.send("edit-shortcut-visibility",t)}),n.bind("change",t),e(document).one("tinymce-editor-setup",function(){window.tinymce.ui.FloatPanel&&(!window.tinymce.ui.FloatPanel.zIndex||window.tinymce.ui.FloatPanel.zIndex<500001)&&(window.tinymce.ui.FloatPanel.zIndex=500001)}),s.addClass("ready"),n.trigger("ready")}})}(wp,jQuery);