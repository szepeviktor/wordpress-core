window.wp=window.wp||{},function(t){function e(t,e){var i=this;Backbone.history._hasPushState&&Backbone.Router.prototype.navigate.call(i,t,e)}var i,s;i=wp.themes=wp.themes||{},i.data=_wpThemeSettings,s=i.data.l10n,i.isInstall=!!i.data.settings.isInstall,_.extend(i,{model:{},view:{},routes:{},router:{},template:wp.template}),i.Model=Backbone.Model.extend({initialize:function(){var t;-1!==_.indexOf(i.data.installedThemes,this.get("slug"))&&this.set({installed:!0}),this.set({id:this.get("slug")||this.get("id")}),this.has("sections")&&(t=this.get("sections").description,this.set({description:t}))}}),i.view.Appearance=wp.Backbone.View.extend({el:"#wpbody-content .wrap .theme-browser",window:t(window),page:0,initialize:function(t){_.bindAll(this,"scroller"),this.SearchView=t.SearchView?t.SearchView:i.view.Search,this.window.bind("scroll",_.throttle(this.scroller,300))},render:function(){this.view=new i.view.Themes({collection:this.collection,parent:this}),this.search(),this.$el.removeClass("search-loading"),this.view.render(),this.$el.empty().append(this.view.el).addClass("rendered")},searchContainer:t(".search-form"),search:function(){var e,r=this;1!==i.data.themes.length&&(e=new this.SearchView({collection:r.collection,parent:this}),r.SearchView=e,e.render(),this.searchContainer.append(t.parseHTML('<label class="screen-reader-text" for="wp-filter-search-input">'+s.search+"</label>")).append(e.el).on("submit",function(t){t.preventDefault()}))},scroller:function(){var t,e,i=this;t=this.window.scrollTop()+i.window.height(),e=i.$el.offset().top+i.$el.outerHeight(!1)-i.window.height(),e=Math.round(.9*e),t>e&&this.trigger("theme:scroll")}}),i.Collection=Backbone.Collection.extend({model:i.Model,terms:"",doSearch:function(e){this.terms!==e&&(this.terms=e,this.terms.length>0&&this.search(this.terms),""===this.terms&&(this.reset(i.data.themes),t("body").removeClass("no-results")),this.trigger("themes:update"))},search:function(e){var s,r,n,a,o,h;this.reset(i.data.themes,{silent:!0}),e=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),e=e.replace(/ /g,")(?=.*"),s=new RegExp("^(?=.*"+e+").+","i"),r=this.filter(function(t){return a=t.get("name").replace(/(<([^>]+)>)/gi,""),o=t.get("description").replace(/(<([^>]+)>)/gi,""),h=t.get("author").replace(/(<([^>]+)>)/gi,""),n=_.union([a,t.get("id"),o,h,t.get("tags")]),s.test(t.get("author"))&&e.length>2&&t.set("displayAuthor",!0),s.test(n)}),0===r.length?this.trigger("query:empty"):t("body").removeClass("no-results"),this.reset(r)},paginate:function(t){var e=this;return t=t||0,e=_(e.rest(20*t)),e=_(e.first(20))},count:!1,query:function(e){var i,s,r,n=this.queries,a=this;if(this.currentQuery.request=e,i=_.find(n,function(t){return _.isEqual(t.request,e)}),s=_.has(e,"page"),s||(this.currentQuery.page=1),i||s){if(s)return this.apiCall(e,s).done(function(t){a.add(t.themes),a.trigger("query:success"),a.loadingThemes=!1}).fail(function(){a.trigger("query:fail")});0===i.themes.length?a.trigger("query:empty"):t("body").removeClass("no-results"),_.isNumber(i.total)&&(this.count=i.total),this.reset(i.themes),i.total||(this.count=this.length),this.trigger("themes:update"),this.trigger("query:success",this.count)}else i=this.apiCall(e).done(function(t){t.themes&&(a.reset(t.themes),r=t.info.results,n.push({themes:t.themes,request:e,total:r})),a.trigger("themes:update"),a.trigger("query:success",r),t.themes&&0===t.themes.length&&a.trigger("query:empty")}).fail(function(){a.trigger("query:fail")})},queries:[],currentQuery:{page:1,request:{}},apiCall:function(e,i){return wp.ajax.send("query-themes",{data:{request:_.extend({per_page:100},e)},beforeSend:function(){i||t("body").addClass("loading-content").removeClass("no-results")}})},loadingThemes:!1}),i.view.Theme=wp.Backbone.View.extend({className:"theme",state:"grid",html:i.template("theme"),events:{click:i.isInstall?"preview":"expand",keydown:i.isInstall?"preview":"expand",touchend:i.isInstall?"preview":"expand",keyup:"addFocus",touchmove:"preventExpand","click .theme-install":"installTheme","click .update-message":"updateTheme"},touchDrag:!1,initialize:function(){this.model.on("change",this.render,this)},render:function(){var t=this.model.toJSON();this.$el.html(this.html(t)).attr({tabindex:0,"aria-describedby":t.id+"-action "+t.id+"-name","data-slug":t.id}),this.activeTheme(),this.model.get("displayAuthor")&&this.$el.addClass("display-author")},activeTheme:function(){this.model.get("active")&&this.$el.addClass("active")},addFocus:function(){var e=t(":focus").hasClass("theme")?t(":focus"):t(":focus").parents(".theme");t(".theme.focus").removeClass("focus"),e.addClass("focus")},expand:function(e){var s=this;if(e=e||window.event,"keydown"!==e.type||13===e.which||32===e.which)return!0===this.touchDrag?this.touchDrag=!1:void(t(e.target).is(".theme-actions a")||t(e.target).is(".theme-actions a, .update-message, .button-link, .notice-dismiss")||(i.focusedTheme=this.$el,this.trigger("theme:expand",s.model.cid)))},preventExpand:function(){this.touchDrag=!0},preview:function(e){var s,r,n=this;if(e=e||window.event,!0===this.touchDrag)return this.touchDrag=!1;t(e.target).not(".install-theme-preview").parents(".theme-actions").length||"keydown"===e.type&&13!==e.which&&32!==e.which||"keydown"===e.type&&13!==e.which&&t(":focus").hasClass("button")||(e.preventDefault(),e=e||window.event,i.focusedTheme=this.$el,i.preview=r=new i.view.Preview({model:this.model}),r.render(),this.setNavButtonsState(),1===this.model.collection.length?r.$el.addClass("no-navigation"):r.$el.removeClass("no-navigation"),t("div.wrap").append(r.el),this.listenTo(r,"theme:next",function(){if(s=n.model,_.isUndefined(n.current)||(s=n.current),n.current=n.model.collection.at(n.model.collection.indexOf(s)+1),_.isUndefined(n.current))return n.options.parent.parent.trigger("theme:end"),n.current=s;r.model=n.current,r.render(),this.setNavButtonsState(),t(".next-theme").focus()}).listenTo(r,"theme:previous",function(){s=n.model,0!==n.model.collection.indexOf(n.current)&&(_.isUndefined(n.current)||(s=n.current),n.current=n.model.collection.at(n.model.collection.indexOf(s)-1),_.isUndefined(n.current)||(r.model=n.current,r.render(),this.setNavButtonsState(),t(".previous-theme").focus()))}),this.listenTo(r,"preview:close",function(){n.current=n.model}))},setNavButtonsState:function(){var e=t(".theme-install-overlay"),i=_.isUndefined(this.current)?this.model:this.current,s=e.find(".previous-theme"),r=e.find(".next-theme");0===this.model.collection.indexOf(i)&&(s.addClass("disabled").prop("disabled",!0),r.focus()),_.isUndefined(this.model.collection.at(this.model.collection.indexOf(i)+1))&&(r.addClass("disabled").prop("disabled",!0),s.focus())},installTheme:function(e){var i=this;e.preventDefault(),wp.updates.maybeRequestFilesystemCredentials(e),t(document).on("wp-theme-install-success",function(t,e){i.model.get("id")===e.slug&&i.model.set({installed:!0})}),wp.updates.installTheme({slug:t(e.target).data("slug")})},updateTheme:function(e){var i=this;this.model.get("hasPackage")&&(e.preventDefault(),wp.updates.maybeRequestFilesystemCredentials(e),t(document).on("wp-theme-update-success",function(t,e){i.model.off("change",i.render,i),i.model.get("id")===e.slug&&i.model.set({hasUpdate:!1,version:e.newVersion}),i.model.on("change",i.render,i)}),wp.updates.updateTheme({slug:t(e.target).parents("div.theme").first().data("slug")}))}}),i.view.Details=wp.Backbone.View.extend({className:"theme-overlay",events:{click:"collapse","click .delete-theme":"deleteTheme","click .left":"previousTheme","click .right":"nextTheme","click #update-theme":"updateTheme"},html:i.template("theme-single"),render:function(){var t=this.model.toJSON();this.$el.html(this.html(t)),this.activeTheme(),this.navigation(),this.screenshotCheck(this.$el),this.containFocus(this.$el)},activeTheme:function(){this.$el.toggleClass("active",this.model.get("active"))},containFocus:function(e){_.delay(function(){t(".theme-overlay").focus()},100),e.on("keydown.wp-themes",function(t){var i=e.find(".theme-header button:not(.disabled)").first(),s=e.find(".theme-actions a:visible").last();9===t.which&&(i[0]===t.target&&t.shiftKey?(s.focus(),t.preventDefault()):s[0]!==t.target||t.shiftKey||(i.focus(),t.preventDefault()))})},collapse:function(e){var s,r=this;e=e||window.event,1!==i.data.themes.length&&(t(e.target).is(".theme-backdrop")||t(e.target).is(".close")||27===e.keyCode)&&(t("body").addClass("closing-overlay"),this.$el.fadeOut(130,function(){t("body").removeClass("closing-overlay"),r.closeOverlay(),s=document.body.scrollTop,i.router.navigate(i.router.baseUrl("")),document.body.scrollTop=s,i.focusedTheme&&i.focusedTheme.focus()}))},navigation:function(){this.model.cid===this.model.collection.at(0).cid&&this.$el.find(".left").addClass("disabled").prop("disabled",!0),this.model.cid===this.model.collection.at(this.model.collection.length-1).cid&&this.$el.find(".right").addClass("disabled").prop("disabled",!0)},closeOverlay:function(){t("body").removeClass("modal-open"),this.remove(),this.unbind(),this.trigger("theme:collapse")},updateTheme:function(e){var i=this;e.preventDefault(),wp.updates.maybeRequestFilesystemCredentials(e),t(document).on("wp-theme-update-success",function(t,e){i.model.get("id")===e.slug&&i.model.set({hasUpdate:!1,version:e.newVersion}),i.render()}),wp.updates.updateTheme({slug:t(e.target).data("slug")})},deleteTheme:function(e){var s=this,r=s.model.collection,n=i;e.preventDefault(),window.confirm(wp.themes.data.settings.confirmDelete)&&(wp.updates.maybeRequestFilesystemCredentials(e),t(document).one("wp-theme-delete-success",function(e,i){s.$el.find(".close").trigger("click"),t('[data-slug="'+i.slug+'"]').css({backgroundColor:"#faafaa"}).fadeOut(350,function(){t(this).remove(),n.data.themes=_.without(n.data.themes,_.findWhere(n.data.themes,{id:i.slug})),t(".wp-filter-search").val(""),r.doSearch(""),r.remove(s.model),r.trigger("themes:update")})}),wp.updates.deleteTheme({slug:this.model.get("id")}))},nextTheme:function(){var t=this;return t.trigger("theme:next",t.model.cid),!1},previousTheme:function(){var t=this;return t.trigger("theme:previous",t.model.cid),!1},screenshotCheck:function(t){var e,i;e=t.find(".screenshot img"),i=new Image,i.src=e.attr("src"),i.width&&i.width<=300&&t.addClass("small-screenshot")}}),i.view.Preview=i.view.Details.extend({className:"wp-full-overlay expanded",el:".theme-install-overlay",events:{"click .close-full-overlay":"close","click .collapse-sidebar":"collapse","click .devices button":"previewDevice","click .previous-theme":"previousTheme","click .next-theme":"nextTheme",keyup:"keyEvent","click .theme-install":"installTheme"},html:i.template("theme-preview"),render:function(){var e,s=this,r=this.model.toJSON(),n=t(document.body);n.attr("aria-busy","true"),this.$el.removeClass("iframe-ready").html(this.html(r)),e=this.$el.data("current-preview-device"),e&&s.tooglePreviewDeviceButtons(e),i.router.navigate(i.router.baseUrl(i.router.themePath+this.model.get("id")),{replace:!1}),this.$el.fadeIn(200,function(){n.addClass("theme-installer-active full-overlay-active")}),this.$el.find("iframe").one("load",function(){s.iframeLoaded()})},iframeLoaded:function(){this.$el.addClass("iframe-ready"),t(document.body).attr("aria-busy","false")},close:function(){return this.$el.fadeOut(200,function(){t("body").removeClass("theme-installer-active full-overlay-active"),i.focusedTheme&&i.focusedTheme.focus()}).removeClass("iframe-ready"),i.router.selectedTab?(i.router.navigate(i.router.baseUrl("?browse="+i.router.selectedTab)),i.router.selectedTab=!1):i.router.navigate(i.router.baseUrl("")),this.trigger("preview:close"),this.undelegateEvents(),this.unbind(),!1},collapse:function(e){var i=t(e.currentTarget);return"true"===i.attr("aria-expanded")?i.attr({"aria-expanded":"false","aria-label":s.expandSidebar}):i.attr({"aria-expanded":"true","aria-label":s.collapseSidebar}),this.$el.toggleClass("collapsed").toggleClass("expanded"),!1},previewDevice:function(e){var i=t(e.currentTarget).data("device");this.$el.removeClass("preview-desktop preview-tablet preview-mobile").addClass("preview-"+i).data("current-preview-device",i),this.tooglePreviewDeviceButtons(i)},tooglePreviewDeviceButtons:function(e){var i=t(".wp-full-overlay-footer .devices");i.find("button").removeClass("active").attr("aria-pressed",!1),i.find("button.preview-"+e).addClass("active").attr("aria-pressed",!0)},keyEvent:function(t){27===t.keyCode&&(this.undelegateEvents(),this.close()),39===t.keyCode&&_.once(this.nextTheme()),37===t.keyCode&&this.previousTheme()},installTheme:function(e){var i=this,s=t(e.target);e.preventDefault(),s.hasClass("disabled")||(wp.updates.maybeRequestFilesystemCredentials(e),t(document).on("wp-theme-install-success",function(){i.model.set({installed:!0})}),wp.updates.installTheme({slug:s.data("slug")}))}}),i.view.Themes=wp.Backbone.View.extend({className:"themes wp-clearfix",$overlay:t("div.theme-overlay"),index:0,count:t(".wrap .theme-count"),liveThemeCount:0,initialize:function(e){var i=this;this.parent=e.parent,this.setView("grid"),i.currentTheme(),this.listenTo(i.collection,"themes:update",function(){i.parent.page=0,i.currentTheme(),i.render(this)}),this.listenTo(i.collection,"query:success",function(t){_.isNumber(t)?(i.count.text(t),i.announceSearchResults(t)):(i.count.text(i.collection.length),i.announceSearchResults(i.collection.length))}),this.listenTo(i.collection,"query:empty",function(){t("body").addClass("no-results")}),this.listenTo(this.parent,"theme:scroll",function(){i.renderThemes(i.parent.page)}),this.listenTo(this.parent,"theme:close",function(){i.overlay&&i.overlay.closeOverlay()}),t("body").on("keyup",function(e){i.overlay&&(t("#request-filesystem-credentials-dialog").is(":visible")||(39===e.keyCode&&i.overlay.nextTheme(),37===e.keyCode&&i.overlay.previousTheme(),27===e.keyCode&&i.overlay.collapse(e)))})},render:function(){this.$el.empty(),1===i.data.themes.length&&(this.singleTheme=new i.view.Details({model:this.collection.models[0]}),this.singleTheme.render(),this.$el.addClass("single-theme"),this.$el.append(this.singleTheme.el)),this.options.collection.size()>0&&this.renderThemes(this.parent.page),this.liveThemeCount=this.collection.count?this.collection.count:this.collection.length,this.count.text(this.liveThemeCount),i.isInstall||this.announceSearchResults(this.liveThemeCount)},renderThemes:function(e){var r=this;if(r.instance=r.collection.paginate(e),0===r.instance.size())return void this.parent.trigger("theme:end");!i.isInstall&&e>=1&&t(".add-new-theme").remove(),r.instance.each(function(t){r.theme=new i.view.Theme({model:t,parent:r}),r.theme.render(),r.$el.append(r.theme.el),r.listenTo(r.theme,"theme:expand",r.expand,r)}),!i.isInstall&&i.data.settings.canInstall&&this.$el.append('<div class="theme add-new-theme"><a href="'+i.data.settings.installURI+'"><div class="theme-screenshot"><span></span></div><h2 class="theme-name">'+s.addNew+"</h2></a></div>"),this.parent.page++},currentTheme:function(){var t,e=this;(t=e.collection.findWhere({active:!0}))&&(e.collection.remove(t),e.collection.add(t,{at:0}))},setView:function(t){return t},expand:function(e){var s,r,n=this;this.model=n.collection.get(e),i.router.navigate(i.router.baseUrl(i.router.themePath+this.model.id)),this.setView("detail"),t("body").addClass("modal-open"),this.overlay=new i.view.Details({model:n.model}),this.overlay.render(),this.model.get("hasUpdate")&&(s=t('[data-slug="'+this.model.id+'"]'),r=t(this.overlay.el),s.find(".updating-message").length?(r.find(".notice-warning h3").remove(),r.find(".notice-warning").removeClass("notice-large").addClass("updating-message").find("p").text(wp.updates.l10n.updating)):s.find(".notice-error").length&&r.find(".notice-warning").remove()),this.$overlay.html(this.overlay.el),this.listenTo(this.overlay,"theme:next",function(){n.next([n.model.cid])}).listenTo(this.overlay,"theme:previous",function(){n.previous([n.model.cid])})},next:function(t){var e,i,s=this;e=s.collection.get(t[0]),(i=s.collection.at(s.collection.indexOf(e)+1))!==undefined&&(this.overlay.closeOverlay(),s.theme.trigger("theme:expand",i.cid))},previous:function(t){var e,i,s=this;e=s.collection.get(t[0]),(i=s.collection.at(s.collection.indexOf(e)-1))!==undefined&&(this.overlay.closeOverlay(),s.theme.trigger("theme:expand",i.cid))},announceSearchResults:function(t){0===t?wp.a11y.speak(s.noThemesFound):wp.a11y.speak(s.themesFound.replace("%d",t))}}),i.view.Search=wp.Backbone.View.extend({tagName:"input",className:"wp-filter-search",id:"wp-filter-search-input",searching:!1,attributes:{placeholder:s.searchPlaceholder,type:"search","aria-describedby":"live-search-desc"},events:{input:"search",keyup:"search",blur:"pushState"},initialize:function(t){this.parent=t.parent,this.listenTo(this.parent,"theme:close",function(){this.searching=!1})},search:function(t){"keyup"===t.type&&27===t.which&&(t.target.value=""),this.doSearch(t)},doSearch:function(t){var e={};this.collection.doSearch(t.target.value.replace(/\+/g," ")),this.searching&&13!==t.which?e.replace=!0:this.searching=!0,t.target.value?i.router.navigate(i.router.baseUrl(i.router.searchPath+t.target.value),e):i.router.navigate(i.router.baseUrl(""))},pushState:function(t){var e=i.router.baseUrl("");t.target.value&&(e=i.router.baseUrl(i.router.searchPath+encodeURIComponent(t.target.value))),this.searching=!1,i.router.navigate(e)}}),i.Router=Backbone.Router.extend({routes:{"themes.php?theme=:slug":"theme","themes.php?search=:query":"search","themes.php?s=:query":"search","themes.php":"themes","":"themes"},baseUrl:function(t){return"themes.php"+t},themePath:"?theme=",searchPath:"?search=",search:function(e){t(".wp-filter-search").val(e.replace(/\+/g," "))},themes:function(){t(".wp-filter-search").val("")},navigate:e}),i.Run={init:function(){this.themes=new i.Collection(i.data.themes),this.view=new i.view.Appearance({collection:this.themes}),this.render(),this.view.SearchView.doSearch=_.debounce(this.view.SearchView.doSearch,500)},render:function(){this.view.render(),this.routes(),Backbone.History.started&&Backbone.history.stop(),Backbone.history.start({root:i.data.settings.adminUrl,pushState:!0,hashChange:!1})},routes:function(){var e=this;i.router=new i.Router,i.router.on("route:theme",function(t){e.view.view.expand(t)}),i.router.on("route:themes",function(){e.themes.doSearch(""),e.view.trigger("theme:close")}),i.router.on("route:search",function(){t(".wp-filter-search").trigger("keyup")}),this.extraRoutes()},extraRoutes:function(){return!1}},i.view.InstallerSearch=i.view.Search.extend({events:{input:"search",keyup:"search"},terms:"",search:function(t){("keyup"!==t.type||9!==t.which&&16!==t.which)&&(this.collection=this.options.parent.view.collection,"keyup"===t.type&&27===t.which&&(t.target.value=""),this.doSearch(t.target.value))},doSearch:function(e){var s={};this.terms!==e&&(this.terms=e,s.search=e,"author:"===e.substring(0,7)&&(s.search="",s.author=e.slice(7)),"tag:"===e.substring(0,4)&&(s.search="",s.tag=[e.slice(4)]),t(".filter-links li > a.current").removeClass("current").removeAttr("aria-current"),t("body").removeClass("show-filters filters-applied show-favorites-form"),t(".drawer-toggle").attr("aria-expanded","false"),this.collection.query(s),i.router.navigate(i.router.baseUrl(i.router.searchPath+encodeURIComponent(e)),{replace:!0}))}}),i.view.Installer=i.view.Appearance.extend({el:"#wpbody-content .wrap",events:{"click .filter-links li > a":"onSort","click .theme-filter":"onFilter","click .drawer-toggle":"moreFilters","click .filter-drawer .apply-filters":"applyFilters",'click .filter-group [type="checkbox"]':"addFilter","click .filter-drawer .clear-filters":"clearFilters","click .edit-filters":"backToFilters","click .favorites-form-submit":"saveUsername","keyup #wporg-username-input":"saveUsername"},render:function(){var e=this;this.search(),this.uploader(),this.collection=new i.Collection,this.listenTo(this,"theme:end",function(){e.collection.loadingThemes||(e.collection.loadingThemes=!0,e.collection.currentQuery.page++,_.extend(e.collection.currentQuery.request,{page:e.collection.currentQuery.page}),e.collection.query(e.collection.currentQuery.request))}),this.listenTo(this.collection,"query:success",function(){t("body").removeClass("loading-content"),t(".theme-browser").find("div.error").remove()}),this.listenTo(this.collection,"query:fail",function(){t("body").removeClass("loading-content"),t(".theme-browser").find("div.error").remove(),t(".theme-browser").find("div.themes").before('<div class="error"><p>'+s.error+'</p><p><button class="button try-again">'+s.tryAgain+"</button></p></div>"),t(".theme-browser .error .try-again").on("click",function(e){e.preventDefault(),t("input.wp-filter-search").trigger("input")})}),this.view&&this.view.remove(),this.view=new i.view.Themes({collection:this.collection,parent:this}),this.page=0,this.$el.find(".themes").remove(),this.view.render(),this.$el.find(".theme-browser").append(this.view.el).addClass("rendered")},browse:function(t){this.collection.query({browse:t})},onSort:function(e){var s=t(e.target),r=s.data("sort");e.preventDefault(),t("body").removeClass("filters-applied show-filters"),t(".drawer-toggle").attr("aria-expanded","false"),s.hasClass(this.activeClass)||(this.sort(r),i.router.navigate(i.router.baseUrl(i.router.browsePath+r)))},sort:function(e){this.clearSearch(),i.router.selectedTab=e,t(".filter-links li > a, .theme-filter").removeClass(this.activeClass).removeAttr("aria-current"),t('[data-sort="'+e+'"]').addClass(this.activeClass).attr("aria-current","page"),"favorites"===e?t("body").addClass("show-favorites-form"):t("body").removeClass("show-favorites-form"),this.browse(e)},onFilter:function(e){var i,s=t(e.target),r=s.data("filter");s.hasClass(this.activeClass)||(t(".filter-links li > a, .theme-section").removeClass(this.activeClass).removeAttr("aria-current"),s.addClass(this.activeClass).attr("aria-current","page"),r&&(r=_.union([r,this.filtersChecked()]),i={tag:[r]},this.collection.query(i)))},addFilter:function(){this.filtersChecked()},applyFilters:function(e){var i,r=this.filtersChecked(),n={tag:r},a=t(".filtered-by .tags");if(e&&e.preventDefault(),!r)return void wp.a11y.speak(s.selectFeatureFilter);t("body").addClass("filters-applied"),t(".filter-links li > a.current").removeClass("current").removeAttr("aria-current"),a.empty(),_.each(r,function(e){i=t('label[for="filter-id-'+e+'"]').text(),a.append('<span class="tag">'+i+"</span>")}),this.collection.query(n)},saveUsername:function(e){var i=t("#wporg-username-input").val(),s=t("#wporg-username-nonce").val(),r={browse:"favorites",user:i},n=this;if(e&&e.preventDefault(),"keyup"!==e.type||13===e.which)return wp.ajax.send("save-wporg-username",{data:{_wpnonce:s,username:i},success:function(){n.collection.query(r)}})},filtersChecked:function(){var e=t(".filter-group").find(":checkbox"),i=[];return _.each(e.filter(":checked"),function(e){i.push(t(e).prop("value"))}),0===i.length?(t(".filter-drawer .apply-filters").find("span").text(""),t(".filter-drawer .clear-filters").hide(),t("body").removeClass("filters-applied"),!1):(t(".filter-drawer .apply-filters").find("span").text(i.length),t(".filter-drawer .clear-filters").css("display","inline-block"),i)},activeClass:"current",uploader:function(){var e=t(".upload-view-toggle"),i=t(document.body);e.on("click",function(){i.toggleClass("show-upload-view"),e.attr("aria-expanded",i.hasClass("show-upload-view"))})},moreFilters:function(e){var s=t("body"),r=t(".drawer-toggle");if(e.preventDefault(),s.hasClass("filters-applied"))return this.backToFilters();this.clearSearch(),i.router.navigate(i.router.baseUrl("")),s.toggleClass("show-filters"),r.attr("aria-expanded",s.hasClass("show-filters"))},clearFilters:function(e){var i=t(".filter-group").find(":checkbox"),s=this;e.preventDefault(),_.each(i.filter(":checked"),function(e){return t(e).prop("checked",!1),s.filtersChecked()})},backToFilters:function(e){e&&e.preventDefault(),t("body").removeClass("filters-applied")},clearSearch:function(){t("#wp-filter-search-input").val("")}}),i.InstallerRouter=Backbone.Router.extend({routes:{"theme-install.php?theme=:slug":"preview","theme-install.php?browse=:sort":"sort","theme-install.php?search=:query":"search","theme-install.php":"sort"},baseUrl:function(t){return"theme-install.php"+t},themePath:"?theme=",browsePath:"?browse=",searchPath:"?search=",search:function(e){t(".wp-filter-search").val(e.replace(/\+/g," "))},navigate:e}),i.RunInstaller={init:function(){this.view=new i.view.Installer({section:"featured",SearchView:i.view.InstallerSearch}),this.render(),this.view.SearchView.doSearch=_.debounce(this.view.SearchView.doSearch,500)},render:function(){this.view.render(),this.routes(),Backbone.History.started&&Backbone.history.stop(),Backbone.history.start({root:i.data.settings.adminUrl,pushState:!0,hashChange:!1})},routes:function(){var e=this,s={};i.router=new i.InstallerRouter,i.router.on("route:preview",function(r){i.preview&&(i.preview.undelegateEvents(),i.preview.unbind()),e.view.view.theme&&e.view.view.theme.preview?(e.view.view.theme.model=e.view.collection.findWhere({slug:r}),e.view.view.theme.preview()):(s.theme=r,e.view.collection.query(s),e.view.collection.trigger("update"),e.view.collection.once("query:success",function(){t('div[data-slug="'+r+'"]').trigger("click")}))}),i.router.on("route:sort",function(t){t||(t="featured",i.router.navigate(i.router.baseUrl("?browse=featured"),{replace:!0})),e.view.sort(t),i.preview&&i.preview.close()}),i.router.on("route:search",function(){t(".wp-filter-search").focus().trigger("keyup")}),this.extraRoutes()},extraRoutes:function(){return!1}},t(document).ready(function(){i.isInstall?i.RunInstaller.init():i.Run.init(),t(document.body).on("click",".load-customize",function(){var e=t(this),i=document.createElement("a");i.href=e.prop("href"),i.search=t.param(_.extend(wp.customize.utils.parseQueryString(i.search.substr(1)),{"return":window.location.href})),e.prop("href",i.href)}),t(".broken-themes .delete-theme").on("click",function(){return confirm(_wpThemeSettings.settings.confirmDelete)})})}(jQuery),jQuery(document).ready(function(t){window.tb_position=function(){var e=t("#TB_window"),i=t(window).width(),s=t(window).height(),r=1040<i?1040:i,n=0;t("#wpadminbar").length&&(n=parseInt(t("#wpadminbar").css("height"),10)),e.size()&&(e.width(r-50).height(s-45-n),t("#TB_iframeContent").width(r-50).height(s-75-n),e.css({"margin-left":"-"+parseInt((r-50)/2,10)+"px"}),"undefined"!=typeof document.body.style.maxWidth&&e.css({top:20+n+"px","margin-top":"0"}))},t(window).resize(function(){tb_position()})});