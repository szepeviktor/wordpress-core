!function(t,e){function i(t,e){function i(s){s||(t.expanded.unbind(i),e.focus())}t.focus(),t.expanded.bind(i)}function s(t){var e,i={number:null,id_base:null};return e=t.match(/^(.+)-(\d+)$/),e?(i.id_base=e[1],i.number=parseInt(e[2],10)):i.id_base=t,i}function r(t){var e,i=s(t);return e="widget_"+i.id_base,i.number&&(e+="["+i.number+"]"),e}if(t&&t.customize){var n,a=t.customize;a.Widgets=a.Widgets||{},a.Widgets.savedWidgetIds={},a.Widgets.data=_wpCustomizeWidgetsSettings||{},n=a.Widgets.data.l10n,a.Widgets.WidgetModel=Backbone.Model.extend({id:null,temp_id:null,classname:null,control_tpl:null,description:null,is_disabled:null,is_multi:null,multi_number:null,name:null,id_base:null,transport:null,params:[],width:null,height:null,search_matched:!0}),a.Widgets.WidgetCollection=Backbone.Collection.extend({model:a.Widgets.WidgetModel,doSearch:function(t){this.terms!==t&&(this.terms=t,this.terms.length>0&&this.search(this.terms),""===this.terms&&this.each(function(t){t.set("search_matched",!0)}))},search:function(t){var e,i;t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),t=t.replace(/ /g,")(?=.*"),e=new RegExp("^(?=.*"+t+").+","i"),this.each(function(t){i=[t.get("name"),t.get("id"),t.get("description")].join(" "),t.set("search_matched",e.test(i))})}}),a.Widgets.availableWidgets=new a.Widgets.WidgetCollection(a.Widgets.data.availableWidgets),a.Widgets.SidebarModel=Backbone.Model.extend({after_title:null,after_widget:null,before_title:null,before_widget:null,"class":null,description:null,id:null,name:null,is_rendered:!1}),a.Widgets.SidebarCollection=Backbone.Collection.extend({model:a.Widgets.SidebarModel}),a.Widgets.registeredSidebars=new a.Widgets.SidebarCollection(a.Widgets.data.registeredSidebars),a.Widgets.AvailableWidgetsPanelView=t.Backbone.View.extend({el:"#available-widgets",events:{"input #widgets-search":"search","keyup #widgets-search":"search","focus .widget-tpl":"focus","click .widget-tpl":"_submit","keypress .widget-tpl":"_submit",keydown:"keyboardAccessible"},selected:null,currentSidebarControl:null,$search:null,$clearResults:null,searchMatchesCount:null,initialize:function(){var t=this;this.$search=e("#widgets-search"),this.$clearResults=this.$el.find(".clear-results"),_.bindAll(this,"close"),this.listenTo(this.collection,"change",this.updateList),this.updateList(),this.searchMatchesCount=this.collection.length,e("#customize-controls, #available-widgets .customize-section-title").on("click keydown",function(i){var s=e(i.target).is(".add-new-widget, .add-new-widget *");e("body").hasClass("adding-widget")&&!s&&t.close()}),this.$clearResults.on("click",function(){t.$search.val("").focus().trigger("keyup")}),a.previewer.bind("url",this.close)},search:function(t){var e;this.collection.doSearch(t.target.value),this.updateSearchMatchesCount(),this.announceSearchMatches(),this.selected&&!this.selected.is(":visible")&&(this.selected.removeClass("selected"),this.selected=null),this.selected&&!t.target.value&&(this.selected.removeClass("selected"),this.selected=null),!this.selected&&t.target.value&&(e=this.$el.find("> .widget-tpl:visible:first"),e.length&&this.select(e)),""!==t.target.value?this.$clearResults.addClass("is-visible"):""===t.target.value&&this.$clearResults.removeClass("is-visible"),this.searchMatchesCount?this.$el.removeClass("no-widgets-found"):this.$el.addClass("no-widgets-found")},updateSearchMatchesCount:function(){this.searchMatchesCount=this.collection.where({search_matched:!0}).length},announceSearchMatches:_.debounce(function(){var e=n.widgetsFound.replace("%d",this.searchMatchesCount);this.searchMatchesCount||(e=n.noWidgetsFound),t.a11y.speak(e)},500),updateList:function(){this.collection.each(function(t){var i=e("#widget-tpl-"+t.id);i.toggle(t.get("search_matched")&&!t.get("is_disabled")),t.get("is_disabled")&&i.is(this.selected)&&(this.selected=null)})},select:function(t){this.selected=e(t),this.selected.siblings(".widget-tpl").removeClass("selected"),this.selected.addClass("selected")},focus:function(t){this.select(e(t.currentTarget))},_submit:function(t){"keypress"===t.type&&13!==t.which&&32!==t.which||this.submit(e(t.currentTarget))},submit:function(t){var i,s,r;t||(t=this.selected),t&&this.currentSidebarControl&&(this.select(t),i=e(this.selected).data("widget-id"),(s=this.collection.findWhere({id:i}))&&(r=this.currentSidebarControl.addWidget(s.get("id_base")),r&&r.focus(),this.close()))},open:function(t){this.currentSidebarControl=t,_(this.currentSidebarControl.getWidgetFormControls()).each(function(t){t.params.is_wide&&t.collapseForm()}),a.section.has("publish_settings")&&a.section("publish_settings").collapse(),e("body").addClass("adding-widget"),this.$el.find(".selected").removeClass("selected"),this.collection.doSearch(""),a.settings.browser.mobile||this.$search.focus()},close:function(t){t=t||{},t.returnFocus&&this.currentSidebarControl&&this.currentSidebarControl.container.find(".add-new-widget").focus(),this.currentSidebarControl=null,this.selected=null,e("body").removeClass("adding-widget"),this.$search.val("")},keyboardAccessible:function(t){var i=13===t.which,s=27===t.which,r=40===t.which,n=38===t.which,a=9===t.which,o=t.shiftKey,h=null,d=this.$el.find("> .widget-tpl:visible:first"),c=this.$el.find("> .widget-tpl:visible:last"),l=e(t.target).is(this.$search),u=e(t.target).is(".widget-tpl:visible:last");if(r||n)return r?l?h=d:this.selected&&0!==this.selected.nextAll(".widget-tpl:visible").length&&(h=this.selected.nextAll(".widget-tpl:visible:first")):n&&(l?h=c:this.selected&&0!==this.selected.prevAll(".widget-tpl:visible").length&&(h=this.selected.prevAll(".widget-tpl:visible:first"))),this.select(h),void(h?h.focus():this.$search.focus());i&&!this.$search.val()||(i?this.submit():s&&this.close({returnFocus:!0}),this.currentSidebarControl&&a&&(o&&l||!o&&u)&&(this.currentSidebarControl.container.find(".add-new-widget").focus(),t.preventDefault()))}}),a.Widgets.formSyncHandlers={rss:function(t,i,s){var r=i.find(".widget-error:first"),n=e("<div>"+s+"</div>").find(".widget-error:first");r.length&&n.length?r.replaceWith(n):r.length?r.remove():n.length&&i.find(".widget-content:first").prepend(n)}},a.Widgets.WidgetControl=a.Control.extend({defaultExpandedArguments:{duration:"fast",completeCallback:e.noop},initialize:function(t,i){var s=this;s.widgetControlEmbedded=!1,s.widgetContentEmbedded=!1,s.expanded=new a.Value(!1),s.expandedArgumentsQueue=[],s.expanded.bind(function(t){var i=s.expandedArgumentsQueue.shift();i=e.extend({},s.defaultExpandedArguments,i),s.onChangeExpanded(t,i)}),s.altNotice=!0,a.Control.prototype.initialize.call(s,t,i)},ready:function(){var t=this;t.section()?a.section(t.section(),function(e){var i=function(s){s&&(t.embedWidgetControl(),e.expanded.unbind(i))};e.expanded()?i(!0):e.expanded.bind(i)}):t.embedWidgetControl()},embedWidgetControl:function(){var t,i=this;i.widgetControlEmbedded||(i.widgetControlEmbedded=!0,t=e(i.params.widget_control),i.container.append(t),i._setupModel(),i._setupWideWidget(),i._setupControlToggle(),i._setupWidgetTitle(),i._setupReorderUI(),i._setupHighlightEffects(),i._setupUpdateUI(),i._setupRemoveUI())},embedWidgetContent:function(){var t,i=this;i.embedWidgetControl(),i.widgetContentEmbedded||(i.widgetContentEmbedded=!0,i.notifications.container=i.getNotificationsContainerElement(),i.notifications.render(),t=e(i.params.widget_content),i.container.find(".widget-content:first").append(t),e(document).trigger("widget-added",[i.container.find(".widget:first")]))},_setupModel:function(){var t,e=this;t=function(){a.Widgets.savedWidgetIds[e.params.widget_id]=!0},a.bind("ready",t),a.bind("saved",t),this._updateCount=0,this.isWidgetUpdating=!1,this.liveUpdateMode=!0,this.setting.bind(function(t,i){_(i).isEqual(t)||e.isWidgetUpdating||e.updateWidget({instance:t})})},_setupWideWidget:function(){var t,i,s,r,n,o=this;!this.params.is_wide||e(window).width()<=640||(t=this.container.find(".widget-inside"),i=t.find("> .form"),s=e(".wp-full-overlay-sidebar-content:first"),this.container.addClass("wide-widget-control"),this.container.find(".form:first").css({"max-width":this.params.width,"min-height":this.params.height}),n=function(){var s,r=o.container.offset().top,n=e(window).height(),a=i.outerHeight();t.css("max-height",n),s=Math.max(0,Math.min(Math.max(r,0),n-a)),t.css("top",s)},r=e("#customize-theme-controls"),this.container.on("expand",function(){n(),s.on("scroll",n),e(window).on("resize",n),r.on("expanded collapsed",n)}),this.container.on("collapsed",function(){s.off("scroll",n),e(window).off("resize",n),r.off("expanded collapsed",n)}),a.each(function(t){0===t.id.indexOf("sidebars_widgets[")&&t.bind(function(){o.container.hasClass("expanded")&&n()})}))},_setupControlToggle:function(){var t,e=this;this.container.find(".widget-top").on("click",function(t){t.preventDefault(),e.getSidebarWidgetsControl().isReordering||e.expanded(!e.expanded())}),t=this.container.find(".widget-control-close"),t.on("click",function(t){t.preventDefault(),e.collapse(),e.container.find(".widget-top .widget-action:first").focus()})},_setupWidgetTitle:function(){var t,e=this;t=function(){var t=e.setting().title,i=e.container.find(".in-widget-title");t?i.text(": "+t):i.text("")},this.setting.bind(t),t()},_setupReorderUI:function(){var i,s,r,o,h,d=this;i=function(t){t.siblings(".selected").removeClass("selected"),t.addClass("selected");var e=t.data("id")===d.params.sidebar_id;d.container.find(".move-widget-btn").prop("disabled",e)},this.container.find(".widget-title-action").after(e(a.Widgets.data.tpl.widgetReorderNav)),h=_.template(a.Widgets.data.tpl.moveWidgetArea),s=e(h({sidebars:_(a.Widgets.registeredSidebars.toArray()).pluck("attributes")})),this.container.find(".widget-top").after(s),o=function(){var t,r=s.find("li"),n=0;t=r.filter(function(){return e(this).data("id")===d.params.sidebar_id}),r.each(function(){var s,r,o,h=e(this);s=h.data("id"),r=a.Widgets.registeredSidebars.get(s),o=r.get("is_rendered"),h.toggle(o),o&&(n+=1),h.hasClass("selected")&&!o&&i(t)}),n>1?d.container.find(".move-widget").show():d.container.find(".move-widget").hide()},o(),a.Widgets.registeredSidebars.on("change:is_rendered",o),r=this.container.find(".widget-reorder-nav"),r.find(".move-widget, .move-widget-down, .move-widget-up").each(function(){e(this).prepend(d.container.find(".widget-title").text()+": ")}).on("click keypress",function(i){if("keypress"!==i.type||13===i.which||32===i.which)if(e(this).focus(),e(this).is(".move-widget"))d.toggleWidgetMoveArea();else{var s=e(this).is(".move-widget-down"),r=e(this).is(".move-widget-up"),a=d.getWidgetSidebarPosition();if(r&&0===a||s&&a===d.getSidebarWidgetsControl().setting().length-1)return;r?(d.moveUp(),t.a11y.speak(n.widgetMovedUp)):(d.moveDown(),t.a11y.speak(n.widgetMovedDown)),e(this).focus()}}),this.container.find(".widget-area-select").on("click keypress","li",function(t){"keypress"===t.type&&13!==t.which&&32!==t.which||(t.preventDefault(),i(e(this)))}),this.container.find(".move-widget-btn").click(function(){d.getSidebarWidgetsControl().toggleReordering(!1);var t,e,i,s,r,n=d.params.sidebar_id,o=d.container.find(".widget-area-select li.selected").data("id");t=a("sidebars_widgets["+n+"]"),e=a("sidebars_widgets["+o+"]"),i=Array.prototype.slice.call(t()),s=Array.prototype.slice.call(e()),r=d.getWidgetSidebarPosition(),i.splice(r,1),s.push(d.params.widget_id),t(i),e(s),d.focus()})},_setupHighlightEffects:function(){var t=this;this.container.on("mouseenter click",function(){t.setting.previewer.send("highlight-widget",t.params.widget_id)}),this.setting.bind(function(){t.setting.previewer.send("highlight-widget",t.params.widget_id)})},_setupUpdateUI:function(){var t,i,s,r,o,h=this;t=this.container.find(".widget:first"),i=t.find(".widget-content:first"),s=this.container.find(".widget-control-save"),s.val(n.saveBtnLabel),s.attr("title",n.saveBtnTooltip),s.removeClass("button-primary"),s.on("click",function(t){t.preventDefault(),h.updateWidget({disable_form:!0})}),r=_.debounce(function(){h.updateWidget()},250),i.on("keydown","input",function(t){13===t.which&&(t.preventDefault(),h.updateWidget({ignoreActiveElement:!0}))}),i.on("change input propertychange",":input",function(t){h.liveUpdateMode&&("change"===t.type||this.checkValidity&&this.checkValidity())&&r()}),this.setting.previewer.channel.bind("synced",function(){h.container.removeClass("previewer-loading")}),a.previewer.bind("widget-updated",function(t){t===h.params.widget_id&&h.container.removeClass("previewer-loading")}),(o=a.Widgets.formSyncHandlers[this.params.widget_id_base])&&e(document).on("widget-synced",function(e,i){t.is(i)&&o.apply(document,arguments)})},onChangeActive:function(t,e){this.container.toggleClass("widget-rendered",t),e.completeCallback&&e.completeCallback()},_setupRemoveUI:function(){var t,e,i=this;t=this.container.find(".widget-control-remove"),t.on("click",function(t){t.preventDefault();var e;e=i.container.next().is(".customize-control-widget_form")?i.container.next().find(".widget-action:first"):i.container.prev().is(".customize-control-widget_form")?i.container.prev().find(".widget-action:first"):i.container.next(".customize-control-sidebar_widgets").find(".add-new-widget:first"),i.container.slideUp(function(){var t,s,r=a.Widgets.getSidebarWidgetControlContainingWidget(i.params.widget_id);r&&(t=r.setting().slice(),-1!==(s=_.indexOf(t,i.params.widget_id))&&(t.splice(s,1),r.setting(t),e.focus()))})}),e=function(){t.text(n.removeBtnLabel),t.attr("title",n.removeBtnTooltip)},this.params.is_new?a.bind("saved",e):e()},_getInputs:function(t){return e(t).find(":input[name]")},_getInputsSignature:function(t){return _(t).map(function(t){var i,s=e(t);return i=s.is(":checkbox, :radio")?[s.attr("id"),s.attr("name"),s.prop("value")]:[s.attr("id"),s.attr("name")],i.join(",")}).join(";")},_getInputState:function(t){return t=e(t),t.is(":radio, :checkbox")?t.prop("checked"):t.is("select[multiple]")?t.find("option:selected").map(function(){return e(this).val()}).get():t.val()},_setInputState:function(t,i){t=e(t),t.is(":radio, :checkbox")?t.prop("checked",i):t.is("select[multiple]")?(i=e.isArray(i)?_.map(i,function(t){return String(t)}):[],t.find("option").each(function(){e(this).prop("selected",-1!==_.indexOf(i,String(this.value)))})):t.val(i)},getSidebarWidgetsControl:function(){var t,e;if(t="sidebars_widgets["+this.params.sidebar_id+"]",e=a.control(t))return e},updateWidget:function(i){var s,r,o,h,d,c,l,u,p,m,g,f=this;f.embedWidgetContent(),i=e.extend({instance:null,complete:null,ignoreActiveElement:!1},i),s=i.instance,r=i.complete,this._updateCount+=1,d=this._updateCount,o=this.container.find(".widget:first"),h=o.find(".widget-content:first"),h.find(".widget-error").remove(),this.container.addClass("widget-form-loading"),this.container.addClass("previewer-loading"),p=a.state("processing"),p(p()+1),this.liveUpdateMode||this.container.addClass("widget-form-disabled"),c={},c.action="update-widget",c.wp_customize="on",c.nonce=a.settings.nonce["update-widget"],c.customize_theme=a.settings.theme.stylesheet,c.customized=t.customize.previewer.query().customized,l=e.param(c),u=this._getInputs(h),u.each(function(){e(this).data("state"+d,f._getInputState(this))}),l+=s?"&"+e.param({sanitized_widget_setting:JSON.stringify(s)}):"&"+u.serialize(),l+="&"+h.find("~ :input").serialize(),this._previousUpdateRequest&&this._previousUpdateRequest.abort(),m=e.post(t.ajax.settings.url,l),this._previousUpdateRequest=m,m.done(function(t){var s,c,l,p,m=!1;return"0"===t?(a.previewer.preview.iframe.hide(),void a.previewer.login().done(function(){f.updateWidget(i),a.previewer.preview.iframe.show()})):"-1"===t?void a.previewer.cheatin():void(t.success?(c=e("<div>"+t.data.form+"</div>"),l=f._getInputs(c),p=f._getInputsSignature(u)===f._getInputsSignature(l),p&&!f.liveUpdateMode&&(f.liveUpdateMode=!0,f.container.removeClass("widget-form-disabled"),f.container.find('input[name="savewidget"]').hide()),p&&f.liveUpdateMode?(u.each(function(t){var s,r,n,a=e(this),o=e(l[t]);s=a.data("state"+d),r=f._getInputState(o),a.data("sanitized",r),(n=!_.isEqual(s,r)&&(i.ignoreActiveElement||!a.is(document.activeElement)))&&f._setInputState(a,r)}),e(document).trigger("widget-synced",[o,t.data.form])):f.liveUpdateMode?(f.liveUpdateMode=!1,f.container.find('input[name="savewidget"]').show(),m=!0):(h.html(t.data.form),f.container.removeClass("widget-form-disabled"),e(document).trigger("widget-updated",[o])),g=!m&&!_(f.setting()).isEqual(t.data.instance),g?(f.isWidgetUpdating=!0,f.setting(t.data.instance),f.isWidgetUpdating=!1):f.container.removeClass("previewer-loading"),r&&r.call(f,null,{noChange:!g,ajaxFinished:!0})):(s=n.error,t.data&&t.data.message&&(s=t.data.message),r?r.call(f,s):h.prepend('<p class="widget-error"><strong>'+s+"</strong></p>")))}),m.fail(function(t,e){r&&r.call(f,e)}),m.always(function(){f.container.removeClass("widget-form-loading"),u.each(function(){e(this).removeData("state"+d)}),p(p()-1)})},expandControlSection:function(){a.Control.prototype.expand.call(this)},_toggleExpanded:a.Section.prototype._toggleExpanded,expand:a.Section.prototype.expand,expandForm:function(){this.expand()},collapse:a.Section.prototype.collapse,collapseForm:function(){this.collapse()},toggleForm:function(t){void 0===t&&(t=!this.expanded()),this.expanded(t)},onChangeExpanded:function(t,e){var i,s,r,n,o,h,d=this;if(d.embedWidgetControl(),t&&d.embedWidgetContent(),e.unchanged)return void(t&&a.Control.prototype.expand.call(d,{completeCallback:e.completeCallback}));i=this.container.find("div.widget:first"),s=i.find(".widget-inside:first"),h=this.container.find(".widget-top button.widget-action"),o=function(){a.control.each(function(t){d.params.type===t.params.type&&d!==t&&t.collapse()}),r=function(){d.container.removeClass("expanding"),d.container.addClass("expanded"),i.addClass("open"),h.attr("aria-expanded","true"),d.container.trigger("expanded")},e.completeCallback&&(n=r,r=function(){n(),e.completeCallback()}),d.params.is_wide?s.fadeIn(e.duration,r):s.slideDown(e.duration,r),d.container.trigger("expand"),d.container.addClass("expanding")},t?a.section.has(d.section())?a.section(d.section()).expand({completeCallback:o}):o():(r=function(){d.container.removeClass("collapsing"),d.container.removeClass("expanded"),i.removeClass("open"),h.attr("aria-expanded","false"),d.container.trigger("collapsed")},e.completeCallback&&(n=r,r=function(){n(),e.completeCallback()}),d.container.trigger("collapse"),d.container.addClass("collapsing"),d.params.is_wide?s.fadeOut(e.duration,r):s.slideUp(e.duration,function(){i.css({width:"",margin:""}),r()}))},getWidgetSidebarPosition:function(){var t,e;if(t=this.getSidebarWidgetsControl().setting(),-1!==(e=_.indexOf(t,this.params.widget_id)))return e},moveUp:function(){this._moveWidgetByOne(-1)},moveDown:function(){this._moveWidgetByOne(1)},_moveWidgetByOne:function(t){var e,i,s,r;e=this.getWidgetSidebarPosition(),i=this.getSidebarWidgetsControl().setting,s=Array.prototype.slice.call(i()),r=s[e+t],s[e+t]=this.params.widget_id,s[e]=r,i(s)},toggleWidgetMoveArea:function(t){var i,s=this;i=this.container.find(".move-widget-area"),void 0===t&&(t=!i.hasClass("active")),t&&(i.find(".selected").removeClass("selected"),i.find("li").filter(function(){return e(this).data("id")===s.params.sidebar_id}).addClass("selected"),this.container.find(".move-widget-btn").prop("disabled",!0)),i.toggleClass("active",t)},highlightSectionAndControl:function(){var t;t=this.container.is(":hidden")?this.container.closest(".control-section"):this.container,e(".highlighted").removeClass("highlighted"),t.addClass("highlighted"),setTimeout(function(){t.removeClass("highlighted")},500)}}),a.Widgets.WidgetsPanel=a.Panel.extend({ready:function(){var t=this;a.Panel.prototype.ready.call(t),t.deferred.embedded.done(function(){var i,s,r,o,h;i=t.container.find(".panel-meta"),s=e("<div></div>",{"class":"no-widget-areas-rendered-notice"}),i.append(s),o=function(){return _.filter(t.sections(),function(t){return"sidebar"===t.params.type&&t.active()}).length},h=function(){var t=o();return 0===t||t!==a.Widgets.data.registeredSidebars.length},r=function(){var t,i,r,h=o();s.empty(),r=a.Widgets.data.registeredSidebars.length,h!==r&&(0!==h?(i=r-h,t=n.someAreasShown[i]):t=n.noAreasShown,t&&s.append(e("<p></p>",{text:t})),s.append(e("<p></p>",{text:n.navigatePreview})))},r(),s.toggle(h()),a.previewer.deferred.active.done(function(){s.toggle(h())}),a.bind("pane-contents-reflowed",function(){var t="resolved"===a.previewer.deferred.active.state()?"fast":0;r(),h()?s.slideDown(t):s.slideUp(t)})})},isContextuallyActive:function(){return this.active()}}),a.Widgets.SidebarSection=a.Section.extend({ready:function(){var t,e=this;a.Section.prototype.ready.call(this),t=a.Widgets.registeredSidebars.get(e.params.sidebarId),e.active.bind(function(e){t.set("is_rendered",e)}),t.set("is_rendered",e.active())}}),a.Widgets.SidebarControl=a.Control.extend({ready:function(){this.$controlSection=this.container.closest(".control-section"),this.$sectionContent=this.container.closest(".accordion-section-content"),this._setupModel(),this._setupSortable(),this._setupAddition(),this._applyCardinalOrderClassNames()},_setupModel:function(){var t=this;this.setting.bind(function(i,r){var n,o,h;o=_(r).difference(i),i=_(i).filter(function(t){var e=s(t);return!!a.Widgets.availableWidgets.findWhere({id_base:e.id_base})}),n=_(i).map(function(e){var i=a.Widgets.getWidgetFormControlForWidget(e);return i||(i=t.addWidget(e)),i}),n.sort(function(t,e){return _.indexOf(i,t.params.widget_id)-_.indexOf(i,e.params.widget_id)}),h=0,_(n).each(function(e){e.priority(h),e.section(t.section()),h+=1}),t.priority(h),t._applyCardinalOrderClassNames(),_(n).each(function(e){e.params.sidebar_id=t.params.sidebar_id}),_(o).each(function(i){setTimeout(function(){var r,n,o,h,d,c=!1;a.each(function(e){if(e.id!==t.setting.id&&0===e.id.indexOf("sidebars_widgets[")&&"sidebars_widgets[wp_inactive_widgets]"!==e.id){var s,r=e();s=_.indexOf(r,i),-1!==s&&(c=!0)}}),c||(r=a.Widgets.getWidgetFormControlForWidget(i),n=r&&e.contains(document,r.container[0])&&!e.contains(t.$sectionContent[0],r.container[0]),r&&!n&&(a.control.remove(r.id),r.container.remove()),a.Widgets.savedWidgetIds[i]&&(o=a.value("sidebars_widgets[wp_inactive_widgets]")().slice(),o.push(i),a.value("sidebars_widgets[wp_inactive_widgets]")(_(o).unique())),h=s(i).id_base,(d=a.Widgets.availableWidgets.findWhere({id_base:h}))&&!d.get("is_multi")&&d.set("is_disabled",!1))})})})},_setupSortable:function(){var t=this;this.isReordering=!1,this.$sectionContent.sortable({items:"> .customize-control-widget_form",handle:".widget-top",axis:"y",tolerance:"pointer",connectWith:".accordion-section-content:has(.customize-control-sidebar_widgets)",update:function(){var i,s=t.$sectionContent.sortable("toArray");i=e.map(s,function(t){return e("#"+t).find(":input[name=widget-id]").val()}),t.setting(i)}}),this.$controlSection.find(".accordion-section-title").droppable({accept:".customize-control-widget_form",over:function(){a.section(t.section.get()).expand({allowMultiple:!0,completeCallback:function(){a.section.each(function(t){t.container.find(".customize-control-sidebar_widgets").length&&t.container.find(".accordion-section-content:first").sortable("refreshPositions")})}})}}),this.container.find(".reorder-toggle").on("click",function(){t.toggleReordering(!t.isReordering)})},_setupAddition:function(){var t=this;this.container.find(".add-new-widget").on("click",function(){var i=e(this);t.$sectionContent.hasClass("reordering")||(e("body").hasClass("adding-widget")?(i.attr("aria-expanded","false"),a.Widgets.availableWidgetsPanel.close()):(i.attr("aria-expanded","true"),a.Widgets.availableWidgetsPanel.open(t)))})},_applyCardinalOrderClassNames:function(){var t=[];if(_.each(this.setting(),function(e){var i=a.Widgets.getWidgetFormControlForWidget(e);i&&t.push(i)}),0===t.length||1===a.Widgets.registeredSidebars.length&&t.length<=1)return void this.container.find(".reorder-toggle").hide();this.container.find(".reorder-toggle").show(),e(t).each(function(){e(this.container).removeClass("first-widget").removeClass("last-widget").find(".move-widget-down, .move-widget-up").prop("tabIndex",0)}),_.first(t).container.addClass("first-widget").find(".move-widget-up").prop("tabIndex",-1),_.last(t).container.addClass("last-widget").find(".move-widget-down").prop("tabIndex",-1)},toggleReordering:function(e){var i=this.$sectionContent.find(".add-new-widget"),s=this.container.find(".reorder-toggle"),r=this.$sectionContent.find(".widget-title");(e=Boolean(e))!==this.$sectionContent.hasClass("reordering")&&(this.isReordering=e,this.$sectionContent.toggleClass("reordering",e),e?(_(this.getWidgetFormControls()).each(function(t){t.collapse()}),i.attr({tabindex:"-1","aria-hidden":"true"}),s.attr("aria-label",n.reorderLabelOff),t.a11y.speak(n.reorderModeOn),r.attr("aria-hidden","true")):(i.removeAttr("tabindex aria-hidden"),s.attr("aria-label",n.reorderLabelOn),t.a11y.speak(n.reorderModeOff),r.attr("aria-hidden","false")))},getWidgetFormControls:function(){var t=[];return _(this.setting()).each(function(e){var i=r(e),s=a.control(i);s&&t.push(s)}),t},addWidget:function(t){var i,r,n,o,h,d,c,l,u,p,m=this,g=s(t),f=g.number,v=g.id_base,y=a.Widgets.availableWidgets.findWhere({id_base:v});return!!y&&(!(f&&!y.get("is_multi"))&&(y.get("is_multi")&&!f&&(y.set("multi_number",y.get("multi_number")+1),f=y.get("multi_number")),i=e.trim(e("#widget-tpl-"+y.get("id")).html()),y.get("is_multi")?i=i.replace(/<[^<>]+>/g,function(t){return t.replace(/__i__|%i%/g,f)}):y.set("is_disabled",!0),r=e(i),n=e("<li/>").addClass("customize-control").addClass("customize-control-widget_form").append(r),n.find("> .widget-icon").remove(),y.get("is_multi")&&(n.find('input[name="widget_number"]').val(f),n.find('input[name="multi_number"]').val(f)),t=n.find('[name="widget-id"]').val(),n.hide(),h="widget_"+y.get("id_base"),y.get("is_multi")&&(h+="["+f+"]"),n.attr("id","customize-control-"+h.replace(/\]/g,"").replace(/\[/g,"-")),d=a.has(h),d||(u={transport:a.Widgets.data.selectiveRefreshableWidgets[y.get("id_base")]?"postMessage":"refresh",previewer:this.setting.previewer},p=a.create(h,h,"",u),p.set({})),o=a.controlConstructor.widget_form,c=new o(h,{settings:{"default":h},content:n,sidebar_id:m.params.sidebar_id,widget_id:t,widget_id_base:y.get("id_base"),type:"widget_form",is_new:!d,width:y.get("width"),height:y.get("height"),is_wide:y.get("is_wide")}),a.control.add(c),a.each(function(e){if(e.id!==m.setting.id&&0===e.id.indexOf("sidebars_widgets[")){var i=e().slice(),s=_.indexOf(i,t);-1!==s&&(i.splice(s),e(i))}}),l=this.setting().slice(),-1===_.indexOf(l,t)&&(l.push(t),this.setting(l)),n.slideDown(function(){d&&c.updateWidget({instance:c.setting()})}),c))}}),e.extend(a.panelConstructor,{widgets:a.Widgets.WidgetsPanel}),e.extend(a.sectionConstructor,{sidebar:a.Widgets.SidebarSection}),e.extend(a.controlConstructor,{widget_form:a.Widgets.WidgetControl,sidebar_widgets:a.Widgets.SidebarControl}),a.bind("ready",function(){a.Widgets.availableWidgetsPanel=new a.Widgets.AvailableWidgetsPanelView({collection:a.Widgets.availableWidgets}),a.previewer.bind("highlight-widget-control",a.Widgets.highlightWidgetFormControl),a.previewer.bind("focus-widget-control",a.Widgets.focusWidgetFormControl)}),a.Widgets.highlightWidgetFormControl=function(t){var e=a.Widgets.getWidgetFormControlForWidget(t);e&&e.highlightSectionAndControl()},a.Widgets.focusWidgetFormControl=function(t){var e=a.Widgets.getWidgetFormControlForWidget(t);e&&e.focus()},a.Widgets.getSidebarWidgetControlContainingWidget=function(t){var e=null;return a.control.each(function(i){"sidebar_widgets"===i.params.type&&-1!==_.indexOf(i.setting(),t)&&(e=i)}),e},a.Widgets.getWidgetFormControlForWidget=function(t){var e=null;return a.control.each(function(i){"widget_form"===i.params.type&&i.params.widget_id===t&&(e=i)}),e},e(document).on("widget-added",function(t,e){var r,n,o,h;r=s(e.find("> .widget-inside > .form > .widget-id").val()),"nav_menu"===r.id_base&&(n=a.control("widget_nav_menu["+String(r.number)+"]"))&&(o=e.find('select[name*="nav_menu"]'),h=e.find(".edit-selected-nav-menu > button"),0!==o.length&&0!==h.length&&(o.on("change",function(){a.section.has("nav_menu["+o.val()+"]")?h.parent().show():h.parent().hide()}),h.on("click",function(){var t=a.section("nav_menu["+o.val()+"]");t&&i(t,n)})))})}}(window.wp,jQuery);