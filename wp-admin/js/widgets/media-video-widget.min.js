!function(t){"use strict";var e,i,s;s=wp.media.view.MediaFrame.VideoDetails.extend({createStates:function(){this.states.add([new wp.media.controller.VideoDetails({media:this.media}),new wp.media.controller.MediaLibrary({type:"video",id:"add-video-source",title:wp.media.view.l10n.videoAddSourceTitle,toolbar:"add-video-source",media:this.media,menu:!1}),new wp.media.controller.MediaLibrary({type:"text",id:"add-track",title:wp.media.view.l10n.videoAddTrackTitle,toolbar:"add-track",media:this.media,menu:"video-details"})])}}),e=t.MediaWidgetModel.extend({}),i=t.MediaWidgetControl.extend({showDisplaySettings:!1,oembedResponses:{},mapModelToMediaFrameProps:function(e){var i,s=this;return i=t.MediaWidgetControl.prototype.mapModelToMediaFrameProps.call(s,e),i.link="embed",i},fetchEmbed:function(){var t,e=this;t=e.model.get("url"),e.oembedResponses[t]||(e.fetchEmbedDfd&&"pending"===e.fetchEmbedDfd.state()&&e.fetchEmbedDfd.abort(),e.fetchEmbedDfd=wp.apiRequest({url:wp.media.view.settings.oEmbedProxyUrl,data:{url:e.model.get("url"),maxwidth:e.model.get("width"),maxheight:e.model.get("height"),discover:!1},type:"GET",dataType:"json",context:e}),e.fetchEmbedDfd.done(function(i){e.oembedResponses[t]=i,e.renderPreview()}),e.fetchEmbedDfd.fail(function(){e.oembedResponses[t]=null}))},isHostedVideo:function(){return!0},renderPreview:function(){var t,e,i,s,r,n,a,o,h,d=this,c="",l=!1;i=d.model.get("attachment_id"),s=d.model.get("url"),a=d.model.get("error"),(i||s)&&(n=d.selectedAttachment.get("mime"),n&&i?_.contains(_.values(wp.media.view.settings.embedMimes),n)||(a="unsupported_file_type"):i||(o=document.createElement("a"),o.href=s,h=o.pathname.toLowerCase().match(/\.(\w+)$/),h?_.contains(_.keys(wp.media.view.settings.embedMimes),h[1])||(a="unsupported_file_type"):l=!0),l&&(d.fetchEmbed(),d.oembedResponses[s]&&(r=d.oembedResponses[s].thumbnail_url,c=d.oembedResponses[s].html.replace(/\swidth="\d+"/,' width="100%"').replace(/\sheight="\d+"/,""))),t=d.$el.find(".media-widget-preview"),e=wp.template("wp-media-widget-video-preview"),t.html(e({model:{attachment_id:i,html:c,src:s,poster:r},is_oembed:l,error:a})),wp.mediaelement.initialize())},editMedia:function(){var t,e,i,r=this;e=r.mapModelToMediaFrameProps(r.model.toJSON()),t=new s({frame:"video",state:"video-details",metadata:e}),wp.media.frame=t,t.$el.addClass("media-widget"),i=function(t){r.selectedAttachment.set(t),r.model.set(_.extend(_.omit(r.model.defaults(),"title"),r.mapMediaToModelProps(t),{error:!1}))},t.state("video-details").on("update",i),t.state("replace-video").on("replace",i),t.on("close",function(){t.detach()}),t.open()}}),t.controlConstructors.media_video=i,t.modelConstructors.media_video=e}(wp.mediaWidgets);