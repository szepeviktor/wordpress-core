!function(t,e){"use strict";var i,s;i=t.MediaWidgetModel.extend({}),s=t.MediaWidgetControl.extend({events:_.extend({},t.MediaWidgetControl.prototype.events,{"click .media-widget-preview.populated":"editMedia"}),renderPreview:function(){var t,e,i,s,r,n=this;(n.model.get("attachment_id")||n.model.get("url"))&&(t=n.$el.find(".media-widget-preview"),e=wp.template("wp-media-widget-image-preview"),t.html(e(n.previewTemplateProps.toJSON())),t.addClass("populated"),r=n.$el.find(".link"),r.is(document.activeElement)||(i=n.$el.find(".media-widget-fields"),s=wp.template("wp-media-widget-image-fields"),i.html(s(n.previewTemplateProps.toJSON()))))},editMedia:function(){var t,i,s,r,n=this;r=n.mapModelToMediaFrameProps(n.model.toJSON()),"none"===r.link&&(r.linkUrl=""),t=wp.media({frame:"image",state:"image-details",metadata:r}),t.$el.addClass("media-widget"),i=function(){var e,i;e=t.state().attributes.image.toJSON(),i=e.link,e.link=e.linkUrl,n.selectedAttachment.set(e),n.displaySettings.set("link",i),n.model.set(_.extend(n.mapMediaToModelProps(e),{error:!1}))},t.state("image-details").on("update",i),t.state("replace-image").on("replace",i),s=wp.media.model.Attachment.prototype.sync,wp.media.model.Attachment.prototype.sync=function(){return e.Deferred().rejectWith(this).promise()},t.on("close",function(){t.detach(),wp.media.model.Attachment.prototype.sync=s}),t.open()},getEmbedResetProps:function(){return _.extend(t.MediaWidgetControl.prototype.getEmbedResetProps.call(this),{size:"full",width:0,height:0})},getModelPropsFromMediaFrame:function(e){var i=this;return _.omit(t.MediaWidgetControl.prototype.getModelPropsFromMediaFrame.call(i,e),"image_title")},mapModelToPreviewTemplateProps:function(){var e,i,s=this;return i=s.model.get("url"),e=t.MediaWidgetControl.prototype.mapModelToPreviewTemplateProps.call(s),e.currentFilename=i?i.replace(/\?.*$/,"").replace(/^.+\//,""):"",e.link_url=s.model.get("link_url"),e}}),t.controlConstructors.media_image=s,t.modelConstructors.media_image=i}(wp.mediaWidgets,jQuery);