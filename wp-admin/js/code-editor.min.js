"undefined"==typeof window.wp&&(window.wp={}),"undefined"==typeof window.wp.codeEditor&&(window.wp.codeEditor={}),function(t,e){"use strict";function i(e,i){function s(){i.onUpdateErrorNotice&&!_.isEqual(n,a)&&(i.onUpdateErrorNotice(n,e),a=n)}function r(){var r=e.getOption("lint");return!!r&&(!0===r?r={}:_.isObject(r)&&(r=t.extend({},r)),r.options||(r.options={}),"javascript"===i.codemirror.mode&&i.jshint&&t.extend(r.options,i.jshint),"css"===i.codemirror.mode&&i.csslint&&t.extend(r.options,i.csslint),"htmlmixed"===i.codemirror.mode&&i.htmlhint&&(r.options.rules=t.extend({},i.htmlhint),i.jshint&&(r.options.rules.jshint=i.jshint),i.csslint&&(r.options.rules.csslint=i.csslint)),r.onUpdateLinting=function(t){return function(r,o,h){var d=_.filter(r,function(t){return"error"===t.severity});t&&t.apply(r,o,h),_.isEqual(d,n)||(n=d,i.onChangeLintingErrors&&i.onChangeLintingErrors(d,r,o,h),(!e.state.focused||0===n.length||a.length>0)&&s())}}(r.onUpdateLinting),r)}var n=[],a=[];e.setOption("lint",r()),e.on("optionChange",function(t,i){var a,o,h="CodeMirror-lint-markers";"lint"===i&&(o=e.getOption("gutters")||[],a=e.getOption("lint"),!0===a?(_.contains(o,h)||e.setOption("gutters",[h].concat(o)),e.setOption("lint",r())):a||e.setOption("gutters",_.without(o,h)),e.getOption("lint")?e.performLint():(n=[],s()))}),e.on("blur",s),e.on("startCompletion",function(){e.off("blur",s)}),e.on("endCompletion",function(){e.on("blur",s),_.delay(function(){e.state.focused||s()},500)}),t(document.body).on("mousedown",function(i){!e.state.focused||t.contains(e.display.wrapper,i.target)||t(i.target).hasClass("CodeMirror-hint")||s()})}function s(e,i){var s=t(e.getTextArea());e.on("blur",function(){s.data("next-tab-blurs",!1)}),e.on("keydown",function(t,r){if(27===r.keyCode)return void s.data("next-tab-blurs",!0);9===r.keyCode&&s.data("next-tab-blurs")&&(r.shiftKey?i.onTabPrevious(e,r):i.onTabNext(e,r),s.data("next-tab-blurs",!1),r.preventDefault())})}e.codeEditor.defaultSettings={codemirror:{},csslint:{},htmlhint:{},jshint:{},onTabNext:function(){},onTabPrevious:function(){},onChangeLintingErrors:function(){},onUpdateErrorNotice:function(){}},e.codeEditor.initialize=function(r,n){var a,o,h,d;return a=t("string"==typeof r?"#"+r:r),h=t.extend({},e.codeEditor.defaultSettings,n),h.codemirror=t.extend({},h.codemirror),o=e.CodeMirror.fromTextArea(a[0],h.codemirror),i(o,h),d={settings:h,codemirror:o},o.showHint&&o.on("keyup",function(t,i){var s,r,n,a,h=/^[a-zA-Z]$/.test(i.key);o.state.completionActive&&h||(a=o.getTokenAt(o.getCursor()),"string"!==a.type&&"comment"!==a.type&&(n=e.CodeMirror.innerMode(o.getMode(),a.state).mode.name,r=o.doc.getLine(o.doc.getCursor().line).substr(0,o.doc.getCursor().ch),"html"===n||"xml"===n?s="<"===i.key||"/"===i.key&&"tag"===a.type||h&&"tag"===a.type||h&&"attribute"===a.type||"="===a.string&&a.state.htmlState&&a.state.htmlState.tagName:"css"===n?s=h||":"===i.key||" "===i.key&&/:\s+$/.test(r):"javascript"===n?s=h||"."===i.key:"clike"===n&&"application/x-httpd-php"===o.options.mode&&(s="keyword"===a.type||"variable"===a.type),s&&o.showHint({completeSingle:!1})))}),s(o,n),d}}(window.jQuery,window.wp);