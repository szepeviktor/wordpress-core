!function(t,e){var i,s=wp.customize,r={};!function(t){var i;t.replaceState&&(i=function(t){var i,r,n;return i=document.createElement("a"),i.href=t,r=s.utils.parseQueryString(location.search.substr(1)),n=s.utils.parseQueryString(i.search.substr(1)),n.customize_changeset_uuid=r.customize_changeset_uuid,r.customize_autosaved&&(n.customize_autosaved="on"),r.customize_theme&&(n.customize_theme=r.customize_theme),r.customize_messenger_channel&&(n.customize_messenger_channel=r.customize_messenger_channel),i.search=e.param(n),i.href},t.replaceState=function(e){return function(s,n,a){return r=s,e.call(t,s,n,"string"==typeof a&&a.length>0?i(a):a)}}(t.replaceState),t.pushState=function(e){return function(s,n,a){return r=s,e.call(t,s,n,"string"==typeof a&&a.length>0?i(a):a)}}(t.pushState),window.addEventListener("popstate",function(t){r=t.state}))}(history),i=function(t,e,i){var s;return function(){var r=arguments;i=i||this,clearTimeout(s),s=setTimeout(function(){s=null,t.apply(i,r)},e)}},s.Preview=s.Messenger.extend({initialize:function(t,r){var n=this,a=document.createElement("a");s.Messenger.prototype.initialize.call(n,t,r),a.href=n.origin(),n.add("scheme",a.protocol.replace(/:$/,"")),n.body=e(document.body),n.window=e(window),s.settings.channel&&(n.body.on("click.preview","a",function(t){n.handleLinkClick(t)}),n.body.on("submit.preview","form",function(t){n.handleFormSubmit(t)}),n.window.on("scroll.preview",i(function(){n.send("scroll",n.window.scrollTop())},200)),n.bind("scroll",function(t){n.window.scrollTop(t)}))},handleLinkClick:function(t){var i,r=this;if(i=e(t.target).closest("a"),!_.isUndefined(i.attr("href"))&&!("#"===i.attr("href").substr(0,1))&&/^https?:$/.test(i.prop("protocol"))){if(!s.isLinkPreviewable(i[0]))return wp.a11y.speak(s.settings.l10n.linkUnpreviewable),void t.preventDefault();t.preventDefault(),t.shiftKey||r.send("url",i.prop("href"))}},handleFormSubmit:function(t){var i,r,n=this;if(i=document.createElement("a"),r=e(t.target),i.href=r.prop("action"),"GET"!==r.prop("method").toUpperCase()||!s.isLinkPreviewable(i))return wp.a11y.speak(s.settings.l10n.formUnpreviewable),void t.preventDefault();t.isDefaultPrevented()||(i.search.length>1&&(i.search+="&"),i.search+=r.serialize(),n.send("url",i.href)),t.preventDefault()}}),s.addLinkPreviewing=function(){e(document.body).find("a[href], area").each(function(){s.prepareLinkPreview(this)}),"undefined"!=typeof MutationObserver?(s.mutationObserver=new MutationObserver(function(t){_.each(t,function(t){e(t.target).find("a[href], area").each(function(){s.prepareLinkPreview(this)})})}),s.mutationObserver.observe(document.documentElement,{childList:!0,subtree:!0})):e(document.documentElement).on("click focus mouseover","a[href], area",function(){s.prepareLinkPreview(this)})},s.isLinkPreviewable=function(t,e){var i,r,n;return r=_.extend({},{allowAdminAjax:!1},e||{}),"javascript:"===t.protocol||("https:"===t.protocol||"http:"===t.protocol)&&(n=t.host.replace(/:(80|443)$/,""),i=document.createElement("a"),!!!_.isUndefined(_.find(s.settings.url.allowed,function(e){return i.href=e,i.protocol===t.protocol&&i.host.replace(/:(80|443)$/,"")===n&&0===t.pathname.indexOf(i.pathname.replace(/\/$/,""))}))&&(!/\/wp-(login|signup)\.php$/.test(t.pathname)&&(/\/wp-admin\/admin-ajax\.php$/.test(t.pathname)?r.allowAdminAjax:!/\/wp-(admin|includes|content)(\/|$)/.test(t.pathname))))},s.prepareLinkPreview=function(t){var i,r=e(t);if(!r.closest("#wpadminbar").length&&"#"!==r.attr("href").substr(0,1)&&/^https?:$/.test(t.protocol)&&(s.settings.channel&&"https"===s.preview.scheme.get()&&"http:"===t.protocol&&-1!==s.settings.url.allowedHosts.indexOf(t.host)&&(t.protocol="https:"),!r.hasClass("wp-playlist-caption"))){if(!s.isLinkPreviewable(t))return void(s.settings.channel&&r.addClass("customize-unpreviewable"));r.removeClass("customize-unpreviewable"),i=s.utils.parseQueryString(t.search.substring(1)),i.customize_changeset_uuid=s.settings.changeset.uuid,s.settings.changeset.autosaved&&(i.customize_autosaved="on"),s.settings.theme.active||(i.customize_theme=s.settings.theme.stylesheet),s.settings.channel&&(i.customize_messenger_channel=s.settings.channel),t.search=e.param(i),s.settings.channel&&(t.target="_self")}},s.addRequestPreviewing=function(){var t=function(t,i,r){var n,a,o,h={};n=document.createElement("a"),n.href=t.url,s.isLinkPreviewable(n,{allowAdminAjax:!0})&&(a=s.utils.parseQueryString(n.search.substring(1)),s.each(function(t){t._dirty&&(h[t.id]=t.get())}),_.isEmpty(h)||(o=t.type.toUpperCase(),"POST"!==o&&(r.setRequestHeader("X-HTTP-Method-Override",o),a._method=o,t.type="POST"),t.data?t.data+="&":t.data="",t.data+=e.param({customized:JSON.stringify(h)})),a.customize_changeset_uuid=s.settings.changeset.uuid,s.settings.changeset.autosaved&&(a.customize_autosaved="on"),s.settings.theme.active||(a.customize_theme=s.settings.theme.stylesheet),a.customize_preview_nonce=s.settings.nonce.preview,n.search=e.param(a),t.url=n.href)};e.ajaxPrefilter(t)},s.addFormPreviewing=function(){e(document.body).find("form").each(function(){s.prepareFormPreview(this)}),"undefined"!=typeof MutationObserver&&(s.mutationObserver=new MutationObserver(function(t){_.each(t,function(t){e(t.target).find("form").each(function(){s.prepareFormPreview(this)})})}),s.mutationObserver.observe(document.documentElement,{childList:!0,subtree:!0}))},s.prepareFormPreview=function(t){var i,r={};if(t.action||(t.action=location.href),i=document.createElement("a"),i.href=t.action,s.settings.channel&&"https"===s.preview.scheme.get()&&"http:"===i.protocol&&-1!==s.settings.url.allowedHosts.indexOf(i.host)&&(i.protocol="https:",t.action=i.href),"GET"!==t.method.toUpperCase()||!s.isLinkPreviewable(i))return void(s.settings.channel&&e(t).addClass("customize-unpreviewable"));e(t).removeClass("customize-unpreviewable"),r.customize_changeset_uuid=s.settings.changeset.uuid,s.settings.changeset.autosaved&&(r.customize_autosaved="on"),s.settings.theme.active||(r.customize_theme=s.settings.theme.stylesheet),s.settings.channel&&(r.customize_messenger_channel=s.settings.channel),_.each(r,function(i,s){var r=e(t).find('input[name="'+s+'"]');r.length?r.val(i):e(t).prepend(e("<input>",{type:"hidden",name:s,value:i}))}),s.settings.channel&&(t.target="_self")},s.keepAliveCurrentUrl=function(){var t=location.pathname,i=location.search.substr(1),r=null,n=["customize_theme","customize_changeset_uuid","customize_messenger_channel","customize_autosaved"];return function(){var a,o;if(i===location.search.substr(1)&&t===location.pathname)return void s.preview.send("keep-alive");a=document.createElement("a"),null===r&&(a.search=i,r=s.utils.parseQueryString(i),_.each(n,function(t){delete r[t]})),a.href=location.href,o=s.utils.parseQueryString(a.search.substr(1)),_.each(n,function(t){delete o[t]}),t===location.pathname&&_.isEqual(r,o)?s.preview.send("keep-alive"):(a.search=e.param(o),a.hash="",s.settings.url.self=a.href,s.preview.send("ready",{currentUrl:s.settings.url.self,activePanels:s.settings.activePanels,activeSections:s.settings.activeSections,activeControls:s.settings.activeControls,settingValidities:s.settings.settingValidities})),r=o,i=location.search.substr(1),t=location.pathname}}(),s.settingPreviewHandlers={custom_logo:function(t){e("body").toggleClass("wp-custom-logo",!!t)},custom_css:function(t){e("#wp-custom-css").text(t)},background:function(){var t="",i={};_.each(["color","image","preset","position_x","position_y","size","repeat","attachment"],function(t){i[t]=s("background_"+t)}),e(document.body).toggleClass("custom-background",!(!i.color()&&!i.image())),i.color()&&(t+="background-color: "+i.color()+";"),i.image()&&(t+='background-image: url("'+i.image()+'");',t+="background-size: "+i.size()+";",t+="background-position: "+i.position_x()+" "+i.position_y()+";",t+="background-repeat: "+i.repeat()+";",t+="background-attachment: "+i.attachment()+";"),e("#custom-background-css").text("body.custom-background { "+t+" }")}},e(function(){var t,i,n;s.settings=window._wpCustomizeSettings,s.settings&&(s.preview=new s.Preview({url:window.location.href,channel:s.settings.channel}),s.addLinkPreviewing(),s.addRequestPreviewing(),s.addFormPreviewing(),i=function(t,e,i){var r=s(t);r?r.set(e):(i=i||!1,r=s.create(t,e,{id:t}),i&&(r._dirty=!0))},s.preview.bind("settings",function(t){e.each(t,i)}),s.preview.trigger("settings",s.settings.values),e.each(s.settings._dirty,function(t,e){var i=s(e);i&&(i._dirty=!0)}),s.preview.bind("setting",function(t){i.apply(null,t.concat(!0))}),s.preview.bind("sync",function(t){t.settings&&t["settings-modified-while-loading"]&&_.each(_.keys(t.settings),function(e){s.has(e)&&!t["settings-modified-while-loading"][e]&&delete t.settings[e]}),e.each(t,function(t,e){s.preview.trigger(t,e)}),s.preview.send("synced")}),s.preview.bind("active",function(){s.preview.send("nonce",s.settings.nonce),s.preview.send("documentTitle",document.title),s.preview.send("scroll",e(window).scrollTop())}),n=function(t){s.settings.changeset.uuid=t,e(document.body).find("a[href], area").each(function(){s.prepareLinkPreview(this)}),e(document.body).find("form").each(function(){s.prepareFormPreview(this)}),history.replaceState&&history.replaceState(r,"",location.href)},s.preview.bind("changeset-uuid",n),s.preview.bind("saved",function(t){t.next_changeset_uuid&&n(t.next_changeset_uuid),s.trigger("saved",t)}),s.preview.bind("autosaving",function(){s.settings.changeset.autosaved||(s.settings.changeset.autosaved=!0,e(document.body).find("a[href], area").each(function(){s.prepareLinkPreview(this)}),e(document.body).find("form").each(function(){s.prepareFormPreview(this)}),history.replaceState&&history.replaceState(r,"",location.href))}),s.preview.bind("changeset-saved",function(t){_.each(t.saved_changeset_values,function(t,e){var i=s(e);i&&_.isEqual(i.get(),t)&&(i._dirty=!1)})}),s.preview.bind("nonce-refresh",function(t){e.extend(s.settings.nonce,t)}),s.preview.send("ready",{currentUrl:s.settings.url.self,activePanels:s.settings.activePanels,activeSections:s.settings.activeSections,activeControls:s.settings.activeControls,settingValidities:s.settings.settingValidities}),setInterval(s.keepAliveCurrentUrl,s.settings.timeouts.keepAliveSend),s.preview.bind("loading-initiated",function(){e("body").addClass("wp-customizer-unloading")}),s.preview.bind("loading-failed",function(){e("body").removeClass("wp-customizer-unloading")}),t=e.map(["color","image","preset","position_x","position_y","size","repeat","attachment"],function(t){return"background_"+t}),s.when.apply(s,t).done(function(){e.each(arguments,function(){this.bind(s.settingPreviewHandlers.background)})}),s("custom_logo",function(t){s.settingPreviewHandlers.custom_logo.call(t,t.get()),t.bind(s.settingPreviewHandlers.custom_logo)}),s("custom_css["+s.settings.theme.stylesheet+"]",function(t){t.bind(s.settingPreviewHandlers.custom_css)}),s.trigger("preview-ready"))})}(wp,jQuery);