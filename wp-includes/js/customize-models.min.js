!function(t,e){var i=e.customize;i.HeaderTool={},i.HeaderTool.ImageModel=Backbone.Model.extend({defaults:function(){return{header:{attachment_id:0,url:"",timestamp:_.now(),thumbnail_url:""},choice:"",selected:!1,random:!1}},initialize:function(){this.on("hide",this.hide,this)},hide:function(){this.set("choice",""),i("header_image").set("remove-header"),i("header_image_data").set("remove-header")},destroy:function(){var t=this.get("header"),s=i.HeaderTool.currentHeader.get("header").attachment_id;s&&t.attachment_id===s&&i.HeaderTool.currentHeader.trigger("hide"),e.ajax.post("custom-header-remove",{nonce:_wpCustomizeHeader.nonces.remove,wp_customize:"on",theme:i.settings.theme.stylesheet,attachment_id:t.attachment_id}),this.trigger("destroy",this,this.collection)},save:function(){this.get("random")?(i("header_image").set(this.get("header").random),i("header_image_data").set(this.get("header").random)):this.get("header").defaultName?(i("header_image").set(this.get("header").url),i("header_image_data").set(this.get("header").defaultName)):(i("header_image").set(this.get("header").url),i("header_image_data").set(this.get("header"))),i.HeaderTool.combinedList.trigger("control:setImage",this)},importImage:function(){var t=this.get("header");t.attachment_id!==undefined&&e.ajax.post("custom-header-add",{nonce:_wpCustomizeHeader.nonces.add,wp_customize:"on",theme:i.settings.theme.stylesheet,attachment_id:t.attachment_id})},shouldBeCropped:function(){return(!0!==this.get("themeFlexWidth")||!0!==this.get("themeFlexHeight"))&&((!0!==this.get("themeFlexWidth")||this.get("themeHeight")!==this.get("imageHeight"))&&((!0!==this.get("themeFlexHeight")||this.get("themeWidth")!==this.get("imageWidth"))&&((this.get("themeWidth")!==this.get("imageWidth")||this.get("themeHeight")!==this.get("imageHeight"))&&!(this.get("imageWidth")<=this.get("themeWidth")))))}}),i.HeaderTool.ChoiceList=Backbone.Collection.extend({model:i.HeaderTool.ImageModel,comparator:function(t){return-t.get("header").timestamp},initialize:function(){var t=i.HeaderTool.currentHeader.get("choice").replace(/^https?:\/\//,""),e=this.isRandomChoice(i.get().header_image);this.type||(this.type="uploaded"),"undefined"==typeof this.data&&(this.data=_wpCustomizeHeader.uploads),e&&(t=i.get().header_image),this.on("control:setImage",this.setImage,this),this.on("control:removeImage",this.removeImage,this),this.on("add",this.maybeRemoveOldCrop,this),this.on("add",this.maybeAddRandomChoice,this),_.each(this.data,function(e,i){e.attachment_id||(e.defaultName=i),"undefined"==typeof e.timestamp&&(e.timestamp=0),this.add({header:e,choice:e.url.split("/").pop(),selected:t===e.url.replace(/^https?:\/\//,"")},{silent:!0})},this),this.size()>0&&this.addRandomChoice(t)},maybeRemoveOldCrop:function(t){var e,i=t.get("header").attachment_id||!1;i&&(e=this.find(function(e){return e.cid!==t.cid&&e.get("header").attachment_id===i}))&&this.remove(e)},maybeAddRandomChoice:function(){1===this.size()&&this.addRandomChoice()},addRandomChoice:function(t){var e=RegExp(this.type).test(t),i="random-"+this.type+"-image";this.add({header:{timestamp:0,random:i,width:245,height:41},choice:i,random:!0,selected:e})},isRandomChoice:function(t){return/^random-(uploaded|default)-image$/.test(t)},shouldHideTitle:function(){return this.size()<2},setImage:function(t){this.each(function(t){t.set("selected",!1)}),t&&t.set("selected",!0)},removeImage:function(){this.each(function(t){t.set("selected",!1)})}}),i.HeaderTool.DefaultsList=i.HeaderTool.ChoiceList.extend({initialize:function(){this.type="default",this.data=_wpCustomizeHeader.defaults,i.HeaderTool.ChoiceList.prototype.initialize.apply(this)}})}(jQuery,window.wp);