!function(t,e){function i(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}t.Env.ie&&t.Env.ie<9||t.PluginManager.add("wptextpattern",function(s){function r(){var r,n,a,o,h,c=s.selection.getRng(),l=c.startContainer,u=c.startOffset;if(l&&3===l.nodeType&&l.data.length&&u){var p=l.data.slice(0,u),g=l.data.charAt(u-1);t.each(m,function(t){if(g===t.delimiter.slice(-1)){var e=i(t.delimiter),s=t.delimiter.charAt(0),o=new RegExp("(.*)"+e+".+"+e+"$"),h=p.match(o);if(h){r=h[1].length,n=u-t.delimiter.length;var d=p.charAt(r-1),c=p.charAt(r+t.delimiter.length);if(!(r&&/\S/.test(d)&&(/\s/.test(c)||d===s)||new RegExp("^[\\s"+i(s)+"]+$").test(p.slice(r,n))))return a=t,!1}}}),a&&(o=s.formatter.get(a.format))&&o[0].inline&&(s.undoManager.add(),s.undoManager.transact(function(){l.insertData(u,"\ufeff"),l=l.splitText(r),h=l.splitText(u-r),l.deleteData(0,a.delimiter.length),l.deleteData(l.data.length-a.delimiter.length,a.delimiter.length),s.formatter.apply(a.format,{},l),s.selection.setCursorLocation(h,1)}),e(function(){d="space",s.once("selectionchange",function(){var t;h&&-1!==(t=h.data.indexOf("\ufeff"))&&h.deleteData(t,t+1)})}))}}function n(t){var e,i=s.dom.getParent(t,"p");if(i){for(;(e=i.firstChild)&&3!==e.nodeType;)i=e;if(e)return e.data||(e=e.nextSibling&&3===e.nextSibling.nodeType?e.nextSibling:null),e}}function a(){var i,r,a=s.selection.getRng(),o=a.startContainer;o&&n(o)===o&&(i=o.parentNode,r=o.data,t.each(u,function(t){var n=r.match(t.regExp);if(n&&a.startOffset===n[0].length)return s.undoManager.add(),s.undoManager.transact(function(){o.deleteData(0,n[0].length),i.innerHTML||i.appendChild(document.createElement("br")),s.selection.setCursorLocation(i),s.execCommand(t.cmd)}),e(function(){d="space"}),!1}))}function o(){var i,r,a,o=s.selection.getRng(),c=o.startContainer,l=n(c),u=p.length;if(l){for(i=l.data;u--;)if(p[u].start){if(0===i.indexOf(p[u].start)){r=p[u];break}}else if(p[u].regExp&&p[u].regExp.test(i)){r=p[u];break}r&&(l===c&&t.trim(i)===r.start||s.once("keyup",function(){s.undoManager.add(),s.undoManager.transact(function(){r.format?(s.formatter.apply(r.format,{},l),l.replaceData(0,l.data.length,h(l.data.slice(r.start.length)))):r.element&&(a=l.parentNode&&l.parentNode.parentNode)&&a.replaceChild(document.createElement(r.element),l.parentNode)}),e(function(){d="enter"})}))}}function h(t){return t?t.replace(/^\s+/,""):""}var d,c=t.util.VK,l=s.settings.wptextpattern||{},u=l.space||[{regExp:/^[*-]\s/,cmd:"InsertUnorderedList"},{regExp:/^1[.)]\s/,cmd:"InsertOrderedList"}],p=l.enter||[{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:">",format:"blockquote"},{regExp:/^(-){3,}$/,element:"hr"}],m=l.inline||[{delimiter:"`",format:"code"}];s.on("selectionchange",function(){d=null}),s.on("keydown",function(t){(d&&27===t.keyCode||"space"===d&&t.keyCode===c.BACKSPACE)&&(s.undoManager.undo(),t.preventDefault(),t.stopImmediatePropagation()),c.metaKeyPressed(t)||(t.keyCode===c.ENTER?o():t.keyCode===c.SPACEBAR?e(a):t.keyCode>47&&!(t.keyCode>=91&&t.keyCode<=93)&&e(r))},!0)})}(window.tinymce,window.setTimeout);