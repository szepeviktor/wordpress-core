!function(t,e){t.PluginManager.add("wpview",function(i){function s(){}function r(t){return i.dom.hasClass(t,"wpview")}function n(t){function e(t,e){return"<p>"+window.decodeURIComponent(e)+"</p>"}return t?t.replace(/<div[^>]+data-wpview-text="([^"]+)"[^>]*>(?:\.|[\s\S]+?wpview-end[^>]+>\s*<\/span>\s*)?<\/div>/g,e).replace(/<p[^>]+data-wpview-marker="([^"]+)"[^>]*>[\s\S]*?<\/p>/g,e):t}return e&&e.mce&&e.mce.views?(i.on("init",function(){var t=window.MutationObserver||window.WebKitMutationObserver;t&&new t(function(){i.fire("wp-body-class-change")}).observe(i.getBody(),{attributes:!0,attributeFilter:["class"]}),i.on("wp-body-class-change",function(){var t=i.getBody().className;i.$('iframe[class="wpview-sandbox"]').each(function(e,i){if(!i.src||'javascript:""'===i.src)try{i.contentWindow.document.body.className=t}catch(s){}})})}),i.on("beforesetcontent",function(t){var s;if(t.selection||e.mce.views.unbind(),t.content){if(!t.load&&(s=i.selection.getNode())&&s!==i.getBody()&&/^\s*https?:\/\/\S+\s*$/i.test(t.content)){if(!(s=i.dom.getParent(s,"p"))||!/^[\s\uFEFF\u00A0]*$/.test(i.$(s).text()||""))return;s.innerHTML=""}t.content=e.mce.views.setMarkers(t.content,i)}}),i.on("setcontent",function(){e.mce.views.render()}),i.on("preprocess hide",function(t){i.$("div[data-wpview-text], p[data-wpview-marker]",t.node).each(function(t,e){e.innerHTML="."})},!0),i.on("postprocess",function(t){t.content=n(t.content)}),i.on("beforeaddundo",function(t){t.level.content=n(t.level.content)}),i.on("drop objectselected",function(t){r(t.targetClone)&&(t.targetClone=i.getDoc().createTextNode(window.decodeURIComponent(i.dom.getAttrib(t.targetClone,"data-wpview-text"))))}),i.on("pastepreprocess",function(e){var i=e.content;i&&(i=t.trim(i.replace(/<[^>]+>/g,"")),/^https?:\/\/\S+$/i.test(i)&&(e.content=i))}),i.on("resolvename",function(t){r(t.target)&&(t.name=i.dom.getAttrib(t.target,"data-wpview-type")||"object")}),i.on("click keyup",function(){var t=i.selection.getNode();r(t)&&i.dom.getAttrib(t,"data-mce-selected")&&t.setAttribute("data-mce-selected","2")}),i.addButton("wp_view_edit",{tooltip:"Edit|button",icon:"dashicon dashicons-edit",onclick:function(){var t=i.selection.getNode();r(t)&&e.mce.views.edit(i,t)}}),i.addButton("wp_view_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",onclick:function(){i.fire("cut")}}),i.once("preinit",function(){var t;i.wp&&i.wp._createToolbar&&(t=i.wp._createToolbar(["wp_view_edit","wp_view_remove"]),i.on("wptoolbar",function(e){!e.collapsed&&r(e.element)&&(e.toolbar=t)}))}),i.wp=i.wp||{},i.wp.getView=s,i.wp.setViewCursor=s,{getView:s}):{getView:s}})}(window.tinymce,window.wp);