wp.customize.navMenusPreview=wp.customize.MenusCustomizerPreview=function(t,e,i,s){"use strict";var r={data:{navMenuInstanceArgs:{}}};return"undefined"!=typeof _wpCustomizePreviewNavMenusExports&&e.extend(r.data,_wpCustomizePreviewNavMenusExports),r.init=function(){var t=this,i=!1;s.preview.bind("sync",function(){i=!0}),s.selectiveRefresh&&(s.each(function(e){t.bindSettingListener(e)}),s.bind("add",function(e){e.get()&&!e.get()._invalid&&t.bindSettingListener(e,{fire:i})}),s.bind("remove",function(e){t.unbindSettingListener(e)}),s.selectiveRefresh.bind("render-partials-response",function(i){i.nav_menu_instance_args&&e.extend(t.data.navMenuInstanceArgs,i.nav_menu_instance_args)})),s.preview.bind("active",function(){t.highlightControls()})},s.selectiveRefresh&&(r.NavMenuInstancePartial=s.selectiveRefresh.Partial.extend({initialize:function(t,i){var r,n,a=this;if(!(r=t.match(/^nav_menu_instance\[([0-9a-f]{32})]$/)))throw new Error("Illegal id for nav_menu_instance partial. The key corresponds with the args HMAC.");if(n=r[1],i=i||{},i.params=e.extend({selector:'[data-customize-partial-id="'+t+'"]',navMenuArgs:i.constructingContainerContext||{},containerInclusive:!0},i.params||{}),s.selectiveRefresh.Partial.prototype.initialize.call(a,t,i),!e.isObject(a.params.navMenuArgs))throw new Error("Missing navMenuArgs");if(a.params.navMenuArgs.args_hmac!==n)throw new Error("args_hmac mismatch with id")},isRelatedSetting:function(t,i,r){var n,a,o,h,d,c,l=this;if(e.isString(t)&&(t=s(t)),(o=/^nav_menu_item\[/.test(t.id))&&e.isObject(i)&&e.isObject(r)&&(h=e.clone(i),d=e.clone(r),delete h.type_label,delete d.type_label,"https"===s.preview.scheme.get()&&(c=document.createElement("a"),c.href=h.url,c.protocol="https:",h.url=c.href,c.href=d.url,c.protocol="https:",d.url=c.href),i.title&&(delete d.original_title,delete h.original_title),e.isEqual(d,h)))return!1;if(l.params.navMenuArgs.theme_location){if("nav_menu_locations["+l.params.navMenuArgs.theme_location+"]"===t.id)return!0;n=s("nav_menu_locations["+l.params.navMenuArgs.theme_location+"]")}return a=l.params.navMenuArgs.menu,!a&&n&&(a=n()),!!a&&("nav_menu["+a+"]"===t.id||o&&(i&&i.nav_menu_term_id===a||r&&r.nav_menu_term_id===a))},refresh:function(){var i,r=this,n=t.Deferred();return e.isNumber(r.params.navMenuArgs.menu)?i=r.params.navMenuArgs.menu:r.params.navMenuArgs.theme_location&&s.has("nav_menu_locations["+r.params.navMenuArgs.theme_location+"]")&&(i=s("nav_menu_locations["+r.params.navMenuArgs.theme_location+"]").get()),i?s.selectiveRefresh.Partial.prototype.refresh.call(r):(r.fallback(),n.reject(),n.promise())},renderContent:function(e){var i=this,r=e.container;""===e.addedContent&&e.partial.fallback(),s.selectiveRefresh.Partial.prototype.renderContent.call(i,e)&&t(document).trigger("customize-preview-menu-refreshed",[{instanceNumber:null,wpNavArgs:e.context,wpNavMenuArgs:e.context,oldContainer:r,newContainer:e.container}])}}),s.selectiveRefresh.partialConstructor.nav_menu_instance=r.NavMenuInstancePartial,r.handleUnplacedNavMenuInstances=function(t){var i;return i=e.filter(e.values(r.data.navMenuInstanceArgs),function(t){return!s.selectiveRefresh.partial.has("nav_menu_instance["+t.args_hmac+"]")}),!!e.findWhere(i,t)&&(s.selectiveRefresh.requestFullRefresh(),!0)},r.bindSettingListener=function(t,e){var i;return e=e||{},(i=t.id.match(/^nav_menu\[(-?\d+)]$/))?(t._navMenuId=parseInt(i[1],10),t.bind(this.onChangeNavMenuSetting),e.fire&&this.onChangeNavMenuSetting.call(t,t(),!1),!0):(i=t.id.match(/^nav_menu_item\[(-?\d+)]$/))?(t._navMenuItemId=parseInt(i[1],10),t.bind(this.onChangeNavMenuItemSetting),e.fire&&this.onChangeNavMenuItemSetting.call(t,t(),!1),!0):!!(i=t.id.match(/^nav_menu_locations\[(.+?)]/))&&(t._navMenuThemeLocation=i[1],t.bind(this.onChangeNavMenuLocationsSetting),e.fire&&this.onChangeNavMenuLocationsSetting.call(t,t(),!1),!0)},r.unbindSettingListener=function(t){t.unbind(this.onChangeNavMenuSetting),t.unbind(this.onChangeNavMenuItemSetting),t.unbind(this.onChangeNavMenuLocationsSetting)},r.onChangeNavMenuSetting=function(){var t=this;r.handleUnplacedNavMenuInstances({menu:t._navMenuId}),s.each(function(e){e._navMenuThemeLocation&&t._navMenuId===e()&&r.handleUnplacedNavMenuInstances({theme_location:e._navMenuThemeLocation})})},r.onChangeNavMenuItemSetting=function(t,e){var i,n=t||e;(i=s("nav_menu["+String(n.nav_menu_term_id)+"]"))&&r.onChangeNavMenuSetting.call(i)},r.onChangeNavMenuLocationsSetting=function(){var t,i=this;r.handleUnplacedNavMenuInstances({theme_location:i._navMenuThemeLocation}),(t=!!e.findWhere(e.values(r.data.navMenuInstanceArgs),{theme_location:i._navMenuThemeLocation}))||s.selectiveRefresh.requestFullRefresh()}),r.highlightControls=function(){s.settings.channel&&t(document).on("click",".menu-item",function(e){var i;e.shiftKey&&(i=t(this).attr("class").match(/(?:^|\s)menu-item-(-?\d+)(?:\s|$)/))&&(e.preventDefault(),e.stopPropagation(),s.preview.send("focus-nav-menu-item-control",parseInt(i[1],10)))})},s.bind("preview-ready",function(){r.init()}),r}(jQuery,_,wp,wp.customize);