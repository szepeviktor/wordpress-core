!function(t,e,i){function s(t){function e(t,e,i){var r={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};r[t]?s[r[t]]=e:i||(s[t]=e)}var i=t.required_features,s={};return"string"==typeof i?a.each(i.split(/\s*,\s*/),function(t){e(t,!0)}):"object"==typeof i?a.each(i,function(t,i){e(i,t)}):!0===i&&(t.chunk_size>0&&(s.slice_blob=!0),!t.resize.enabled&&t.multipart||(s.send_binary_string=!0),a.each(t,function(t,i){e(i,!!t,!0)})),t.runtimes="html5,html4",s}var r=t.setTimeout,n={},a={VERSION:"2.1.9",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:e.mimes,ua:e.ua,typeOf:e.typeOf,extend:e.extend,guid:e.guid,getAll:function(t){var e,i=[];"array"!==a.typeOf(t)&&(t=[t]);for(var s=t.length;s--;)(e=a.get(t[s]))&&i.push(e);return i.length?i:null},get:e.get,each:e.each,getPos:e.getPos,getSize:e.getSize,xmlEncode:function(t){var e={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},i=/[<>&\"\']/g;return t?(""+t).replace(i,function(t){return e[t]?"&"+e[t]+";":t}):t},toArray:e.toArray,inArray:e.inArray,addI18n:e.addI18n,translate:e.translate,isEmptyObj:e.isEmptyObj,hasClass:e.hasClass,addClass:e.addClass,removeClass:e.removeClass,getStyle:e.getStyle,addEvent:e.addEvent,removeEvent:e.removeEvent,removeAllEvents:e.removeAllEvents,cleanName:function(t){var e,i;for(i=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],e=0;e<i.length;e+=2)t=t.replace(i[e],i[e+1]);return t=t.replace(/\s+/g,"_"),t=t.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(t,e){var i="";return a.each(e,function(t,e){i+=(i?"&":"")+encodeURIComponent(e)+"="+encodeURIComponent(t)}),i&&(t+=(t.indexOf("?")>0?"&":"?")+i),t},formatSize:function(t){function e(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}if(t===i||/\D/.test(t))return a.translate("N/A");var s=Math.pow(1024,4);return t>s?e(t/s,1)+" "+a.translate("tb"):t>(s/=1024)?e(t/s,1)+" "+a.translate("gb"):t>(s/=1024)?e(t/s,1)+" "+a.translate("mb"):t>1024?Math.round(t/1024)+" "+a.translate("kb"):t+" "+a.translate("b")},parseSize:e.parseSizeStr,predictRuntime:function(t,i){var s,r;return s=new a.Uploader(t),r=e.Runtime.thatCan(s.getOption().required_features,i||t.runtimes),s.destroy(),r},addFileFilter:function(t,e){n[t]=e}};a.addFileFilter("mime_types",function(t,e,i){t.length&&!t.regexp.test(e.name)?(this.trigger("Error",{code:a.FILE_EXTENSION_ERROR,message:a.translate("File extension error."),file:e}),i(!1)):i(!0)}),a.addFileFilter("max_file_size",function(t,e,i){t=a.parseSize(t),void 0!==e.size&&t&&e.size>t?(this.trigger("Error",{code:a.FILE_SIZE_ERROR,message:a.translate("File size error."),file:e}),i(!1)):i(!0)}),a.addFileFilter("prevent_duplicates",function(t,e,i){if(t)for(var s=this.files.length;s--;)if(e.name===this.files[s].name&&e.size===this.files[s].size)return this.trigger("Error",{code:a.FILE_DUPLICATE_ERROR,message:a.translate("Duplicate file error."),file:e}),void i(!1);i(!0)}),a.Uploader=function(t){function o(){var t,e,i=0;if(this.state==a.STARTED){for(e=0;e<O.length;e++)t||O[e].status!=a.QUEUED?i++:(t=O[e],this.trigger("BeforeUpload",t)&&(t.status=a.UPLOADING,this.trigger("UploadFile",t)));i==O.length&&(this.state!==a.STOPPED&&(this.state=a.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",O))}}function h(t){t.percent=t.size>0?Math.ceil(t.loaded/t.size*100):100,d()}function d(){var t,e;for(U.reset(),t=0;t<O.length;t++)e=O[t],e.size!==i?(U.size+=e.origSize,U.loaded+=e.loaded*e.origSize/e.size):U.size=i,e.status==a.DONE?U.uploaded++:e.status==a.FAILED?U.failed++:U.queued++;U.size===i?U.percent=O.length>0?Math.ceil(U.uploaded/O.length*100):0:(U.bytesPerSec=Math.ceil(U.loaded/((+new Date-D||1)/1e3)),U.percent=U.size>0?Math.ceil(U.loaded/U.size*100):0)}function c(){var t=q[0]||S[0];return!!t&&t.getRuntime().uid}function l(t,i){if(t.ruid){var s=e.Runtime.getInfo(t.ruid);if(s)return s.can(i)}return!1}function u(){this.bind("FilesAdded FilesRemoved",function(t){t.trigger("QueueChanged"),t.refresh()}),this.bind("CancelUpload",w),this.bind("BeforeUpload",f),this.bind("UploadFile",_),this.bind("UploadProgress",v),this.bind("StateChanged",y),this.bind("QueueChanged",d),this.bind("Error",x),this.bind("FileUploaded",b),this.bind("Destroy",A)}function p(t,i){var s=this,r=0,n=[],o={runtime_order:t.runtimes,required_caps:t.required_features,preferred_caps:j};a.each(t.runtimes.split(/\s*,\s*/),function(e){t[e]&&(o[e]=t[e])}),t.browse_button&&a.each(t.browse_button,function(i){n.push(function(n){var h=new e.FileInput(a.extend({},o,{accept:t.filters.mime_types,name:t.file_data_name,multiple:t.multi_selection,container:t.container,browse_button:i}));h.onready=function(){var t=e.Runtime.getInfo(this.ruid);e.extend(s.features,{chunks:t.can("slice_blob"),multipart:t.can("send_multipart"),multi_selection:t.can("select_multiple")}),r++,q.push(this),n()},h.onchange=function(){s.addFile(this.files)},h.bind("mouseenter mouseleave mousedown mouseup",function(s){E||(t.browse_button_hover&&("mouseenter"===s.type?e.addClass(i,t.browse_button_hover):"mouseleave"===s.type&&e.removeClass(i,t.browse_button_hover)),t.browse_button_active&&("mousedown"===s.type?e.addClass(i,t.browse_button_active):"mouseup"===s.type&&e.removeClass(i,t.browse_button_active)))}),h.bind("mousedown",function(){s.trigger("Browse")}),h.bind("error runtimeerror",function(){h=null,n()}),h.init()})}),t.drop_element&&a.each(t.drop_element,function(t){n.push(function(i){var n=new e.FileDrop(a.extend({},o,{drop_zone:t}));n.onready=function(){var t=e.Runtime.getInfo(this.ruid);e.extend(s.features,{chunks:t.can("slice_blob"),multipart:t.can("send_multipart"),dragdrop:t.can("drag_and_drop")}),r++,S.push(this),i()},n.ondrop=function(){s.addFile(this.files)},n.bind("error runtimeerror",function(){n=null,i()}),n.init()})}),e.inSeries(n,function(){"function"==typeof i&&i(r)})}function m(t,s,r){var n=new e.Image;try{n.onload=function(){if(s.width>this.width&&s.height>this.height&&s.quality===i&&s.preserve_headers&&!s.crop)return this.destroy(),r(t);n.downsize(s.width,s.height,s.crop,s.preserve_headers)},n.onresize=function(){r(this.getAsBlob(t.type,s.quality)),this.destroy()},n.onerror=function(){r(t)},n.load(t)}catch(a){r(t)}}function g(t,i,r){function n(t,e,i){var s=k[t];switch(t){case"max_file_size":"max_file_size"===t&&(k.max_file_size=k.filters.max_file_size=e);break;case"chunk_size":(e=a.parseSize(e))&&(k[t]=e,k.send_file_name=!0);break;case"multipart":k[t]=e,e||(k.send_file_name=!0);break;case"unique_names":k[t]=e,e&&(k.send_file_name=!0);break;case"filters":"array"===a.typeOf(e)&&(e={mime_types:e}),i?a.extend(k.filters,e):k.filters=e,e.mime_types&&(k.filters.mime_types.regexp=function(t){var e=[];return a.each(t,function(t){a.each(t.extensions.split(/,/),function(t){/^\s*\*\s*$/.test(t)?e.push("\\.*"):e.push("\\."+t.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+e.join("|")+")$","i")}(k.filters.mime_types));break;case"resize":i?a.extend(k.resize,e,{enabled:!0}):k.resize=e;break;case"prevent_duplicates":k.prevent_duplicates=k.filters.prevent_duplicates=!!e;break;case"container":case"browse_button":case"drop_element":e="container"===t?a.get(e):a.getAll(e);case"runtimes":case"multi_selection":k[t]=e,i||(h=!0);break;default:k[t]=e}i||o.trigger("OptionChanged",t,e,s)}var o=this,h=!1;"object"==typeof t?a.each(t,function(t,e){n(e,t,r)}):n(t,i,r),r?(k.required_features=s(a.extend({},k)),j=s(a.extend({},k,{required_features:!0}))):h&&(o.trigger("Destroy"),p.call(o,k,function(t){t?(o.runtime=e.Runtime.getInfo(c()).type,o.trigger("Init",{runtime:o.runtime}),o.trigger("PostInit")):o.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")})}))}function f(t,e){if(t.settings.unique_names){var i=e.name.match(/\.([^.]+)$/),s="part";i&&(s=i[1]),e.target_name=e.id+"."+s}}function _(t,i){function s(){c-- >0?r(n,1e3):(i.loaded=p,t.trigger("Error",{code:a.HTTP_ERROR,message:a.translate("HTTP Error."),file:i,response:M.responseText,status:M.status,responseHeaders:M.getAllResponseHeaders()}))}function n(){var l,m,g,f={};i.status===a.UPLOADING&&t.state!==a.STOPPED&&(t.settings.send_file_name&&(f.name=i.target_name||i.name),d&&u.chunks&&o.size>d?(g=Math.min(d,o.size-p),l=o.slice(p,p+g)):(g=o.size,l=o),d&&u.chunks&&(t.settings.send_chunk_number?(f.chunk=Math.ceil(p/d),f.chunks=Math.ceil(o.size/d)):(f.offset=p,f.total=o.size)),M=new e.XMLHttpRequest,M.upload&&(M.upload.onprogress=function(e){i.loaded=Math.min(i.size,p+e.loaded),t.trigger("UploadProgress",i)}),M.onload=function(){if(M.status>=400)return void s();c=t.settings.max_retries,g<o.size?(l.destroy(),p+=g,i.loaded=Math.min(p,o.size),t.trigger("ChunkUploaded",i,{offset:i.loaded,total:o.size,response:M.responseText,status:M.status,responseHeaders:M.getAllResponseHeaders()}),"Android Browser"===e.Env.browser&&t.trigger("UploadProgress",i)):i.loaded=i.size,l=m=null,!p||p>=o.size?(i.size!=i.origSize&&(o.destroy(),o=null),t.trigger("UploadProgress",i),i.status=a.DONE,t.trigger("FileUploaded",i,{response:M.responseText,status:M.status,responseHeaders:M.getAllResponseHeaders()})):r(n,1)},M.onerror=function(){s()},M.onloadend=function(){this.destroy(),M=null},t.settings.multipart&&u.multipart?(M.open("post",h,!0),a.each(t.settings.headers,function(t,e){M.setRequestHeader(e,t)}),m=new e.FormData,a.each(a.extend(f,t.settings.multipart_params),function(t,e){m.append(e,t)}),m.append(t.settings.file_data_name,l),M.send(m,{runtime_order:t.settings.runtimes,required_caps:t.settings.required_features,preferred_caps:j})):(h=a.buildUrl(t.settings.url,a.extend(f,t.settings.multipart_params)),M.open("post",h,!0),M.setRequestHeader("Content-Type","application/octet-stream"),a.each(t.settings.headers,function(t,e){M.setRequestHeader(e,t)}),M.send(l,{runtime_order:t.settings.runtimes,required_caps:t.settings.required_features,preferred_caps:j})))}var o,h=t.settings.url,d=t.settings.chunk_size,c=t.settings.max_retries,u=t.features,p=0;i.loaded&&(p=i.loaded=d?d*Math.floor(i.loaded/d):0),o=i.getSource(),t.settings.resize.enabled&&l(o,"send_binary_string")&&~e.inArray(o.type,["image/jpeg","image/png"])?m.call(this,o,t.settings.resize,function(t){o=t,i.size=t.size,n()}):n()}function v(t,e){h(e)}function y(t){if(t.state==a.STARTED)D=+new Date;else if(t.state==a.STOPPED)for(var e=t.files.length-1;e>=0;e--)t.files[e].status==a.UPLOADING&&(t.files[e].status=a.QUEUED,d())}function w(){M&&M.abort()}function b(t){d(),r(function(){o.call(t)},1)}function x(t,e){e.code===a.INIT_ERROR?t.destroy():e.code===a.HTTP_ERROR&&(e.file.status=a.FAILED,h(e.file),t.state==a.STARTED&&(t.trigger("CancelUpload"),r(function(){o.call(t)},1)))}function A(t){t.stop(),a.each(O,function(t){t.destroy()}),O=[],q.length&&(a.each(q,function(t){t.destroy()}),q=[]),S.length&&(a.each(S,function(t){t.destroy()}),S=[]),j={},E=!1,D=M=null,U.reset()}var k,D,U,M,z=a.guid(),O=[],j={},q=[],S=[],E=!1;k={runtimes:e.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0},g.call(this,t,null,!0),U=new a.QueueProgress,a.extend(this,{id:z,uid:z,state:a.STOPPED,features:{},runtime:null,files:O,settings:k,total:U,init:function(){var t,i,s=this;return t=s.getOption("preinit"),"function"==typeof t?t(s):a.each(t,function(t,e){s.bind(e,t)}),u.call(s),a.each(["container","browse_button","drop_element"],function(t){if(null===s.getOption(t))return i={code:a.INIT_ERROR,message:a.translate("'%' specified, but cannot be found.")},!1}),i?s.trigger("Error",i):k.browse_button||k.drop_element?void p.call(s,k,function(t){var i=s.getOption("init");"function"==typeof i?i(s):a.each(i,function(t,e){s.bind(e,t)}),t?(s.runtime=e.Runtime.getInfo(c()).type,s.trigger("Init",{runtime:s.runtime}),s.trigger("PostInit")):s.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")})}):s.trigger("Error",{code:a.INIT_ERROR,message:a.translate("You must specify either 'browse_button' or 'drop_element'.")})},setOption:function(t,e){g.call(this,t,e,!this.runtime)},getOption:function(t){return t?k[t]:k},refresh:function(){q.length&&a.each(q,function(t){t.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=a.STARTED&&(this.state=a.STARTED,this.trigger("StateChanged"),o.call(this))},stop:function(){this.state!=a.STOPPED&&(this.state=a.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){E=arguments[0]===i||arguments[0],q.length&&a.each(q,function(t){t.disable(E)}),this.trigger("DisableBrowse",E)},getFile:function(t){var e;for(e=O.length-1;e>=0;e--)if(O[e].id===t)return O[e]},addFile:function(t,i){function s(t,i){var s=[];e.each(d.settings.filters,function(e,i){n[i]&&s.push(function(s){n[i].call(d,e,t,function(t){s(!t)})})}),e.inSeries(s,i)}function o(t){var n=e.typeOf(t);if(t instanceof e.File){if(!t.ruid&&!t.isDetached()){if(!h)return!1;t.ruid=h,t.connectRuntime(h)}o(new a.File(t))}else t instanceof e.Blob?(o(t.getSource()),t.destroy()):t instanceof a.File?(i&&(t.name=i),l.push(function(e){s(t,function(i){i||(O.push(t),u.push(t),d.trigger("FileFiltered",t)),r(e,1)})})):-1!==e.inArray(n,["file","blob"])?o(new e.File(null,t)):"node"===n&&"filelist"===e.typeOf(t.files)?e.each(t.files,o):"array"===n&&(i=null,e.each(t,o))}var h,d=this,l=[],u=[];h=c(),o(t),l.length&&e.inSeries(l,function(){u.length&&d.trigger("FilesAdded",u)})},removeFile:function(t){for(var e="string"==typeof t?t:t.id,i=O.length-1;i>=0;i--)if(O[i].id===e)return this.splice(i,1)[0]},splice:function(t,e){var s=O.splice(t===i?0:t,e===i?O.length:e),r=!1;return this.state==a.STARTED&&(a.each(s,function(t){if(t.status===a.UPLOADING)return r=!0,!1}),r&&this.stop()),this.trigger("FilesRemoved",s),a.each(s,function(t){t.destroy()}),r&&this.start(),s},dispatchEvent:function(t){var e,i;if(t=t.toLowerCase(),e=this.hasEventListener(t)){e.sort(function(t,e){return e.priority-t.priority}),i=[].slice.call(arguments),i.shift(),i.unshift(this);for(var s=0;s<e.length;s++)if(!1===e[s].fn.apply(e[s].scope,i))return!1}return!0},bind:function(t,e,i,s){a.Uploader.prototype.bind.call(this,t,e,s,i)},destroy:function(){this.trigger("Destroy"),k=U=null,this.unbindAll()}})},a.Uploader.prototype=e.EventTarget.instance,a.File=function(){function t(t){a.extend(this,{id:a.guid(),name:t.name||t.fileName,type:t.type||"",size:t.size||t.fileSize,origSize:t.size||t.fileSize,loaded:0,percent:0,status:a.QUEUED,lastModifiedDate:t.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var t=this.getSource().getSource();return-1!==e.inArray(e.typeOf(t),["blob","file"])?t:null},getSource:function(){return i[this.id]?i[this.id]:null},destroy:function(){var t=this.getSource();t&&(t.destroy(),delete i[this.id])}}),i[this.id]=t}var i={};return t}(),a.QueueProgress=function(){var t=this;t.size=0,t.loaded=0,t.uploaded=0,t.failed=0,t.queued=0,t.percent=0,t.bytesPerSec=0,t.reset=function(){t.size=t.loaded=t.uploaded=t.failed=t.queued=t.percent=t.bytesPerSec=0}},t.plupload=a}(window,mOxie);