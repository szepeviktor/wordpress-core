window.wp=window.wp||{},function(t,e){var i;"undefined"!=typeof _wpPluploadSettings&&(i=function(t){var s,r,n=this,a=-1!=navigator.userAgent.indexOf("Trident/")||-1!=navigator.userAgent.indexOf("MSIE "),o={container:"container",browser:"browse_button",dropzone:"drop_element"};if(this.supports={upload:i.browser.supported},this.supported=this.supports.upload,this.supported){this.plupload=e.extend(!0,{multipart_params:{}},i.defaults),this.container=document.body,e.extend(!0,this,t);for(s in this)e.isFunction(this[s])&&(this[s]=e.proxy(this[s],this));for(s in o)this[s]&&(this[s]=e(this[s]).first(),this[s].length?(this[s].prop("id")||this[s].prop("id","__wp-uploader-id-"+i.uuid++),this.plupload[o[s]]=this[s].prop("id")):delete this[s]);(this.browser&&this.browser.length||this.dropzone&&this.dropzone.length)&&(a||"flash"!==plupload.predictRuntime(this.plupload)||this.plupload.required_features&&this.plupload.required_features.hasOwnProperty("send_binary_string")||(this.plupload.required_features=this.plupload.required_features||{},this.plupload.required_features.send_binary_string=!0),this.uploader=new plupload.Uploader(this.plupload),delete this.plupload,this.param(this.params||{}),delete this.params,r=function(t,e,s){s.attachment&&s.attachment.destroy(),i.errors.unshift({message:t||pluploadL10n.default_error,data:e,file:s}),n.error(t,e,s)},this.uploader.bind("init",function(t){var s,r,a,o=n.dropzone;if(a=n.supports.dragdrop=t.features.dragdrop&&!i.browser.mobile,o){if(o.toggleClass("supports-drag-drop",!!a),!a)return o.unbind(".wp-uploader");o.bind("dragover.wp-uploader",function(){s&&clearTimeout(s),r||(o.trigger("dropzone:enter").addClass("drag-over"),r=!0)}),o.bind("dragleave.wp-uploader, drop.wp-uploader",function(){s=setTimeout(function(){r=!1,o.trigger("dropzone:leave").removeClass("drag-over")},0)}),n.ready=!0,e(n).trigger("uploader:ready")}}),this.uploader.bind("postinit",function(t){t.refresh(),n.init()}),this.uploader.init(),this.browser?this.browser.on("mouseenter",this.refresh):(this.uploader.disableBrowse(!0),e("#"+this.uploader.id+"_html5_container").hide()),this.uploader.bind("FilesAdded",function(t,e){_.each(e,function(t){var e,s;plupload.FAILED!==t.status&&(e=_.extend({file:t,uploading:!0,date:new Date,filename:t.name,menuOrder:0,uploadedTo:wp.media.model.settings.post.id},_.pick(t,"loaded","size","percent")),s=/(?:jpe?g|png|gif)$/i.exec(t.name),s&&(e.type="image",e.subtype="jpg"===s[0]?"jpeg":s[0]),t.attachment=wp.media.model.Attachment.create(e),i.queue.add(t.attachment),n.added(t.attachment))}),t.refresh(),t.start()}),this.uploader.bind("UploadProgress",function(t,e){e.attachment.set(_.pick(e,"loaded","percent")),n.progress(e.attachment)}),this.uploader.bind("FileUploaded",function(t,e,s){var a;try{s=JSON.parse(s.response)}catch(o){return r(pluploadL10n.default_error,o,e)}return!_.isObject(s)||_.isUndefined(s.success)?r(pluploadL10n.default_error,null,e):s.success?(_.each(["file","loaded","size","percent"],function(t){e.attachment.unset(t)}),e.attachment.set(_.extend(s.data,{uploading:!1})),wp.media.model.Attachment.get(s.data.id,e.attachment),a=i.queue.all(function(t){return!t.get("uploading")}),a&&i.queue.reset(),void n.success(e.attachment)):r(s.data&&s.data.message,s.data,e)}),this.uploader.bind("Error",function(t,e){var s,n=pluploadL10n.default_error;for(s in i.errorMap)if(e.code===plupload[s]){n=i.errorMap[s],_.isFunction(n)&&(n=n(e.file,e));break}r(n,e,e.file),t.refresh()}))}},e.extend(i,_wpPluploadSettings),i.uuid=0,i.errorMap={FAILED:pluploadL10n.upload_failed,FILE_EXTENSION_ERROR:pluploadL10n.invalid_filetype,IMAGE_FORMAT_ERROR:pluploadL10n.not_an_image,IMAGE_MEMORY_ERROR:pluploadL10n.image_memory_exceeded,IMAGE_DIMENSIONS_ERROR:pluploadL10n.image_dimensions_exceeded,GENERIC_ERROR:pluploadL10n.upload_failed,IO_ERROR:pluploadL10n.io_error,HTTP_ERROR:pluploadL10n.http_error,SECURITY_ERROR:pluploadL10n.security_error,FILE_SIZE_ERROR:function(t){return pluploadL10n.file_exceeds_size_limit.replace("%s",t.name)}},e.extend(i.prototype,{param:function(t,i){if(1===arguments.length&&"string"==typeof t)return this.uploader.settings.multipart_params[t];arguments.length>1?this.uploader.settings.multipart_params[t]=i:e.extend(this.uploader.settings.multipart_params,t)},init:function(){},error:function(){},success:function(){},added:function(){},progress:function(){},complete:function(){},refresh:function(){var t,i,s,r;if(this.browser){for(t=this.browser[0];t;){if(t===document.body){i=!0;break}t=t.parentNode}i||(r="wp-uploader-browser-"+this.uploader.id,s=e("#"+r),s.length||(s=e('<div class="wp-uploader-browser" />').css({position:"fixed",top:"-1000px",left:"-1000px",height:0,width:0}).attr("id","wp-uploader-browser-"+this.uploader.id).appendTo("body")),s.append(this.browser))}this.uploader.refresh()}}),i.queue=new wp.media.model.Attachments([],{query:!1}),i.errors=new Backbone.Collection,t.Uploader=i)}(wp,jQuery);