!function(t){function e(){return t("<div/>")}var i=Math.abs,s=Math.max,r=Math.min,n=Math.round;t.imgAreaSelect=function(a,o){function h(t){return t+_t.left-vt.left}function d(t){return t+_t.top-vt.top}function c(t){return t-_t.left+vt.left}function l(t){return t-_t.top+vt.top}function u(t){return s(t.pageX||0,m(t).x)-vt.left}function p(t){return s(t.pageY||0,m(t).y)-vt.top}function m(t){var e=t.originalEvent||{};return e.touches&&e.touches.length?{x:e.touches[0].pageX,y:e.touches[0].pageY}:{x:0,y:0}}function g(t){var e=t||N,i=t||J;return{x1:n(bt.x1*e),y1:n(bt.y1*i),x2:n(bt.x2*e),y2:n(bt.y2*i),width:n(bt.x2*e)-n(bt.x1*e),height:n(bt.y2*i)-n(bt.y1*i)}}function f(t,e,i,s,r){var a=r||N,o=r||J;bt={x1:n(t/a||0),y1:n(e/o||0),x2:n(i/a||0),y2:n(s/o||0)},bt.width=bt.x2-bt.x1,bt.height=bt.y2-bt.y1}function _(){L&&lt.width()&&(_t={left:n(lt.offset().left),top:n(lt.offset().top)},Q=lt.innerWidth(),H=lt.innerHeight(),_t.top+=lt.outerHeight()-H>>1,_t.left+=lt.outerWidth()-Q>>1,$=n(o.minWidth/N)||0,G=n(o.minHeight/J)||0,K=n(r(o.maxWidth/N||1<<24,Q)),X=n(r(o.maxHeight/J||1<<24,H)),"1.3.2"!=t().jquery||"fixed"!=wt||xt.getBoundingClientRect||(_t.top+=s(document.body.scrollTop,xt.scrollTop),_t.left+=s(document.body.scrollLeft,xt.scrollLeft)),vt=/absolute|relative/.test(F.css("position"))?{left:n(F.offset().left)-F.scrollLeft(),top:n(F.offset().top)-F.scrollTop()}:"fixed"==wt?{left:t(document).scrollLeft(),top:t(document).scrollTop()}:{left:0,top:0},W=h(0),B=d(0),(bt.x2>Q||bt.y2>H)&&D())}function v(e){if(Z){switch(ut.css({left:h(bt.x1),top:d(bt.y1)}).add(pt).width(ht=bt.width).height(dt=bt.height),pt.add(mt).add(ft).css({left:0,top:0}),mt.width(s(ht-mt.outerWidth()+mt.innerWidth(),0)).height(s(dt-mt.outerHeight()+mt.innerHeight(),0)),t(gt[0]).css({left:W,top:B,width:bt.x1,height:H}),t(gt[1]).css({left:W+bt.x1,top:B,width:ht,height:bt.y1}),t(gt[2]).css({left:W+bt.x2,top:B,width:Q-bt.x2,height:H}),t(gt[3]).css({left:W+bt.x1,top:B+bt.y2,width:ht,height:H-bt.y2}),ht-=ft.outerWidth(),dt-=ft.outerHeight(),ft.length){case 8:t(ft[4]).css({left:ht>>1}),t(ft[5]).css({left:ht,top:dt>>1}),t(ft[6]).css({left:ht>>1,top:dt}),t(ft[7]).css({top:dt>>1});case 4:ft.slice(1,3).css({left:ht}),ft.slice(2,4).css({top:dt})}!1!==e&&(t.imgAreaSelect.onKeyPress!=kt&&t(document).unbind(t.imgAreaSelect.keyPress,t.imgAreaSelect.onKeyPress),o.keys&&t(document)[t.imgAreaSelect.keyPress](t.imgAreaSelect.onKeyPress=kt)),Dt&&mt.outerWidth()-mt.innerWidth()==2&&(mt.css("margin",0),setTimeout(function(){mt.css("margin","auto")},0))}}function y(t){_(),v(t),tt=h(bt.x1),et=d(bt.y1),it=h(bt.x2),st=d(bt.y2)}function w(t,e){o.fadeSpeed?t.fadeOut(o.fadeSpeed,e):t.hide()}function b(t){var e=c(u(t))-bt.x1,i=l(p(t))-bt.y1;ct||(_(),ct=!0,ut.one("mouseout",function(){ct=!1})),V="",o.resizable&&(i<=o.resizeMargin?V="n":i>=bt.height-o.resizeMargin&&(V="s"),e<=o.resizeMargin?V+="w":e>=bt.width-o.resizeMargin&&(V+="e")),ut.css("cursor",V?V+"-resize":o.movable?"move":""),P&&P.toggle()}function x(e){t("body").css("cursor",""),(o.autoHide||bt.width*bt.height==0)&&w(ut.add(gt),function(){t(this).hide()}),t(document).off("mousemove touchmove",U),ut.on("mousemove touchmove",b),o.onSelectEnd(a,g())}function A(e){return("mousedown"!=e.type||1==e.which)&&(b(e),_(),V?(t("body").css("cursor",V+"-resize"),tt=h(bt[/w/.test(V)?"x2":"x1"]),et=d(bt[/n/.test(V)?"y2":"y1"]),t(document).on("mousemove touchmove",U).one("mouseup touchend",x),ut.off("mousemove touchmove",b)):o.movable?(I=W+bt.x1-u(e),R=B+bt.y1-p(e),ut.off("mousemove touchmove",b),t(document).on("mousemove touchmove",z).one("mouseup touchend",function(){o.onSelectEnd(a,g()),t(document).off("mousemove touchmove",z),ut.on("mousemove touchmove",b)})):lt.mousedown(e),!1)}function k(t){Y&&(t?(it=s(W,r(W+Q,tt+i(st-et)*Y*(it>tt||-1))),st=n(s(B,r(B+H,et+i(it-tt)/Y*(st>et||-1)))),it=n(it)):(st=s(B,r(B+H,et+i(it-tt)/Y*(st>et||-1))),it=n(s(W,r(W+Q,tt+i(st-et)*Y*(it>tt||-1)))),st=n(st)))}function D(){tt=r(tt,W+Q),et=r(et,B+H),i(it-tt)<$&&(it=tt-$*(it<tt||-1),it<W?tt=W+$:it>W+Q&&(tt=W+Q-$)),i(st-et)<G&&(st=et-G*(st<et||-1),st<B?et=B+G:st>B+H&&(et=B+H-G)),it=s(W,r(it,W+Q)),st=s(B,r(st,B+H)),k(i(it-tt)<i(st-et)*Y),i(it-tt)>K&&(it=tt-K*(it<tt||-1),k()),i(st-et)>X&&(st=et-X*(st<et||-1),k(!0)),bt={x1:c(r(tt,it)),x2:c(s(tt,it)),y1:l(r(et,st)),y2:l(s(et,st)),width:i(it-tt),height:i(st-et)},v(),o.onSelectChange(a,g())}function U(t){return it=/w|e|^$/.test(V)||Y?u(t):h(bt.x2),st=/n|s|^$/.test(V)||Y?p(t):d(bt.y2),D(),!1}function M(e,i){it=(tt=e)+bt.width,st=(et=i)+bt.height,t.extend(bt,{x1:c(tt),y1:l(et),x2:c(it),y2:l(st)}),v(),o.onSelectChange(a,g())}function z(t){return tt=s(W,r(I+u(t),W+Q-bt.width)),et=s(B,r(R+p(t),B+H-bt.height)),M(tt,et),t.preventDefault(),!1}function O(){t(document).off("mousemove touchmove",O),_(),it=tt,st=et,D(),V="",gt.is(":visible")||ut.add(gt).hide().fadeIn(o.fadeSpeed||0),Z=!0,t(document).off("mouseup touchend",j).on("mousemove touchmove",U).one("mouseup touchend",x),ut.off("mousemove touchmove",b),o.onSelectStart(a,g())}function j(){t(document).off("mousemove touchmove",O).off("mouseup touchend",j),w(ut.add(gt)),f(c(tt),l(et),c(tt),l(et)),this instanceof t.imgAreaSelect||(o.onSelectChange(a,g()),o.onSelectEnd(a,g()))}function q(e){return!(e.which>1||gt.is(":animated"))&&(_(),I=tt=u(e),R=et=p(e),t(document).on({"mousemove touchmove":O,"mouseup touchend":j}),!1)}function S(){y(!1)}function E(){L=!0,T(o=t.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},o)),ut.add(gt).css({visibility:""}),o.show&&(Z=!0,_(),v(),ut.add(gt).hide().fadeIn(o.fadeSpeed||0)),setTimeout(function(){o.onInit(a,g())},0)}function C(t,e){for(var i in e)o[i]!==undefined&&t.css(e[i],o[i])}function T(i){if(i.parent&&(F=t(i.parent)).append(ut.add(gt)),t.extend(o,i),_(),null!=i.handles){for(ft.remove(),ft=t([]),at=i.handles?"corners"==i.handles?4:8:0;at--;)ft=ft.add(e());ft.addClass(o.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:yt+1||1}),!parseInt(ft.css("width"))>=0&&ft.width(5).height(5),(ot=o.borderWidth)&&ft.css({borderWidth:ot,borderStyle:"solid"}),C(ft,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}for(N=o.imageWidth/Q||1,J=o.imageHeight/H||1,null!=i.x1&&(f(i.x1,i.y1,i.x2,i.y2),i.show=!i.hide),i.keys&&(o.keys=t.extend({shift:1,ctrl:"resize"},i.keys)),gt.addClass(o.classPrefix+"-outer"),pt.addClass(o.classPrefix+"-selection"),at=0;at++<4;)t(mt[at-1]).addClass(o.classPrefix+"-border"+at);C(pt,{selectionColor:"background-color",selectionOpacity:"opacity"}),C(mt,{borderOpacity:"opacity",borderWidth:"border-width"}),C(gt,{outerColor:"background-color",outerOpacity:"opacity"}),(ot=o.borderColor1)&&t(mt[0]).css({borderStyle:"solid",borderColor:ot}),(ot=o.borderColor2)&&t(mt[1]).css({borderStyle:"dashed",borderColor:ot}),ut.append(pt.add(mt).add(P)).append(ft),Dt&&((ot=(gt.css("filter")||"").match(/opacity=(\d+)/))&&gt.css("opacity",ot[1]/100),(ot=(mt.css("filter")||"").match(/opacity=(\d+)/))&&mt.css("opacity",ot[1]/100)),i.hide?w(ut.add(gt)):i.show&&L&&(Z=!0,ut.add(gt).fadeIn(o.fadeSpeed||0),y()),Y=(nt=(o.aspectRatio||"").split(/:/))[0]/nt[1],lt.add(gt).unbind("mousedown",q),o.disable||!1===o.enable?(ut.off({"mousemove touchmove":b,"mousedown touchstart":A}),t(window).off("resize",S)):((o.enable||!1===o.disable)&&((o.resizable||o.movable)&&ut.on({"mousemove touchmove":b,"mousedown touchstart":A}),t(window).resize(S)),o.persistent||lt.add(gt).on("mousedown touchstart",q)),o.enable=o.disable=undefined}var L,P,W,B,Q,H,F,I,R,N,J,V,$,G,K,X,Y,Z,tt,et,it,st,rt,nt,at,ot,ht,dt,ct,lt=t(a),ut=e(),pt=e(),mt=e().add(e()).add(e()).add(e()),gt=e().add(e()).add(e()).add(e()),ft=t([]),_t={left:0,top:0},vt={left:0,top:0},yt=0,wt="absolute",bt={x1:0,y1:0,x2:0,y2:0,width:0,height:0},xt=document.documentElement,At=navigator.userAgent,kt=function(t){var e,i,n=o.keys,a=t.keyCode;if(e=isNaN(n.alt)||!t.altKey&&!t.originalEvent.altKey?!isNaN(n.ctrl)&&t.ctrlKey?n.ctrl:!isNaN(n.shift)&&t.shiftKey?n.shift:isNaN(n.arrows)?10:n.arrows:n.alt,"resize"==n.arrows||"resize"==n.shift&&t.shiftKey||"resize"==n.ctrl&&t.ctrlKey||"resize"==n.alt&&(t.altKey||t.originalEvent.altKey)){switch(a){case 37:e=-e;case 39:i=s(tt,it),tt=r(tt,it),it=s(i+e,tt),k();break;case 38:e=-e;case 40:i=s(et,st),et=r(et,st),st=s(i+e,et),k(!0);break;default:return}D()}else switch(tt=r(tt,it),et=r(et,st),a){case 37:M(s(tt-e,W),et);break;case 38:M(tt,s(et-e,B));break;case 39:M(tt+r(e,Q-c(it)),et);break;case 40:M(tt,et+r(e,H-l(st)));break;default:return}return!1};this.remove=function(){T({disable:!0}),ut.add(gt).remove()},this.getOptions=function(){return o},this.setOptions=T,this.getSelection=g,this.setSelection=f,this.cancelSelection=j,this.update=y;var Dt=(/msie ([\w.]+)/i.exec(At)||[])[1],Ut=/opera/i.test(At),Mt=/webkit/i.test(At)&&!/chrome/i.test(At);for(rt=lt;rt.length;)yt=s(yt,isNaN(rt.css("z-index"))?yt:rt.css("z-index")),"fixed"==rt.css("position")&&(wt="fixed"),rt=rt.parent(":not(body)");yt=o.zIndex||yt,Dt&&lt.attr("unselectable","on"),t.imgAreaSelect.keyPress=Dt||Mt?"keydown":"keypress",Ut&&(P=e().css({width:"100%",height:"100%",position:"absolute",zIndex:yt+2||2})),ut.add(gt).css({visibility:"hidden",position:wt,overflow:"hidden",zIndex:yt||"0"}),ut.css({zIndex:yt+2||2}),pt.add(mt).css({position:"absolute",fontSize:0}),a.complete||"complete"==a.readyState||!lt.is("img")?E():lt.one("load",E),!L&&Dt&&Dt>=7&&(a.src=a.src)},t.fn.imgAreaSelect=function(e){return e=e||{},this.each(function(){t(this).data("imgAreaSelect")?e.remove?(t(this).data("imgAreaSelect").remove(),t(this).removeData("imgAreaSelect")):t(this).data("imgAreaSelect").setOptions(e):e.remove||(e.enable===undefined&&e.disable===undefined&&(e.enable=!0),t(this).data("imgAreaSelect",new t.imgAreaSelect(this,e)))}),e.instance?t(this).data("imgAreaSelect"):this}}(jQuery);