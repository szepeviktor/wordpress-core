window.wp=window.wp||{},function(t){wp.Backbone={},wp.Backbone.Subviews=function(t,e){this.view=t,this._views=_.isArray(e)?{"":e}:e||{}},wp.Backbone.Subviews.extend=Backbone.Model.extend,_.extend(wp.Backbone.Subviews.prototype,{all:function(){return _.flatten(_.values(this._views))},get:function(t){return t=t||"",this._views[t]},first:function(t){var e=this.get(t);return e&&e.length?e[0]:null},set:function(t,e,i){var s,r;return _.isString(t)||(i=e,e=t,t=""),i=i||{},e=_.isArray(e)?e:[e],s=this.get(t),r=e,s&&(i.add?_.isUndefined(i.at)?r=s.concat(e):(r=s,r.splice.apply(r,[i.at,0].concat(e))):(_.each(r,function(t){t.__detach=!0}),_.each(s,function(t){t.__detach?t.$el.detach():t.remove()}),_.each(r,function(t){delete t.__detach}))),this._views[t]=r,_.each(e,function(e){var i=e.Views||wp.Backbone.Subviews,s=e.views=e.views||new i(e);s.parent=this.view,s.selector=t},this),i.silent||this._attach(t,e,_.extend({ready:this._isReady()},i)),this},add:function(t,e,i){return _.isString(t)||(i=e,e=t,t=""),this.set(t,e,_.extend({add:!0},i))},unset:function(t,e,i){var s;return _.isString(t)||(i=e,e=t,t=""),e=e||[],(s=this.get(t))&&(e=_.isArray(e)?e:[e],this._views[t]=e.length?_.difference(s,e):[]),i&&i.silent||_.invoke(e,"remove"),this},detach:function(){return t(_.pluck(this.all(),"el")).detach(),this},render:function(){var t={ready:this._isReady()};return _.each(this._views,function(e,i){this._attach(i,e,t)},this),this.rendered=!0,this},remove:function(t){return t&&t.silent||(this.parent&&this.parent.views&&this.parent.views.unset(this.selector,this.view,{silent:!0}),delete this.parent,delete this.selector),_.invoke(this.all(),"remove"),this._views=[],this},replace:function(t,e){return t.html(e),this},insert:function(t,e,i){var s,r=i&&i.at;return _.isNumber(r)&&(s=t.children()).length>r?s.eq(r).before(e):t.append(e),this},ready:function(){this.view.trigger("ready"),_.chain(this.all()).map(function(t){return t.views}).flatten().where({attached:!0}).invoke("ready")},_attach:function(t,e,i){var s,r=t?this.view.$(t):this.view.$el;return r.length?(s=_.chain(e).pluck("views").flatten().value(),_.each(s,function(t){t.rendered||(t.view.render(),t.rendered=!0)},this),this[i.add?"insert":"replace"](r,_.pluck(e,"el"),i),_.each(s,function(t){t.attached=!0,i.ready&&t.ready()},this),this):this},_isReady:function(){for(var t=this.view.el;t;){if(t===document.body)return!0;t=t.parentNode}return!1}}),wp.Backbone.View=Backbone.View.extend({Subviews:wp.Backbone.Subviews,constructor:function(t){this.views=new this.Subviews(this,this.views),this.on("ready",this.ready,this),this.options=t||{},Backbone.View.apply(this,arguments)},remove:function(){var t=Backbone.View.prototype.remove.apply(this,arguments);return this.views&&this.views.remove(),t},render:function(){var t;return this.prepare&&(t=this.prepare()),this.views.detach(),this.template&&(t=t||{},this.trigger("prepare",t),this.$el.html(this.template(t))),this.views.render(),this},prepare:function(){return this.options},ready:function(){}})}(jQuery);