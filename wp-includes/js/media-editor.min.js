!function(t,e){var i={};wp.media.coerce=function(t,i){return e.isUndefined(t[i])&&!e.isUndefined(this.defaults[i])?t[i]=this.defaults[i]:"true"===t[i]?t[i]=!0:"false"===t[i]&&(t[i]=!1),t[i]},wp.media.string={props:function(t,i){var s,r,n,a,o=wp.media.view.settings.defaultProps;return t=t?e.clone(t):{},i&&i.type&&(t.type=i.type),"image"===t.type&&(t=e.defaults(t||{},{align:o.align||getUserSetting("align","none"),size:o.size||getUserSetting("imgsize","medium"),url:"",classes:[]})),i?(t.title=t.title||i.title,s=t.link||o.link||getUserSetting("urlbutton","file"),"file"===s||"embed"===s?r=i.url:"post"===s?r=i.link:"custom"===s&&(r=t.linkUrl),t.linkUrl=r||"","image"===i.type?(t.classes.push("wp-image-"+i.id),a=i.sizes,n=a&&a[t.size]?a[t.size]:i,e.extend(t,e.pick(i,"align","caption","alt"),{width:n.width,height:n.height,src:n.url,captionId:"attachment_"+i.id})):"video"===i.type||"audio"===i.type?e.extend(t,e.pick(i,"title","type","icon","mime")):(t.title=t.title||i.filename,t.rel=t.rel||"attachment wp-att-"+i.id),t):t},link:function(t,e){var i;return t=wp.media.string.props(t,e),i={tag:"a",content:t.title,attrs:{href:t.linkUrl}},t.rel&&(i.attrs.rel=t.rel),wp.html.string(i)},audio:function(t,e){return wp.media.string._audioVideo("audio",t,e)},video:function(t,e){return wp.media.string._audioVideo("video",t,e)},_audioVideo:function(t,i,s){var r,n;return i=wp.media.string.props(i,s),"embed"!==i.link?wp.media.string.link(i):(r={},"video"===t&&(s.image&&-1===s.image.src.indexOf(s.icon)&&(r.poster=s.image.src),s.width&&(r.width=s.width),s.height&&(r.height=s.height)),n=s.filename.split(".").pop(),e.contains(wp.media.view.settings.embedExts,n)?(r[n]=s.url,wp.shortcode.string({tag:t,attrs:r})):wp.media.string.link(i))},image:function(t,i){var s,r,n,a,o={};return t.type="image",t=wp.media.string.props(t,i),r=t.classes||[],o.src=e.isUndefined(i)?t.url:i.url,e.extend(o,e.pick(t,"width","height","alt")),t.align&&!t.caption&&r.push("align"+t.align),t.size&&r.push("size-"+t.size),o["class"]=e.compact(r).join(" "),s={tag:"img",attrs:o,single:!0},t.linkUrl&&(s={tag:"a",attrs:{href:t.linkUrl},content:s}),a=wp.html.string(s),t.caption&&(n={},o.width&&(n.width=o.width),t.captionId&&(n.id=t.captionId),t.align&&(n.align="align"+t.align),a=wp.shortcode.string({tag:"caption",attrs:n,content:a+" "+t.caption})),a}},wp.media.embed={coerce:wp.media.coerce,defaults:{url:"",width:"",height:""},edit:function(t,i){var s,r={};return i?r.url=t.replace(/<[^>]+>/g,""):(s=wp.shortcode.next("embed",t).shortcode,r=e.defaults(s.attrs.named,this.defaults),s.content&&(r.url=s.content)),wp.media({frame:"post",state:"embed",metadata:r})},shortcode:function(t){var i,s=this;return e.each(this.defaults,function(e,i){t[i]=s.coerce(t,i),e===t[i]&&delete t[i]}),i=t.url,delete t.url,new wp.shortcode({tag:"embed",attrs:t,content:i})}},wp.media.collection=function(t){var i={};return e.extend({coerce:wp.media.coerce,attachments:function(t){var s,r,n,a,o=t.string(),h=i[o],d=this;return delete i[o],h||(s=e.defaults(t.attrs.named,this.defaults),r=e.pick(s,"orderby","order"),r.type=this.type,r.perPage=-1,undefined!==s.orderby&&(s._orderByField=s.orderby),"rand"===s.orderby&&(s._orderbyRandom=!0),s.orderby&&!/^menu_order(?: ID)?$/i.test(s.orderby)||(r.orderby="menuOrder"),s.ids?(r.post__in=s.ids.split(","),r.orderby="post__in"):s.include&&(r.post__in=s.include.split(",")),s.exclude&&(r.post__not_in=s.exclude.split(",")),r.post__in||(r.uploadedTo=s.id),a=e.omit(s,"id","ids","include","exclude","orderby","order"),e.each(this.defaults,function(t,e){a[e]=d.coerce(a,e)}),n=wp.media.query(r),n[this.tag]=new Backbone.Model(a),n)},shortcode:function(t){var s,r,n=t.props.toJSON(),a=e.pick(n,"orderby","order");return t.type&&(a.type=t.type,delete t.type),t[this.tag]&&e.extend(a,t[this.tag].toJSON()),a.ids=t.pluck("id"),n.uploadedTo&&(a.id=n.uploadedTo),delete a.orderby,a._orderbyRandom?a.orderby="rand":a._orderByField&&"rand"!=a._orderByField&&(a.orderby=a._orderByField),delete a._orderbyRandom,delete a._orderByField,a.ids&&"post__in"===a.orderby&&delete a.orderby,a=this.setDefaults(a),s=new wp.shortcode({tag:this.tag,attrs:a,type:"single"}),r=new wp.media.model.Attachments(t.models,{props:n}),r[this.tag]=t[this.tag],i[s.string()]=r,s},edit:function(t){var i,s,r,n=wp.shortcode.next(this.tag,t),a=this.defaults.id;if(n&&n.content===t)return n=n.shortcode,e.isUndefined(n.get("id"))&&!e.isUndefined(a)&&n.set("id",a),i=this.attachments(n),s=new wp.media.model.Selection(i.models,{props:i.props.toJSON(),multiple:!0}),s[this.tag]=i[this.tag],s.more().done(function(){s.props.set({query:!1}),s.unmirror(),s.props.unset("orderby")}),this.frame&&this.frame.dispose(),r=n.attrs.named.type&&"video"===n.attrs.named.type?"video-"+this.tag+"-edit":this.tag+"-edit",this.frame=wp.media({frame:"post",state:r,title:this.editTitle,editing:!0,multiple:!0,selection:s}).open(),this.frame},setDefaults:function(t){var i=this;return e.each(this.defaults,function(e,s){t[s]=i.coerce(t,s),e===t[s]&&delete t[s]}),t}},t)},wp.media._galleryDefaults={itemtag:"dl",icontag:"dt",captiontag:"dd",columns:"3",link:"post",size:"thumbnail",order:"ASC",id:wp.media.view.settings.post&&wp.media.view.settings.post.id,orderby:"menu_order ID"},wp.media.view.settings.galleryDefaults?wp.media.galleryDefaults=e.extend({},wp.media._galleryDefaults,wp.media.view.settings.galleryDefaults):wp.media.galleryDefaults=wp.media._galleryDefaults,wp.media.gallery=new wp.media.collection({tag:"gallery",type:"image",editTitle:wp.media.view.l10n.editGalleryTitle,defaults:wp.media.galleryDefaults,setDefaults:function(t){var i=this,s=!e.isEqual(wp.media.galleryDefaults,wp.media._galleryDefaults);return e.each(this.defaults,function(e,r){t[r]=i.coerce(t,r),e!==t[r]||s&&e!==wp.media._galleryDefaults[r]||delete t[r]}),t}}),wp.media.featuredImage={get:function(){return wp.media.view.settings.post.featuredImageId},set:function(e){var i=wp.media.view.settings;i.post.featuredImageId=e,wp.media.post("get-post-thumbnail-html",{post_id:i.post.id,thumbnail_id:i.post.featuredImageId,_wpnonce:i.post.nonce}).done(function(e){if("0"==e)return void window.alert(window.setPostThumbnailL10n.error);t(".inside","#postimagediv").html(e)})},remove:function(){wp.media.featuredImage.set(-1)},frame:function(){return this._frame?(wp.media.frame=this._frame,this._frame):(this._frame=wp.media({state:"featured-image",states:[new wp.media.controller.FeaturedImage,new wp.media.controller.EditImage]}),this._frame.on("toolbar:create:featured-image",function(t){this.createSelectToolbar(t,{text:wp.media.view.l10n.setFeaturedImage})},this._frame),this._frame.on("content:render:edit-image",function(){var t=this.state("featured-image").get("selection"),e=new wp.media.view.EditImage({model:t.single(),controller:this}).render();this.content.set(e),e.loadEditor()},this._frame),this._frame.state("featured-image").on("select",this.select),this._frame)},select:function(){var t=this.get("selection").single();wp.media.view.settings.post.featuredImageId&&wp.media.featuredImage.set(t?t.id:-1)},init:function(){t("#postimagediv").on("click","#set-post-thumbnail",function(t){t.preventDefault(),t.stopPropagation(),wp.media.featuredImage.frame().open()}).on("click","#remove-post-thumbnail",function(){return wp.media.featuredImage.remove(),!1})}},t(wp.media.featuredImage.init),wp.media.editor={insert:function(t){var i,s,r=!e.isUndefined(window.tinymce),n=!e.isUndefined(window.QTags);if(s=this.activeEditor?window.wpActiveEditor=this.activeEditor:window.wpActiveEditor,window.send_to_editor)return window.send_to_editor.apply(this,arguments);if(s)r&&(i=tinymce.get(s));else if(r&&tinymce.activeEditor)i=tinymce.activeEditor,s=window.wpActiveEditor=i.id;else if(!n)return!1;if(i&&!i.isHidden()?i.execCommand("mceInsertContent",!1,t):n?QTags.insertContent(t):document.getElementById(s).value+=t,window.tb_remove)try{window.tb_remove()}catch(a){}},add:function(s,r){var n=this.get(s);return n||(n=i[s]=wp.media(e.defaults(r||{},{frame:"post",state:"insert",title:wp.media.view.l10n.addMedia,multiple:!0})),n.on("insert",function(i){var s=n.state();(i=i||s.get("selection"))&&t.when.apply(t,i.map(function(t){var e=s.display(t).toJSON();return this.send.attachment(e,t.toJSON())},this)).done(function(){wp.media.editor.insert(e.toArray(arguments).join("\n\n"))})},this),n.state("gallery-edit").on("update",function(t){this.insert(wp.media.gallery.shortcode(t).string())},this),n.state("playlist-edit").on("update",function(t){this.insert(wp.media.playlist.shortcode(t).string())},this),n.state("video-playlist-edit").on("update",function(t){this.insert(wp.media.playlist.shortcode(t).string())},this),n.state("embed").on("select",function(){var t=n.state(),i=t.get("type"),s=t.props.toJSON();s.url=s.url||"","link"===i?(e.defaults(s,{linkText:s.url,linkUrl:s.url}),this.send.link(s).done(function(t){wp.media.editor.insert(t)})):"image"===i&&(e.defaults(s,{title:s.url,linkUrl:"",align:"none",link:"none"}),"none"===s.link?s.linkUrl="":"file"===s.link&&(s.linkUrl=s.url),this.insert(wp.media.string.image(s)))},this),n.state("featured-image").on("select",wp.media.featuredImage.select),n.setState(n.options.state),n)},id:function(t){return t||(t=window.wpActiveEditor,t||e.isUndefined(window.tinymce)||!tinymce.activeEditor||(t=tinymce.activeEditor.id),t=t||"")},get:function(t){return t=this.id(t),i[t]},remove:function(t){t=this.id(t),delete i[t]},send:{attachment:function(t,i){var s,r,n=i.caption;return wp.media.view.settings.captions||delete i.caption,t=wp.media.string.props(t,i),s={id:i.id,post_content:i.description,post_excerpt:n},t.linkUrl&&(s.url=t.linkUrl),"image"===i.type?(r=wp.media.string.image(t),e.each({align:"align",size:"image-size",alt:"image_alt"},function(e,i){t[i]&&(s[e]=t[i])})):"video"===i.type?r=wp.media.string.video(t,i):"audio"===i.type?r=wp.media.string.audio(t,i):(r=wp.media.string.link(t),s.post_title=t.title),wp.media.post("send-attachment-to-editor",{nonce:wp.media.view.settings.nonce.sendToEditor,attachment:s,html:r,post_id:wp.media.view.settings.post.id})},link:function(t){return wp.media.post("send-link-to-editor",{nonce:wp.media.view.settings.nonce.sendToEditor,src:t.linkUrl,link_text:t.linkText,html:wp.media.string.link(t),post_id:wp.media.view.settings.post.id})}},open:function(t,e){var i;return e=e||{},t=this.id(t),this.activeEditor=t,i=this.get(t),(!i||i.options&&e.state!==i.options.state)&&(i=this.add(t,e)),wp.media.frame=i,i.open()},init:function(){t(document.body).on("click.add-media-button",".insert-media",function(e){var i=t(e.currentTarget),s=i.data("editor"),r={frame:"post",state:"insert",title:wp.media.view.l10n.addMedia,multiple:!0};e.preventDefault(),i.hasClass("gallery")&&(r.state="gallery",r.title=wp.media.view.l10n.createGalleryTitle),wp.media.editor.open(s,r)}),(new wp.media.view.EditorUploader).render()}},e.bindAll(wp.media.editor,"open"),t(wp.media.editor.init)}(jQuery,_);